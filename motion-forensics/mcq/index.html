<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ROMetrics — Forensic Assessment Hub</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/favicon-192.png">

  <style>
    body{
      margin:0;
      background:#07101b;
      color:#e5eefc;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      padding:32px 20px;
    }

    #hub{max-width:900px;margin:auto}

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:28px;
    }

    .header-left{
      display:flex;
      align-items:center;
      gap:14px;
    }

    .logo{
      height:36px;
      cursor:pointer;
    }

    .header h1{margin:0;color:#38bdf8}
    .header p{margin:6px 0 0;color:#9fb3cc}

    .back-btn{
      border:1px solid rgba(148,163,184,.35);
      background:rgba(15,23,42,.78);
      color:#e5eefc;
      padding:10px 14px;
      border-radius:999px;
      font-weight:800;
      cursor:pointer;
    }

    .module{
      background:rgba(15,23,42,.75);
      border:1px solid rgba(148,163,184,.2);
      border-radius:18px;
      margin-bottom:14px;
      overflow:hidden;
    }

    .module.locked{opacity:.45;border-style:dashed}

    .module-head{
      padding:18px 22px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      cursor:pointer;
    }

    .module.locked .module-head{cursor:not-allowed}

    .module-title{font-weight:900;font-size:18px}

    .badge{
      font-size:12px;
      font-weight:900;
      padding:4px 10px;
      border-radius:99px;
    }

    .badge.ready{background:rgba(56,189,248,.15);color:#38bdf8}
    .badge.done{background:rgba(74,222,128,.15);color:#4ade80}
    .badge.locked{background:rgba(248,113,113,.15);color:#f87171}

    .content{display:none;padding:22px 26px;border-top:1px solid rgba(148,163,184,.15)}
    .module.active .content{display:block}

    .q{margin-bottom:26px}
    .q h4{margin:0 0 12px;color:#cfe3ff}

    .opt{
      border:1px solid rgba(148,163,184,.2);
      border-radius:12px;
      padding:12px 14px;
      margin-bottom:8px;
      cursor:pointer;
      font-size:14px;
    }

    .opt.selected{border-color:#38bdf8;background:rgba(56,189,248,.1)}
    .opt.correct{border-color:#4ade80;background:rgba(74,222,128,.1);color:#4ade80}

    .btn{
      width:100%;
      margin-top:10px;
      padding:14px;
      font-weight:900;
      border:none;
      border-radius:14px;
      background:#38bdf8;
      color:#07101b;
      cursor:pointer;
    }
  </style>
</head>

<body>

<div id="hub">

  <div class="header">
    <div class="header-left">
      <img src="/rometrics-logo.png" alt="ROMetrics" class="logo"
           onclick="window.location.href='/'">

      <div>
        <h1>Forensic Assessment Hub</h1>
        <p>Assessments unlock only after completing the corresponding lab.</p>
      </div>
    </div>

    <button class="back-btn" onclick="window.location.href='/motion-forensics/'">
      ← Back to Modules
    </button>
  </div>

  <div id="modules"></div>

</div>

<script>

/* ==========================================================
   QUESTION VAULT (INLINE — READY FOR OBFUSCATION)
   ========================================================== */

const MCQS = {
  "FL-001": {
    title: "Energy Systems Forensics",
    questions: [
      { q:"What determines whether aerobic metabolism can sustain the selected speed?",
        opts:["A. Fuel timing relative to effort","B. Duration of the trial","C. Size of anaerobic reserve","D. VO₂ Max relative to cost"], correct:"D" },
      { q:"Why can anaerobic systems still contribute during an aerobic-dominant trial?",
        opts:["A. All movement begins anaerobically","B. The body uses mixed systems","C. Fuel changes energy pathways","D. PCr activates at low speed"], correct:"B" },
      { q:"Which value represents the subject’s modeled VO₂ Max used as the oxygen budget for the trial?",
        opts:["A. 15.3 × (HRmax ÷ HRrest)","B. (Speed × 26.8 × 0.20) + 3.5","C. 0.20 × running speed","D. Resting metabolic rate"], correct:"A" },
      { q:"Which best explains the effect of EARLY carbohydrate fuel during Trial B?",
        opts:["A. Fuel adds energy while slightly raising lactate","B. Fuel adds energy without lactate change","C. Fuel reduces lactate","D. Fuel has no effect"], correct:"A" },
      { q:"What strategy allowed Trial B completion without crashing?",
        opts:["A. Fuel twice anytime","B. Wait to fuel","C. Fuel continuously","D. Fuel once at end"], correct:"B" }
    ]
  },

  "FL-002": {
    title: "Stability Forensics: Center of Mass",
    questions: [
      { q:"Why did bending the knees allow stability at max forward reach?",
        opts:["A. Increased muscle activation","B. Reduced reach distance","C. Slowed movement","D. Lowered COM stayed inside BOS"], correct:"D" },
      { q:"Which mechanical relationship changed with knee bending?",
        opts:["A. Torque & force","B. Speed & imbalance","C. Reach & endurance","D. COM & BOS boundaries"], correct:"D" },
      { q:"Why did widening the stance work in Trial B?",
        opts:["A. Reduced weight","B. Limited trunk motion","C. Increased hip abduction","D. Expanded BOS"], correct:"D" },
      { q:"Why was knee bending insufficient with added load?",
        opts:["A. Knee flexion irrelevant","B. Strength exceeded","C. Speed increased","D. COM displaced laterally"], correct:"D" },
      { q:"Across both trials, why did strategies succeed?",
        opts:["A. Counteracted gravity","B. Early adjustments","C. Controlled patterns","D. COM stayed within BOS"], correct:"D" }
    ]
  }
};

/* ==========================================================
   ACCESS RULES
   ========================================================== */

function canAccess(id){
  return localStorage.getItem(id+"_entered")==="true" ||
         localStorage.getItem(id+"_Status")==="completed";
}

/* ==========================================================
   RENDER HUB
   ========================================================== */

const container=document.getElementById("modules");

Object.keys(MCQS).forEach(id=>{
  const done=localStorage.getItem(id+"_Status")==="completed";
  const access=canAccess(id);

  const row=document.createElement("div");
  row.className="module"+(!access?" locked":"");

  row.innerHTML=`
    <div class="module-head">
      <div class="module-title">${id}: ${MCQS[id].title}</div>
      <div class="badge ${done?"done":access?"ready":"locked"}">
        ${done?"✓ VALIDATED":access?"READY":"LOCKED"}
      </div>
    </div>
    <div class="content"></div>
  `;

  row.querySelector(".module-head").onclick=()=>{
    if(!access) return alert("Complete the lab module before accessing this assessment.");
    row.classList.toggle("active");
  };

  container.appendChild(row);
  if(access) renderQuiz(id,row.querySelector(".content"));
});

/* ==========================================================
   QUIZ RENDER
   ========================================================== */

function renderQuiz(id,el){
  const done=localStorage.getItem(id+"_Status")==="completed";
  const qs=MCQS[id].questions;

  qs.forEach((q,i)=>{
    const block=document.createElement("div");
    block.className="q";
    block.innerHTML=`<h4>${i+1}. ${q.q}</h4>`;
    q.opts.forEach(o=>{
      const l=o[0];
      const d=document.createElement("div");
      d.className="opt"+(done&&l===q.correct?" correct":"");
      d.textContent=o;
      if(!done){
        d.onclick=()=>{
          block.querySelectorAll(".opt").forEach(x=>x.classList.remove("selected"));
          d.classList.add("selected");
          q.answer=l;
        };
      }
      block.appendChild(d);
    });
    el.appendChild(block);
  });

  if(!done){
    const b=document.createElement("button");
    b.className="btn";
    b.textContent="Validate Findings";
    b.onclick=()=>{
      if(!qs.every(q=>q.answer)) return alert("Answer all questions.");
      if(qs.every(q=>q.answer===q.correct)){
        localStorage.setItem(id+"_Status","completed");
        alert("Assessment validated.");
        location.reload();
      }else alert("Incorrect findings. Re-assess.");
    };
    el.appendChild(b);
  }
}
</script>
</body>
</html>
