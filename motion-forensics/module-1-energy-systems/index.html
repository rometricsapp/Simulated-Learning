<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ROMetrics — Motion Forensics </title>
  <style>
    html,body{height:100%;margin:0;overflow:hidden;background:#07101b;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;}
    #ui{position:fixed;left:14px;top:14px;z-index:10;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .pill{border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.78);color:#e5eefc;padding:10px 12px;border-radius:999px;font-size:13px;cursor:pointer;user-select:none;backdrop-filter: blur(8px);}
    .pill.active{border-color:rgba(56,189,248,.8);box-shadow:0 0 0 2px rgba(56,189,248,.14) inset;}
    #badge{position:fixed;right:14px;top:14px;z-index:100;padding:12px 12px;border-radius:16px;border:1px solid rgba(148,163,184,.25);background:rgba(15,23,42,.65);color:#cfe3ff;font-size:13px;max-width:420px;backdrop-filter: blur(8px);display:none;}
    #badge .t{font-weight:900;letter-spacing:.2px;}
    #badge .p{opacity:.92;margin-top:6px;line-height:1.25;}
    #controls{margin-top:10px;padding-top:10px;border-top:1px solid rgba(148,163,184,.18);display:grid;gap:8px;}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;}
    .k{opacity:.88;}
    .v{font-weight:900;letter-spacing:.2px;}
    input[type=range]{width:100%;accent-color:#38bdf8;}
    .btn{border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.78);color:#e5eefc;padding:8px 10px;border-radius:12px;font-size:12px;cursor:pointer;}
    #hint{position:fixed;left:14px;bottom:14px;z-index:10;padding:10px 12px;border-radius:14px;border:1px solid rgba(148,163,184,.20);background:rgba(15,23,42,.55);color:#a8c0da;font-size:12px;backdrop-filter: blur(8px);}

    #gate{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:radial-gradient(900px 600px at 50% 35%, rgba(56,189,248,0.10), rgba(7,16,27,0.96));backdrop-filter: blur(6px);}
    #gateCard{width:min(740px, calc(100vw - 28px));border-radius:24px;border:1px solid rgba(148,163,184,.28);background:rgba(9,20,37,.72);box-shadow:0 20px 80px rgba(0,0,0,.40);padding:22px;}
    #gateTop{display:flex;justify-content:space-between;align-items:flex-start;gap:14px;flex-wrap:wrap;}
    #gateTitle{font-weight:950;font-size:22px;color:#e6eef7;letter-spacing:.2px;}
    #gateSub{margin-top:6px;color:#a8c0da;line-height:1.25;font-size:13px;}
    #gateGrid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:16px;}
    @media (max-width:640px){ #gateGrid{grid-template-columns:1fr;} }
    .field{border:1px solid rgba(148,163,184,.22);border-radius:18px;background:rgba(15,23,42,.55);padding:14px;}
    .field .lbl{color:#cfe3ff;font-weight:800;font-size:12px;letter-spacing:.25px;opacity:.95;}
    .field select{width:100%;margin-top:10px;background:rgba(7,16,27,.35);border:1px solid rgba(148,163,184,.22);color:#e6eef7;border-radius:14px;padding:10px 12px;font-size:14px;outline:none;}
    .field .desc{margin-top:10px;color:#a8c0da;font-size:12px;line-height:1.25;min-height:32px;}
    #gateActions{display:flex;justify-content:flex-end;gap:10px;margin-top:16px;flex-wrap:wrap;}
    .primary{border:1px solid rgba(56,189,248,.55);background:rgba(56,189,248,.16);color:#e6eef7;padding:10px 14px;border-radius:16px;font-size:13px;cursor:pointer;font-weight:900;}
    canvas{display:block;}
  </style>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
  <link rel="icon" href="/rometrics-logo.png">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ROMetrics</title>

<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
<link rel="apple-touch-icon" sizes="192x192" href="/favicon-192.png">

</head>
  
<body>
<a href="/" aria-label="Return to home"
   style="position:fixed; top:14px; left:14px; z-index:1000;">
  <img src="/rometrics-logo.png" alt="ROMetrics" style="height:54px;">
</a>

<div id="gate">
    <div id="gateCard">
      <div id="gateTop">
        <div>
          <div id="gateTitle">Forensics Labs</div>
          <div id="gateSub">Select a model, then choose a lab module.</div>
        </div>
      </div>

      <div id="gateGrid">
        <div class="field">
          <div class="lbl">MODEL</div>
          <select id="modelSelect"></select>
          <div class="desc" id="modelDesc"></div>
        </div>

        <div class="field">
          <div class="lbl">MODULE</div>
          <select id="moduleSelect"></select>
          <div class="desc" id="moduleDesc"></div>
        </div>
      </div>

      <div id="gateActions">
        <button id="enterBtn" class="primary">Enter Studio</button>
      </div>
    </div>
  </div>

 <div id="badge" style="display:none;">
<div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
  <div class="t">Forensics Labs </div>

  <button class="btn"
    onclick="window.location.href='/motion-forensics/'"
    style="font-weight:700;">
    ← Back to Modules
  </button>
</div>
    <div class="p" id="moduleTitle">Module</div>

    <div id="controls">
        <div class="row">
            <div class="k">Cardio Speed</div>
            <div class="v"><span id="spdVal">6.0</span> mph</div>
        </div>

        <input id="spd" type="range" min="0" max="22" step="0.1" value="0"/>

        <div class="row">
            <div class="k">W′ Balance / % Anaerobic Used</div>
            <div class="v"><span id="engVal">100</span>%</div>
        </div>

        <div class="row">
            <div class="k">Trial</div>
            <div class="v"><span id="trialTag">A</span> • <span id="trialTime">300</span>s</div>
        </div>

        <div class="row" style="justify-content:flex-start; gap:8px; flex-wrap:wrap;">
            <button id="trialA" class="btn">Trial A</button>
            <button id="trialB" class="btn">Trial B</button>
        </div>
        
        <button id="trialHelp" class="btn" style="align-self:flex-start; margin-top:5px;">Instructions</button>

        <div id="trialMsg" style="color:#a8c0da; font-size:12px; line-height:1.25; margin-top:10px; min-height:30px;">
            Read instructions. Select Trial A or B to begin.
        </div>

        <button id="assessmentBtn" class="primary" style="display:none; width:100%; margin-top:10px;">
            Take Final MCQ Assessment
        </button>

<div class="row" style="display: flex; justify-content: flex-start; gap: 10px; margin-top: 10px;">
    <button id="startBtn" class="btn">Start</button>
    <button id="fuelBtn" class="btn">Fuel +10</button>
    <button id="resetBtn" class="btn">Reset</button>

    <button id="reviewBtn" class="btn" style="display:none; border-color:#4ade80; color:#4ade80; margin-left:auto;">Review MCQ</button>
</div>

        <div class="row" style="justify-content:space-between; margin-top:10px; padding-top:10px; border-top:1px solid rgba(148,163,184,.18);">
            <div class="k">Status</div>
            <div class="v" id="statusVal">Stable</div>
        </div>
    </div>
</div>
<script type="module">  
let speedViolation = false;
let initialSpeed = 0;    
let fuelUsedCount = 0;   
// Internal MCQ counters removed - assessment is now external
window.currentTrials = { mcqs: [] }; 

// Global storage for the correct answer index per trial MCQ CHECK
let currentCorrectIndex = -1;

window.renderMCQ = function(letter) {
    const $trialMsg = document.getElementById('trialMsg');
    sim.running = false;
    if (runAction) runAction.paused = true;
    if (window.controls) window.controls.enabled = true; 

    if (letter === 'A') {
        $trialMsg.innerHTML = `<b style="color:#38bdf8;">Goal Reached:</b> Trial A validated. Unlocking Trial B...`;
        
        setTimeout(() => {
            // Forensic Reset for Transition
            sim.hasStarted = false;
            sim.fuelCount = 0;
            sim.lactate = 0;
            speedViolation = false;
            
            // Auto-load Trial B
            $trialMsg.innerHTML = `<b>Trial B Loaded.</b> Survive 480s (see guide for mph) and record 1 fueling event.`;
        }, 3000);

    } else if (letter === 'B') {
        $trialMsg.innerHTML = `<b style="color:#38bdf8;">Forensic Validation Successful.</b> All trials complete.`;
        
        // Show the Final Assessment Button to go to the new page
        const aBtn = document.getElementById('assessmentBtn');
        if (aBtn) {
            aBtn.style.display = 'block';
            const modId = document.getElementById('moduleSelect').value || "FL-001";
            aBtn.onclick = () => { 
                window.location.href = `assessment.html?module=${modId}`; 
            };
        }
    }
};
    
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
// ==============================
// SIMULATION STATE (GLOBAL)
// ==============================
let trialTime = 300; // seconds

const sim = {
  speedMph: 0,
  energy: 100,
  vo2Max: 0,
  running: false,
  elapsed: 0,
  workTime: 0,
  hasStarted: false,
  lactate: 0,
  fuelCount: 0,
  fuelPenaltyTimer: 0,
  throughputAlert: 0,
  fuelAlertTimer: 0,   // New: Duration for transient alerts
  fuelMessage: "",     // New: Text for the specific timing alert
  fuelSuccess: false   // New: Flag for correct timing feedback
};

// PLACE THE EXPOSURE LINES HERE (Outside the braces)
window.sim = sim; 
window.getTrialTime = () => trialTime; // Use a function to get the current value
window.setTrialTime = (v) => trialTime = v; // Use a function to set the value


   let avatarRoot = null;
    let mixer = null;
    let runAction = null;


///M Table
(function(_0x534c8f,_0x3614d1){function _0x1a4ac7(_0x27cd85,_0x3c2e38,_0x203898,_0x3f3f13,_0x1adaa7){return _0x2aec(_0x1adaa7-0x21f,_0x3c2e38);}function _0x4588c4(_0xcc12df,_0x2530c4,_0x5405c2,_0x287edc,_0x537cc5){return _0x2aec(_0x2530c4- -0x285,_0x5405c2);}function _0x2d34dd(_0x1ba2df,_0x564f04,_0x9405ab,_0x47528f,_0x114f54){return _0x2aec(_0x47528f-0x31c,_0x1ba2df);}function _0x1dac5b(_0x3f8fea,_0x17b76e,_0x3018c6,_0xee7d90,_0x50d1f0){return _0x2aec(_0xee7d90- -0x2af,_0x3f8fea);}const _0x12ead7=_0x534c8f();function _0xcaa829(_0x1e1cc6,_0x49d35f,_0x1f9fad,_0x328fa4,_0x34c13){return _0x2aec(_0x34c13-0xb7,_0x49d35f);}while(!![]){try{const _0x3882a1=-parseInt(_0x2d34dd('Urb5',0x5a1,0x57a,0x55b,0x573))/(-0x727*0x5+-0x18*-0x1d+0x210c)+-parseInt(_0x1dac5b('#r%A',-0xba,-0x73,-0xbb,-0x8e))/(0x1c4+0x1298+-0x145a)+-parseInt(_0xcaa829(0x2d7,'(04E',0x3a1,0x2f1,0x2dc))/(0x21a+0x14d2*-0x1+-0x12bb*-0x1)*(-parseInt(_0xcaa829(0x332,'vfmL',0x376,0x3e3,0x3cc))/(0x10be*-0x2+0x213b+0x45))+parseInt(_0x4588c4(-0xd3,-0xc6,'!82x',-0x175,0x1c))/(0x1f52*-0x1+0xdc9*0x1+-0x15*-0xd6)+parseInt(_0x4588c4(0x55,-0x6c,'7Cc3',-0x81,0x4f))/(0x6d8*-0x4+-0xdc2*0x2+0x6*0x927)+parseInt(_0x1a4ac7(0x479,'ms66',0x5c4,0x5b3,0x4e9))/(0x31*0x4f+0x1ef7*-0x1+0xfdf)+-parseInt(_0xcaa829(0x388,'D9V[',0x33e,0x305,0x408))/(0x1da9+-0xcd*0x13+-0xe6a)*(parseInt(_0x1a4ac7(0x419,'b]Ex',0x523,0x430,0x4ca))/(0xe00+0x22b+-0x127*0xe));if(_0x3882a1===_0x3614d1)break;else _0x12ead7['push'](_0x12ead7['shift']());}catch(_0x2f1e10){_0x12ead7['push'](_0x12ead7['shift']());}}}(_0x5df8,0x4df0c*-0x2+0x916e6+0x7c771*0x1));function _0x839161(_0x8d1451,_0x4388c1,_0x4227ec,_0x6e5d68,_0x2e6660){return _0x2aec(_0x4227ec-0x19f,_0x4388c1);}const _0x4a31db=(function(){function _0x4aafe9(_0x5378d4,_0x2a8b0f,_0x482673,_0x1a6d69,_0x3ab345){return _0x2aec(_0x3ab345- -0x2b9,_0x1a6d69);}const _0x4bb3b3={'tptCw':_0x13ea90(0x843,0x861,0x6b7,0x779,'Srbc')+_0x13ea90(0x6ca,0x607,0x761,0x710,'$7[D')+_0xf2cd54(0x1ca,0x23f,0x144,'$7[D',0x1cc)+')','OzBXu':_0x4aafe9(-0x125,0x93,0x98,'D9V[',-0x37)+_0x4aafe9(0xae,0x18,0x123,'ms66',0x7a)+_0x13ea90(0x737,0x774,0x711,0x719,'Urb5')+_0x21b825(0x24f,0x2f4,'^8T%',0x2ae,0x325)+_0xf2cd54(0x172,0x11d,0x12e,'E9nR',0x14c)+_0xf2cd54(0x13d,0x155,0x2a4,'Vl9M',0x1ca)+_0x13ea90(0x651,0x682,0x6d9,0x664,'a$c['),'sOMPS':function(_0x260796,_0x42e08f){return _0x260796(_0x42e08f);},'kWTdm':_0xf2cd54(0x2e1,0x1c5,0x209,'8Grf',0x1dc),'fUehG':function(_0x29ecaa,_0x1a89ec){return _0x29ecaa+_0x1a89ec;},'XKffR':_0x56d526(-0x2b,0x5,0x56,'N8bu',0xd6),'PtZwi':_0x4aafe9(-0x13e,-0x13e,-0x172,'9bUj',-0x76),'COJuL':function(_0x772c5a,_0x15cfe4){return _0x772c5a(_0x15cfe4);},'usfiN':function(_0x1d6c03){return _0x1d6c03();},'LgAqq':function(_0x3e0f77,_0x350e2d,_0x2744b2){return _0x3e0f77(_0x350e2d,_0x2744b2);},'BtJVn':_0x4aafe9(0x112,0x3,0x115,'Vl9M',0x36)+_0x21b825(0x48b,0x361,'#r%A',0x3e5,0x41f)+_0x4aafe9(-0x59,-0x31,-0x6d,'ms66',-0x97),'ervJb':_0x56d526(0x78,0x13,0xa1,'a$c[',-0x15)+'er','KyIix':function(_0x3ebfaa,_0x5e1579){return _0x3ebfaa!==_0x5e1579;},'chkgA':_0x4aafe9(-0x2,-0x1b4,-0x194,'Sjjn',-0xc8),'XXYSI':_0x56d526(0xb4,0x24,-0x6b,'G!u$',-0xe2),'rZmQE':_0xf2cd54(0x342,0x2a1,0x31d,'LlQn',0x2e8),'vYAMm':function(_0x179fe8,_0x1471bf){return _0x179fe8!==_0x1471bf;},'SQhFV':_0x13ea90(0x63e,0x6dd,0x54d,0x5f4,'!82x')};function _0xf2cd54(_0x4c844c,_0xb2bb82,_0x9f3f4c,_0xc93a58,_0x402a61){return _0x2aec(_0x402a61- -0x78,_0xc93a58);}function _0x56d526(_0x8a43c0,_0x38bde1,_0x5dfc39,_0xb61097,_0x131817){return _0x2aec(_0x38bde1- -0x1d1,_0xb61097);}let _0x478c83=!![];function _0x21b825(_0x6a64e9,_0x3b0470,_0x13b86b,_0x1487f1,_0x1956b6){return _0x2aec(_0x1956b6-0xfc,_0x13b86b);}function _0x13ea90(_0x4c3d3b,_0xb3b620,_0x58cb38,_0x57ac57,_0x1e262a){return _0x2aec(_0x57ac57-0x3d6,_0x1e262a);}return function(_0xf409b4,_0x424662){function _0xf65812(_0x20ccff,_0x2045ba,_0x483204,_0x49078b,_0x2b8c6e){return _0xf2cd54(_0x20ccff-0x14d,_0x2045ba-0x1a8,_0x483204-0x1a,_0x2b8c6e,_0x20ccff-0x31f);}function _0xdb9621(_0x23159d,_0x1d5dfd,_0x5d4a4b,_0x212986,_0x1b734c){return _0x21b825(_0x23159d-0x16f,_0x1d5dfd-0xa3,_0x1d5dfd,_0x212986-0xe3,_0x1b734c- -0x4ca);}const _0x52236a={'ucQWi':_0x4bb3b3[_0x1ec641(-0xae,-0xb1,'kSnD',-0x37,0x3)],'bQRtD':_0x4bb3b3[_0x1ec641(-0x75,-0x8f,'Sjjn',-0x161,-0x1a4)],'cmmms':function(_0x1bb964){function _0x2b5375(_0x3acdd6,_0x573894,_0xafb40,_0x19524b,_0x1bf629){return _0x1ec641(_0x3acdd6-0x36,_0x573894-0x1a8,_0x19524b,_0xafb40-0xd,_0x1bf629-0xb3);}return _0x4bb3b3[_0x2b5375(0xf6,-0x50,0x49,'a$c[',0x97)](_0x1bb964);},'DzLIr':function(_0x1f0884,_0x5b3b84){function _0x423e5d(_0x24d612,_0x1cb776,_0x2899c0,_0x1e19ed,_0xff078f){return _0x1ec641(_0x24d612-0xe4,_0x1cb776-0x17b,_0xff078f,_0x1cb776-0x23d,_0xff078f-0x26);}return _0x4bb3b3[_0x423e5d(0x290,0x22d,0x32d,0x1b7,'rXj[')](_0x1f0884,_0x5b3b84);},'FHzvN':_0x4bb3b3[_0x1ec641(0x82,-0x39,'7P!1',0x20,-0x39)],'OjUAE':_0x4bb3b3[_0xf65812(0x453,0x3bc,0x38e,0x3a9,'^8T%')],'kADrY':_0x4bb3b3[_0x1ec641(-0x148,-0xb7,'$7[D',-0x55,-0x109)]};function _0x41471f(_0x3ef310,_0x17e86a,_0x338975,_0x461965,_0x2351a5){return _0x21b825(_0x3ef310-0x11e,_0x17e86a-0x83,_0x2351a5,_0x461965-0x11e,_0x3ef310-0x1a2);}function _0x3c0949(_0x4f6c23,_0x2b7c49,_0x29ab0e,_0x143ae6,_0x5e177e){return _0x13ea90(_0x4f6c23-0x1ad,_0x2b7c49-0x12b,_0x29ab0e-0x1cc,_0x29ab0e- -0x34b,_0x4f6c23);}function _0x1ec641(_0x9200bd,_0x585391,_0x296e99,_0x3a8a21,_0x167a91){return _0xf2cd54(_0x9200bd-0xd5,_0x585391-0x163,_0x296e99-0xc7,_0x296e99,_0x3a8a21- -0x2c3);}if(_0x4bb3b3[_0x3c0949('@bNO',0x314,0x3ff,0x4bb,0x341)](_0x4bb3b3[_0x3c0949('a$c[',0x366,0x2fd,0x277,0x36d)],_0x4bb3b3[_0x3c0949('Be0L',0x264,0x271,0x327,0x225)])){const _0x489e4f={'HMSgz':_0x4bb3b3[_0x1ec641(0x68,-0x67,'G!u$',-0x11,0x15)],'zcrpy':_0x4bb3b3[_0xf65812(0x474,0x406,0x4b8,0x497,'Vl9M')],'FXpsR':function(_0x13ec77,_0x367b8c){function _0x3b341f(_0x40e872,_0x22e224,_0x32d8ab,_0x12a3dd,_0x5565bd){return _0x1ec641(_0x40e872-0xd6,_0x22e224-0x1b1,_0x32d8ab,_0x22e224-0x719,_0x5565bd-0x176);}return _0x4bb3b3[_0x3b341f(0x87f,0x78b,'Nx%g',0x857,0x72b)](_0x13ec77,_0x367b8c);},'aDeVl':_0x4bb3b3[_0xdb9621(-0x113,'b9E&',-0x102,0x56,-0x99)],'Pemln':function(_0x47386e,_0x3d409b){function _0x36ed6d(_0x30a13a,_0x3d45b4,_0x37980c,_0x4a1fd4,_0x203fb9){return _0xdb9621(_0x30a13a-0x14e,_0x3d45b4,_0x37980c-0x86,_0x4a1fd4-0x12,_0x203fb9-0x619);}return _0x4bb3b3[_0x36ed6d(0x6e3,'ZIVR',0x648,0x512,0x5ed)](_0x47386e,_0x3d409b);},'WeBZA':_0x4bb3b3[_0xdb9621(-0x16a,'vfmL',-0x1d,-0xe,-0x79)],'UlpTH':_0x4bb3b3[_0xdb9621(-0x14f,'X)3w',-0xbc,0x18,-0xb4)],'PCZkW':function(_0x5746cb,_0x5ec059){function _0x330f6c(_0x40675b,_0x16e1ee,_0x5b8cc1,_0x1680f1,_0x54f5e7){return _0x1ec641(_0x40675b-0xe9,_0x16e1ee-0x1ea,_0x1680f1,_0x54f5e7-0x2c6,_0x54f5e7-0x74);}return _0x4bb3b3[_0x330f6c(0x30f,0x33b,0x3ef,'foz8',0x337)](_0x5746cb,_0x5ec059);},'pPwmC':function(_0x23dc5d){function _0x332fe1(_0x3cfac6,_0x3e145a,_0x1027d7,_0x39eb49,_0x4b62a1){return _0x41471f(_0x39eb49-0xc1,_0x3e145a-0x155,_0x1027d7-0x2e,_0x39eb49-0x1e9,_0x3cfac6);}return _0x4bb3b3[_0x332fe1('dUjt',0x726,0x56f,0x633,0x55e)](_0x23dc5d);}};_0x4bb3b3[_0xdb9621(-0x1c6,'ACml',-0x1ed,-0x10e,-0x1e6)](_0x378ba3,this,function(){function _0x710b01(_0x3f3855,_0x2fb4d1,_0x42e97c,_0x81b0d1,_0x48c57e){return _0x1ec641(_0x3f3855-0x1b3,_0x2fb4d1-0x21,_0x81b0d1,_0x48c57e-0x50e,_0x48c57e-0x52);}const _0x582b4e=new _0x10171a(_0x489e4f[_0x5bd2e3(0x30,0x92,-0x64,'9bUj',-0x72)]);function _0x27f969(_0x26c08c,_0x93a212,_0x58571e,_0x3999ba,_0x40c6bf){return _0x1ec641(_0x26c08c-0x1e3,_0x93a212-0x123,_0x40c6bf,_0x93a212-0x1c2,_0x40c6bf-0x11a);}function _0x1be0a1(_0x3e98d2,_0x2bf096,_0x3f0257,_0x193581,_0x17c19e){return _0xdb9621(_0x3e98d2-0x188,_0x3f0257,_0x3f0257-0x100,_0x193581-0x33,_0x17c19e-0x15);}const _0xc11b08=new _0x30cdbf(_0x489e4f[_0x43acb5('Sjjn',0x5a7,0x574,0x4bb,0x4e3)],'i');function _0x43acb5(_0x40d3f4,_0x4f6223,_0x2b4bf9,_0x430d7c,_0x7fdf09){return _0x1ec641(_0x40d3f4-0x10d,_0x4f6223-0xbb,_0x40d3f4,_0x7fdf09-0x5bb,_0x7fdf09-0xe7);}const _0x3aa8eb=_0x489e4f[_0x5bd2e3(-0xc1,0x63,0x44,'8Grf',0x130)](_0x25cfdf,_0x489e4f[_0x43acb5('2pFV',0x3c2,0x514,0x50c,0x4ac)]);function _0x5bd2e3(_0x1baae1,_0x4b603d,_0x137055,_0x4dcaf6,_0x952786){return _0x1ec641(_0x1baae1-0x18e,_0x4b603d-0x30,_0x4dcaf6,_0x137055-0x4f,_0x952786-0x16b);}!_0x582b4e[_0x27f969(0x1db,0x1a2,0xda,0x190,'o^)@')](_0x489e4f[_0x43acb5('7P!1',0x503,0x59d,0x3cb,0x4bb)](_0x3aa8eb,_0x489e4f[_0x1be0a1(-0x112,-0x28e,'@3zA',-0x191,-0x1b4)]))||!_0xc11b08[_0x1be0a1(0xb,-0x65,'LlQn',-0x4d,-0x4f)](_0x489e4f[_0x43acb5('ZZCg',0x623,0x53b,0x6f8,0x638)](_0x3aa8eb,_0x489e4f[_0x43acb5('b9E&',0x5a6,0x610,0x568,0x5fa)]))?_0x489e4f[_0x5bd2e3(-0x1a5,-0x1ba,-0x114,'vmu%',-0x6e)](_0x3aa8eb,'0'):_0x489e4f[_0x1be0a1(-0x113,-0x263,'o^)@',-0xf7,-0x189)](_0x1d78df);})();}else{const _0x12d4c2=_0x478c83?function(){function _0x1bdf47(_0x52d91e,_0x129d78,_0x5a75fd,_0x2bb8b0,_0x1bac12){return _0xdb9621(_0x52d91e-0xb7,_0x1bac12,_0x5a75fd-0x47,_0x2bb8b0-0x11f,_0x2bb8b0-0x25d);}const _0x567ad5={'NrDYc':function(_0x58e3d5){function _0x1b4d52(_0x9b4bc0,_0x1e1154,_0x10aa3a,_0x47515a,_0x58eac1){return _0x2aec(_0x10aa3a- -0x281,_0x47515a);}return _0x52236a[_0x1b4d52(0x5e,-0x15,-0x72,'!l05',0x12)](_0x58e3d5);}};function _0x2a28cf(_0x504393,_0x2be96c,_0x4afc3e,_0x5e00e9,_0x1140ac){return _0xdb9621(_0x504393-0xfd,_0x504393,_0x4afc3e-0x46,_0x5e00e9-0x34,_0x5e00e9-0x76d);}function _0x1fe86a(_0x24245a,_0x25fd60,_0x1b8e54,_0x571351,_0x4c4a5a){return _0x3c0949(_0x571351,_0x25fd60-0x18b,_0x25fd60-0x280,_0x571351-0xaf,_0x4c4a5a-0x14a);}function _0x5362f6(_0x3cae1e,_0x532874,_0x18a10b,_0x560ccf,_0x41fc48){return _0x1ec641(_0x3cae1e-0x136,_0x532874-0x166,_0x560ccf,_0x41fc48-0x183,_0x41fc48-0x1ca);}function _0x424c04(_0x542e4a,_0x22cc68,_0x242b74,_0x757c8c,_0x532850){return _0x3c0949(_0x532850,_0x22cc68-0x90,_0x757c8c-0x16a,_0x757c8c-0xab,_0x532850-0x56);}if(_0x52236a[_0x2a28cf('E9nR',0x5df,0x584,0x62a,0x678)](_0x52236a[_0x2a28cf('X)3w',0x69f,0x718,0x731,0x82f)],_0x52236a[_0x2a28cf('(04E',0x732,0x716,0x6f7,0x649)]))_0x567ad5[_0x424c04(0x630,0x4f0,0x634,0x591,'foz8')](_0x1a3ddb);else{if(_0x424662){if(_0x52236a[_0x2a28cf('RGSH',0x798,0x754,0x733,0x79f)](_0x52236a[_0x1fe86a(0x470,0x4fe,0x51e,'E9nR',0x463)],_0x52236a[_0x424c04(0x449,0x3c0,0x388,0x472,'J0F$')])){const _0x2daeb7=_0x424662[_0x1fe86a(0x5fd,0x628,0x6ef,'7Cc3',0x5df)](_0xf409b4,arguments);return _0x424662=null,_0x2daeb7;}else return function(_0x221e45){}[_0x424c04(0x3ac,0x3aa,0x2ef,0x3ef,'G!u$')+_0x2a28cf('Vl9M',0x762,0x6d1,0x752,0x807)+'r'](_0x52236a[_0x1fe86a(0x46e,0x557,0x65b,'^8T%',0x45e)])[_0x1bdf47(0x228,0x8b,0x6d,0x122,'M8uR')](_0x52236a[_0x1bdf47(0x4a,0x34,-0x4b,0x3f,'E9nR')]);}}}:function(){};return _0x478c83=![],_0x12d4c2;}};}()),_0x564b98=_0x4a31db(this,function(){const _0xe3d3ea={};_0xe3d3ea[_0x46bffa(-0xc2,-0x32,'D9V[',-0xbb,-0x18c)]=_0x1c46a3(0x123,0x198,'LYla',0x2d,0x181)+_0x1c46a3(0xa1,0x46,'af!Z',0xfb,0x4b)+'+$';function _0x483b7c(_0x39f4c6,_0x423875,_0xaa7b2a,_0x49e8cb,_0xadfc31){return _0x2aec(_0xadfc31- -0x57,_0x39f4c6);}function _0x46bffa(_0x4497b2,_0x109773,_0x467d28,_0x2e6df0,_0x47b45d){return _0x2aec(_0x2e6df0- -0x318,_0x467d28);}function _0x26123d(_0x3bc46f,_0x331a29,_0x46d978,_0x4c46a6,_0xfd1c33){return _0x2aec(_0x331a29-0x39c,_0xfd1c33);}function _0x1c46a3(_0xc2921e,_0x213e8b,_0x24ce6e,_0x25c1c8,_0x3e30e4){return _0x2aec(_0xc2921e- -0x134,_0x24ce6e);}function _0x5f0fb1(_0x282474,_0x34b755,_0x37398d,_0x5d5a00,_0x341a82){return _0x2aec(_0x341a82-0x2d6,_0x34b755);}const _0x12a7d8=_0xe3d3ea;return _0x564b98[_0x26123d(0x565,0x646,0x63d,0x5a0,'af!Z')+_0x1c46a3(0x274,0x25b,'J0F$',0x205,0x2b3)]()[_0x1c46a3(0x245,0x271,'#r%A',0x167,0x1ce)+'h'](_0x12a7d8[_0x46bffa(-0x165,0x36,'J0F$',-0xc8,-0x182)])[_0x5f0fb1(0x5c9,'b]Ex',0x6aa,0x653,0x616)+_0x483b7c('ggMe',0x32a,0x2cd,0x3aa,0x30b)]()[_0x1c46a3(0xf9,0x125,'vfmL',0x28,0x102)+_0x1c46a3(0x19f,0x233,'G!u$',0xb3,0xef)+'r'](_0x564b98)[_0x46bffa(-0x8,0xb4,'#r%A',0x61,0x7d)+'h'](_0x12a7d8[_0x483b7c('dUjt',0x1fd,0x1ab,0x1c0,0x246)]);});function _0x321bb7(_0x55bf9f,_0x434772,_0xdd711d,_0x4b5164,_0x532fee){return _0x2aec(_0x532fee-0x17c,_0x55bf9f);}_0x564b98();const _0x3864a8=(function(){const _0x199ea7={'BcGbf':function(_0x5aeb1f,_0x4e37a1){return _0x5aeb1f===_0x4e37a1;},'JeKjg':_0x48b07e('@3zA',0x44f,0x53e,0x436,0x53e),'zXesQ':_0x213e17(0x8f,0x63,0x56,'N8bu',0x14),'WQODJ':function(_0x4b03b5,_0x4aa39c){return _0x4b03b5!==_0x4aa39c;},'xyDKp':_0x213e17(0x20,-0x62,-0x113,'!82x',-0x70),'orwdU':_0x5ebee8('@3zA',0x52,-0x1b,0xe8,0xba),'XJSUD':function(_0x11583d,_0x36ba5d){return _0x11583d+_0x36ba5d;},'ovvvi':_0x213e17(0x18a,0x1bd,0x11e,'dUjt',0xb8),'fYVwB':_0x5ebee8('@bNO',0x46,0x52,-0x24,-0x94),'HPtQl':_0x48b07e('7Cc3',0x66b,0x516,0x635,0x57f)+'n','rSFMB':function(_0x548c65,_0x39a5ba){return _0x548c65(_0x39a5ba);},'xvMUI':function(_0x112603,_0x59dbc2){return _0x112603+_0x59dbc2;},'wJEgk':_0x48b07e('7P!1',0x525,0x3d8,0x374,0x457)+_0x2fdccb(0xd1,-0x2f,'@3zA',-0x28,-0x45)+_0x5ebee8('!l05',0xec,0x16f,0x184,0x265)+_0x2bc5fe(-0x215,-0x24d,'2pFV',-0x281,-0x1cc),'bRhus':_0x2bc5fe(0x2a,0x14,'a$c[',-0x107,-0x56)+_0x48b07e('ACml',0x51b,0x4bd,0x3ae,0x434)+_0x2fdccb(0xd6,0xd2,'G!u$',0x197,-0x36)+_0x5ebee8('b]Ex',0xd7,-0x1b,0x6a,-0x9e)+_0x213e17(0x13e,0x1e4,0x14f,'b]Ex',0xfd)+_0x2fdccb(0x21c,0x14d,'LlQn',0x1f1,0xd2)+'\x20)','Ljmbx':function(_0x356120){return _0x356120();},'PXFKo':function(_0x993e6e,_0x3b0fc9){return _0x993e6e!==_0x3b0fc9;},'tuptj':_0x2fdccb(-0x20,0x49,'Jp$j',0x22,0x153)};function _0x5ebee8(_0x2c1a5a,_0x4839e0,_0x519374,_0x21059f,_0x41a42a){return _0x2aec(_0x21059f- -0x1e5,_0x2c1a5a);}function _0x2bc5fe(_0x31f349,_0x5b96df,_0x248008,_0x26259b,_0x15e26f){return _0x2aec(_0x15e26f- -0x3da,_0x248008);}function _0x213e17(_0x247aed,_0x38fd5f,_0x6cedf2,_0x40366f,_0xdb004c){return _0x2aec(_0xdb004c- -0x2a9,_0x40366f);}let _0xb47c05=!![];function _0x2fdccb(_0x2d4c5d,_0x17374b,_0x58fb6c,_0x384ee6,_0x293e7f){return _0x2aec(_0x17374b- -0x265,_0x58fb6c);}function _0x48b07e(_0x3f2b78,_0x47bcd3,_0xfa02ce,_0xe6c347,_0x56065b){return _0x2aec(_0x56065b-0x276,_0x3f2b78);}return function(_0x11b2bc,_0x5c90b6){function _0x2e96b0(_0xda766c,_0x537703,_0x25e246,_0x41f13a,_0x2bea64){return _0x213e17(_0xda766c-0x173,_0x537703-0x1e6,_0x25e246-0x14,_0x2bea64,_0x41f13a-0x549);}function _0x5d9e43(_0x5bb8ed,_0x121ddc,_0x327f55,_0x18313d,_0x5ba7f7){return _0x48b07e(_0x18313d,_0x121ddc-0x94,_0x327f55-0x147,_0x18313d-0x22,_0x5bb8ed- -0x461);}const _0x23525c={'sumfb':function(_0x43e803,_0x56c9c4){function _0x4aa550(_0x58617e,_0x120352,_0x29fdf8,_0x143e77,_0x1e93c2){return _0x2aec(_0x143e77-0x1f6,_0x120352);}return _0x199ea7[_0x4aa550(0x3ae,'foz8',0x2c4,0x3b8,0x42f)](_0x43e803,_0x56c9c4);},'cCyUF':_0x199ea7[_0x38fe70(-0xd3,'!82x',0x2d,-0xb3,-0x126)],'zMdlk':_0x199ea7[_0x38fe70(-0x110,'RGSH',-0x127,-0x154,-0x231)],'etiuZ':_0x199ea7[_0x5b1d0c('(cMV',0x416,0x236,0x32b,0x430)],'byLej':function(_0x402d6f,_0x1a27a2){function _0x4aab97(_0x5b1b82,_0x3ff8db,_0x23ecd0,_0x22bd6a,_0x5ed89a){return _0x5b1d0c(_0x5b1b82,_0x3ff8db-0x182,_0x23ecd0-0x1dc,_0x5ed89a-0x202,_0x5ed89a-0x170);}return _0x199ea7[_0x4aab97('!82x',0x609,0x650,0x56c,0x598)](_0x402d6f,_0x1a27a2);},'imBpf':function(_0x4bd46c,_0x2cccb5){function _0x2e747a(_0x5cfcbd,_0x3a0284,_0x296e0b,_0x8b0307,_0x548803){return _0x38fe70(_0x5cfcbd-0x10c,_0x548803,_0x296e0b-0x6b,_0x5cfcbd-0x197,_0x548803-0x4e);}return _0x199ea7[_0x2e747a(0x121,0x190,0x3f,0x92,'7Cc3')](_0x4bd46c,_0x2cccb5);},'dOFDG':_0x199ea7[_0x5d9e43(0x13d,0x159,0x1c3,'9bUj',0xc6)],'XxCtp':_0x199ea7[_0x2e96b0(0x583,0x55c,0x513,0x4f6,'@bNO')],'OwwNp':function(_0x27ba6d){function _0x107da3(_0x419dc7,_0x57fe37,_0x3b8a48,_0x1b8029,_0x14de24){return _0x29167b(_0x419dc7-0xed,_0x1b8029-0x256,_0x3b8a48-0x22,_0x1b8029-0x1eb,_0x3b8a48);}return _0x199ea7[_0x107da3(0x4df,0x558,'ZIVR',0x472,0x3f6)](_0x27ba6d);}};function _0x38fe70(_0x5350a4,_0x5207a4,_0x227393,_0xa79898,_0x207d80){return _0x2bc5fe(_0x5350a4-0x2d,_0x5207a4-0x68,_0x5207a4,_0xa79898-0x1e3,_0xa79898-0xbe);}function _0x29167b(_0x2138db,_0x32e217,_0x3ab5de,_0x3d3633,_0x2d31cb){return _0x2fdccb(_0x2138db-0x72,_0x32e217-0x19f,_0x2d31cb,_0x3d3633-0x2a,_0x2d31cb-0x100);}function _0x5b1d0c(_0x43939f,_0x3af4a6,_0x2f81b9,_0x599d20,_0x35af9a){return _0x48b07e(_0x43939f,_0x3af4a6-0x42,_0x2f81b9-0x168,_0x599d20-0x1a5,_0x599d20- -0x192);}if(_0x199ea7[_0x38fe70(-0xf,'Urb5',-0x1a1,-0x101,-0x71)](_0x199ea7[_0x5d9e43(0x10a,0xbe,0x139,'LlQn',0xf1)],_0x199ea7[_0x5b1d0c('ACml',0x374,0x439,0x35d,0x289)]))(function(){return!![];}[_0x38fe70(-0x6f,'foz8',-0x216,-0x12a,-0x202)+_0x5b1d0c('rXj[',0x35b,0x23f,0x2e6,0x3ba)+'r'](_0x23525c[_0x38fe70(0xce,'RGSH',0xfa,0xa,0xbe)](_0x23525c[_0x5b1d0c('Sjjn',0x449,0x352,0x386,0x314)],_0x23525c[_0x5d9e43(0x10b,0x194,0x81,'Vl9M',0x1a5)]))[_0x5d9e43(0xd4,0x171,0x58,'7P!1',-0x30)](_0x23525c[_0x2e96b0(0x6a0,0x576,0x672,0x59e,'!82x')]));else{const _0x4e0af7=_0xb47c05?function(){function _0x4fd15b(_0xe6076f,_0xf76baa,_0x23ecee,_0x2afec6,_0x28dbe5){return _0x2e96b0(_0xe6076f-0xed,_0xf76baa-0xf7,_0x23ecee-0xf2,_0xf76baa- -0x59a,_0x2afec6);}function _0x270cd5(_0x52f588,_0x2ed317,_0x3a4f06,_0x4b0c7a,_0x318254){return _0x5d9e43(_0x318254-0x57c,_0x2ed317-0x1e0,_0x3a4f06-0x17c,_0x2ed317,_0x318254-0x1d);}function _0x3ede7d(_0x48aaa2,_0x317b87,_0x3c3564,_0x2b579c,_0x533486){return _0x2e96b0(_0x48aaa2-0x15c,_0x317b87-0x7,_0x3c3564-0x189,_0x317b87- -0x522,_0x3c3564);}function _0x4fbd08(_0xd7b1cf,_0x2b7837,_0x406847,_0x3e13b3,_0x3b96da){return _0x38fe70(_0xd7b1cf-0x112,_0x406847,_0x406847-0x7e,_0xd7b1cf-0x5ac,_0x3b96da-0x196);}function _0x5089fb(_0x53bc89,_0x366c3b,_0x315ee1,_0x4ff362,_0x9f1386){return _0x2e96b0(_0x53bc89-0x1cb,_0x366c3b-0x51,_0x315ee1-0x15f,_0x9f1386- -0x4e7,_0x4ff362);}if(_0x199ea7[_0x3ede7d(0x2e,0xee,'D9V[',0x186,-0x10)](_0x199ea7[_0x4fbd08(0x470,0x3ba,'ms66',0x4d7,0x56a)],_0x199ea7[_0x4fbd08(0x63a,0x54d,'LlQn',0x736,0x70f)])){const _0x3c2955=_0x23525c[_0x3ede7d(0x10f,0xc6,'Srbc',0x1c4,0x195)](_0x136ecd,_0x23525c[_0x4fd15b(0x60,-0x9,-0x111,'foz8',0x7f)](_0x23525c[_0x270cd5(0x5e6,'(04E',0x75c,0x5dd,0x68c)](_0x23525c[_0x270cd5(0x5f6,'LYla',0x460,0x496,0x560)],_0x23525c[_0x4fbd08(0x4d8,0x43d,'af!Z',0x529,0x4d3)]),');'));_0x43f682=_0x23525c[_0x3ede7d(-0xd8,0x7,'^8T%',0x6f,0x77)](_0x3c2955);}else{if(_0x5c90b6){if(_0x199ea7[_0x4fd15b(-0xfd,-0x79,-0x9f,'^8T%',-0xb)](_0x199ea7[_0x4fd15b(-0x5e,0x56,-0x4a,'J0F$',0x10d)],_0x199ea7[_0x4fd15b(-0xe6,-0x84,-0x15f,'2pFV',-0x6b)])){const _0x14a564=_0x5c90b6[_0x4fd15b(0x45,-0xb4,-0x4,'3yp6',-0x1c)](_0x11b2bc,arguments);return _0x5c90b6=null,_0x14a564;}else{const _0x453be9=_0x321df6[_0x5089fb(-0x3,0x10b,0xbb,'9bUj',0xf7)](_0xef78f9,arguments);return _0x8cac67=null,_0x453be9;}}}}:function(){};return _0xb47c05=![],_0x4e0af7;}};}());(function(){function _0x2809c2(_0x144540,_0xf35db0,_0x519e05,_0x43bf41,_0x1295d3){return _0x2aec(_0x1295d3-0x1a6,_0x519e05);}function _0x466b8b(_0x2c824f,_0x944be,_0x50b950,_0x16b7e6,_0x1722e9){return _0x2aec(_0x944be- -0x1af,_0x2c824f);}const _0x36b862={'ZNWJG':function(_0x258492,_0x12a682){return _0x258492/_0x12a682;},'VfkyR':function(_0x501803,_0x197cde){return _0x501803*_0x197cde;},'owaYz':function(_0x5ba3a4,_0x3893b2){return _0x5ba3a4(_0x3893b2);},'AlmRr':function(_0x595822,_0xe65ad9){return _0x595822+_0xe65ad9;},'vNXlg':function(_0x50568a,_0x1eb45b){return _0x50568a(_0x1eb45b);},'pYhNX':function(_0x2c304a,_0x52624c){return _0x2c304a>_0x52624c;},'ZOLjT':_0x1effdc(0x73f,0x727,0x732,0x63a,'vmu%')+_0x1effdc(0x71d,0x5cc,0x663,0x66b,'ms66'),'eqAcs':_0x466b8b('a$c[',0x1d0,0x2af,0x2d0,0x1ea)+'ic','hEElb':function(_0x592209,_0x124e7f){return _0x592209>_0x124e7f;},'cnVzR':function(_0x3b3ffb,_0x2f066f){return _0x3b3ffb===_0x2f066f;},'BncLJ':_0x2809c2(0x50e,0x3d1,'b9E&',0x43b,0x46c),'FQofl':_0x2809c2(0x55e,0x4f5,'b]Ex',0x3de,0x467)+_0x466b8b('$7[D',0x18b,0x1e8,0x135,0x1bd)+_0x466b8b('G!u$',0x171,0xdf,0x1f0,0x205)+')','BOard':_0x85ae5f(0x254,0x204,0x28d,'M8uR',0x30d)+_0x1effdc(0x5ba,0x5f3,0x615,0x574,'dUjt')+_0x2a3196(0x15b,0x110,'ms66',0x1e3,0xd6)+_0x1effdc(0x542,0x5e9,0x48b,0x56d,'J0F$')+_0x466b8b('J0F$',0xd6,0x15,0xb3,-0x25)+_0x1effdc(0x71e,0x780,0x833,0x75f,'(04E')+_0x2a3196(0x10e,0x3a,'N8bu',0xeb,-0xb),'IFCXX':_0x85ae5f(0x2d8,0x272,0x33f,'ggMe',0x27e),'DqVaH':_0x85ae5f(0x235,0x1fe,0x20d,'o^)@',0x18e),'nudKp':function(_0x2daa2c,_0x28aec1){return _0x2daa2c+_0x28aec1;},'UIJXM':_0x1effdc(0x5ec,0x682,0x669,0x699,'e7Y7'),'gPVPl':function(_0xbf7561,_0x460f71){return _0xbf7561!==_0x460f71;},'bqZow':_0x85ae5f(0x299,0x1af,0x174,'kSnD',0x15d),'UdbaN':_0x2809c2(0x2d7,0x41a,'Be0L',0x493,0x3c7),'gineo':_0x85ae5f(0xbf,0x166,0x19d,'a$c[',0x118),'UIfxJ':_0x2809c2(0x558,0x5f5,'D9V[',0x4dc,0x4f8),'diYdG':function(_0x4785e1){return _0x4785e1();},'fUaVS':function(_0x3494b4,_0x1c1d5c,_0x2cd24d){return _0x3494b4(_0x1c1d5c,_0x2cd24d);}};function _0x1effdc(_0x986ee4,_0xb126e4,_0x49ed3e,_0x146c90,_0x493a3b){return _0x2aec(_0x146c90-0x3b4,_0x493a3b);}function _0x85ae5f(_0x924a90,_0x4675c5,_0x265559,_0x29a6a8,_0x3337ec){return _0x2aec(_0x4675c5- -0xf9,_0x29a6a8);}function _0x2a3196(_0x592113,_0x3a5011,_0x359030,_0x40fc8b,_0x348412){return _0x2aec(_0x3a5011- -0x275,_0x359030);}_0x36b862[_0x85ae5f(0x332,0x2a6,0x281,'foz8',0x25f)](_0x3864a8,this,function(){function _0x2de8b3(_0x519ce6,_0x56912f,_0x2f2b89,_0x2579d5,_0x44bc2b){return _0x2a3196(_0x519ce6-0x192,_0x56912f- -0x121,_0x2579d5,_0x2579d5-0x147,_0x44bc2b-0x172);}function _0x4f6e25(_0x2c68f5,_0x2e3df4,_0x19c019,_0x24b415,_0x181e11){return _0x2809c2(_0x2c68f5-0x84,_0x2e3df4-0x127,_0x2e3df4,_0x24b415-0x95,_0x181e11-0x115);}function _0x59c98e(_0x1c2eea,_0x18474d,_0x2e1d2b,_0x3ff03a,_0x205218){return _0x2809c2(_0x1c2eea-0x7c,_0x18474d-0x33,_0x18474d,_0x3ff03a-0x145,_0x1c2eea- -0x23e);}function _0x4c8bff(_0x438d12,_0x288325,_0x506d38,_0x245ca1,_0x2721dd){return _0x2809c2(_0x438d12-0x192,_0x288325-0x138,_0x2721dd,_0x245ca1-0x10e,_0x438d12- -0x32b);}function _0x1b51f4(_0x1ec822,_0x2478be,_0x424612,_0x855d78,_0x28223c){return _0x2a3196(_0x1ec822-0x141,_0x2478be-0x402,_0x28223c,_0x855d78-0x1cd,_0x28223c-0x15f);}const _0xac5604={'YSTOf':function(_0x2e693d,_0x3b20f5){function _0x59f317(_0x31e67b,_0x368944,_0x1ab9bf,_0x7c3418,_0x1d1347){return _0x2aec(_0x1ab9bf-0x168,_0x368944);}return _0x36b862[_0x59f317(0x4ea,'LYla',0x521,0x5dc,0x423)](_0x2e693d,_0x3b20f5);},'TOzOv':function(_0x442df5,_0x46cc1c){function _0x5a91db(_0x2ec028,_0x21acb6,_0x148491,_0x5984a3,_0x454f05){return _0x2aec(_0x21acb6-0x1a1,_0x148491);}return _0x36b862[_0x5a91db(0x4f9,0x41f,'$7[D',0x41d,0x349)](_0x442df5,_0x46cc1c);},'NQcoz':function(_0x407069,_0x17e4a5){function _0x3b5c30(_0x3c00bf,_0x58702b,_0x2730ca,_0x14c660,_0x565475){return _0x2aec(_0x58702b-0x289,_0x565475);}return _0x36b862[_0x3b5c30(0x5cc,0x599,0x49f,0x541,'ZIVR')](_0x407069,_0x17e4a5);},'vTnfy':function(_0x56e5a7,_0x15dd9c){function _0x2ef47e(_0x4d622e,_0x31d237,_0x26f733,_0x54406e,_0x30fe91){return _0x2aec(_0x26f733- -0x19f,_0x54406e);}return _0x36b862[_0x2ef47e(0xd2,0xbb,0x15a,'X)3w',0x19c)](_0x56e5a7,_0x15dd9c);},'zoyCU':function(_0x19ecc9,_0x254066){function _0x42a6eb(_0xed2be0,_0x26e522,_0x249772,_0x37a32c,_0x7e97bd){return _0x2aec(_0x249772-0x264,_0x26e522);}return _0x36b862[_0x42a6eb(0x50a,'dUjt',0x554,0x652,0x54e)](_0x19ecc9,_0x254066);},'nrNse':function(_0x393a97,_0x2f282a){function _0x412e0b(_0x30ea4d,_0x363898,_0x520254,_0x34ef18,_0x4650a3){return _0x2aec(_0x363898- -0x380,_0x34ef18);}return _0x36b862[_0x412e0b(-0x27,-0xf1,-0x1f8,'Be0L',-0x28)](_0x393a97,_0x2f282a);},'iGTUM':function(_0x24339f,_0x49ed50){function _0x5c3f47(_0x849ce5,_0x53d30f,_0x247544,_0x9ea1bb,_0x38d3dd){return _0x2aec(_0x53d30f- -0xd1,_0x38d3dd);}return _0x36b862[_0x5c3f47(0xf4,0xd8,0x1cc,0x1b4,'[pa(')](_0x24339f,_0x49ed50);},'osMPI':function(_0x28a656,_0x8d53f3){function _0x5517a7(_0x4bcc8e,_0x5f38dc,_0x446ab2,_0x5b24d2,_0x49c7a1){return _0x2aec(_0x5b24d2-0x86,_0x49c7a1);}return _0x36b862[_0x5517a7(0x434,0x494,0x431,0x402,'kSnD')](_0x28a656,_0x8d53f3);},'rugGB':_0x36b862[_0x4c8bff(0x20c,0x1c6,0x2c2,0x26a,'$7[D')],'aCiQE':_0x36b862[_0x4c8bff(0xfa,0x165,0xf5,0x196,'kSnD')],'nLQUg':function(_0x1f4064,_0x839c34){function _0x2397b5(_0x5bcbf5,_0x47aeab,_0x3c822e,_0x1e3431,_0xc3aeed){return _0x4c8bff(_0x3c822e-0x23,_0x47aeab-0x10e,_0x3c822e-0x91,_0x1e3431-0x4a,_0x47aeab);}return _0x36b862[_0x2397b5(0x150,'Jp$j',0xde,0xd9,0x29)](_0x1f4064,_0x839c34);}};if(_0x36b862[_0x4f6e25(0x4f6,'ZZCg',0x495,0x3f2,0x4d0)](_0x36b862[_0x4c8bff(0x8d,0x46,0x1a,0x78,'J0F$')],_0x36b862[_0x1b51f4(0x467,0x3bb,0x3a1,0x4bb,'dUjt')])){const _0x52c68d=new RegExp(_0x36b862[_0x4c8bff(0x1de,0x214,0x144,0x216,'ACml')]),_0xa82bac=new RegExp(_0x36b862[_0x1b51f4(0x460,0x41d,0x424,0x346,'Srbc')],'i'),_0x37699a=_0x36b862[_0x4c8bff(0x1e9,0x17c,0x151,0xe2,'N8bu')](_0x32fb89,_0x36b862[_0x4c8bff(0x180,0x149,0x1fc,0x256,'foz8')]);if(!_0x52c68d[_0x1b51f4(0x412,0x4fc,0x479,0x492,'b]Ex')](_0x36b862[_0x4c8bff(0x157,0x9f,0x237,0x1fa,'8Grf')](_0x37699a,_0x36b862[_0x2de8b3(-0x1fe,-0x12e,-0x4b,'Sjjn',-0x229)]))||!_0xa82bac[_0x4c8bff(0x1fd,0x12e,0x2d0,0x24f,'kSnD')](_0x36b862[_0x59c98e(0x1a6,'X)3w',0x23a,0x277,0x279)](_0x37699a,_0x36b862[_0x4c8bff(0x1e7,0xeb,0x216,0x1cd,'e7Y7')]))){if(_0x36b862[_0x2de8b3(-0x13a,-0xa9,-0x61,'7Cc3',-0x141)](_0x36b862[_0x4c8bff(0x182,0xcd,0xc9,0x283,'Srbc')],_0x36b862[_0x2de8b3(0x1e,-0xe1,0x16,'b9E&',-0x13f)]))_0x36b862[_0x4f6e25(0x661,'a$c[',0x63e,0x4d0,0x55f)](_0x37699a,'0');else{let _0x3cbce7=_0xac5604[_0x2de8b3(0x44,0x21,0x60,'Sjjn',-0xda)](_0x4f11f4,0x9*-0xb7+-0x1*-0x1199+-0xb20*0x1)[_0x2de8b3(-0x19e,-0x165,-0xf5,'Jp$j',-0x1e2)+'ed'](0xca+-0x256+0x18d),_0x302e41=_0xac5604[_0x4f6e25(0x590,'2pFV',0x465,0x489,0x49e)](_0xac5604[_0x2de8b3(-0x211,-0x195,-0xed,'X)3w',-0x1ec)](_0x7e7d1b,_0x3cbce7),-0xa6*-0x2f+0x19cb+-0x382b*0x1+0.8000000000000007),_0x45618e=_0xac5604[_0x59c98e(0x224,'a$c[',0x206,0x12c,0x1c1)](_0xac5604[_0x59c98e(0x1a5,'E9nR',0xbe,0xe7,0x247)](-0x549*-0x1+-0x1b7*-0x8+-0x7*0x2b7+0.205,_0x302e41),-0x26ef+-0xd1a*-0x1+0x676*0x4+0.5),_0x22caae=_0xac5604[_0x2de8b3(-0x74,-0x101,-0x1ae,'Be0L',-0x5c)](_0xac5604[_0x59c98e(0x2a5,'e7Y7',0x1c0,0x1c9,0x290)](_0x45618e,_0x3eaa3b),-0xab5+-0x1*0x187d+0x2396),_0xbfd144=_0xac5604[_0x2de8b3(-0x25d,-0x1e5,-0x1e3,'rXj[',-0x179)](_0xac5604[_0x2de8b3(-0x22,-0x121,-0x1e,'J0F$',-0x153)](_0x45618e,_0x426609),-0x9dc+-0x591+0xfd1);_0x412575[_0x3cbce7]={'cost':_0xac5604[_0x59c98e(0x26a,'!82x',0x1fc,0x2bc,0x250)](_0x4f8e83,_0x45618e[_0x4c8bff(0x41,0xee,0x19,0xcb,'b9E&')+'ed'](0x46*0x1+-0x2671*-0x1+-0x26b5)),'roma':{'intensity':_0xac5604[_0x1b51f4(0x416,0x508,0x4c3,0x425,'3yp6')](_0x22caae[_0x59c98e(0x1c3,'(04E',0x248,0xf5,0x192)+'ed'](-0x3*-0x3+0x26dc+-0x26e4),'%'),'status':_0xac5604[_0x2de8b3(0x7c,-0x1,-0xc6,'(cMV',0x68)](_0x22caae,-0x4ab*-0x2+0x1db2+-0x26a4)?_0xac5604[_0x4c8bff(0x206,0x182,0x2be,0x302,'N8bu')]:_0xac5604[_0x4c8bff(0x181,0x270,0x203,0x1c8,'E9nR')]},'roman':{'intensity':_0xac5604[_0x1b51f4(0x303,0x3a7,0x382,0x383,'rXj[')](_0xbfd144[_0x4f6e25(0x5cd,'Be0L',0x693,0x4eb,0x5f4)+'ed'](0x195b+0x2036+-0x3990),'%'),'status':_0xac5604[_0x4f6e25(0x57e,'3yp6',0x663,0x62d,0x564)](_0xbfd144,0x1*-0x1727+0x126f+-0x6*-0xda)?_0xac5604[_0x4c8bff(0xa6,0x113,0x2f,0xaa,'a$c[')]:_0xac5604[_0x4f6e25(0x694,'LYla',0x5e0,0x648,0x5d7)]}};}}else{if(_0x36b862[_0x1b51f4(0x43e,0x345,0x426,0x30a,'Jp$j')](_0x36b862[_0x2de8b3(-0x200,-0xfa,-0x1b8,'M8uR',0xc)],_0x36b862[_0x1b51f4(0x526,0x46c,0x43f,0x4c4,'foz8')]))_0x36b862[_0x4c8bff(0xe8,0x6,0x7b,0x194,'a$c[')](_0x32fb89);else{if(_0x14abb2)return _0x5640e6;else _0xac5604[_0x2de8b3(-0xc8,-0x145,-0x14f,'$7[D',-0x1e1)](_0x251e7f,-0x25cf+-0xb11*0x3+0x2381*0x2);}}}else{const _0x3fd2c9=_0x4b3873[_0x2de8b3(-0x74,-0x30,-0x10,'dUjt',0x2e)+_0x59c98e(0x23b,'G!u$',0x24d,0x2a5,0x180)+'r'][_0x2de8b3(-0x22a,-0x1e8,-0x2b8,'RGSH',-0x155)+_0x1b51f4(0x469,0x3f1,0x4ac,0x31d,'$7[D')][_0x59c98e(0x124,'3yp6',0x10e,0xcd,0xad)](_0x32668b),_0x23763d=_0x1e4cd3[_0x3ef782],_0x146f40=_0x4a5da0[_0x23763d]||_0x3fd2c9;_0x3fd2c9[_0x2de8b3(-0x63,-0xb2,-0x1aa,'X)3w',-0xf6)+_0x59c98e(0x29e,'rXj[',0x2cb,0x38c,0x28a)]=_0x3fe558[_0x4f6e25(0x55b,'^8T%',0x649,0x6f2,0x5fc)](_0x2834da),_0x3fd2c9[_0x4c8bff(0xd9,0x1ce,0x82,0xc4,'ms66')+_0x2de8b3(-0xb8,-0xae,0x51,'b]Ex',-0x4a)]=_0x146f40[_0x1b51f4(0x397,0x35e,0x314,0x33c,'Nx%g')+_0x4c8bff(0x6a,0xca,-0x66,0x11c,'Jp$j')][_0x4c8bff(0x77,0x54,0x13,0x9b,'M8uR')](_0x146f40),_0x210680[_0x23763d]=_0x3fd2c9;}})();}()),(function(){function _0x216b77(_0x1440fd,_0x417e1c,_0x24d4ad,_0x1451aa,_0x474039){return _0x2aec(_0x1451aa- -0x39,_0x1440fd);}const _0x5b9f94={'AdjYU':function(_0x3a60a5,_0x15bfe2){return _0x3a60a5(_0x15bfe2);},'ULfkl':function(_0x479844,_0x59ad56){return _0x479844===_0x59ad56;},'UprMV':_0x1d3a6d('!82x',0x443,0x4bb,0x426,0x53f),'tsPLK':_0x421595('Urb5',0x519,0x651,0x5a9,0x5b7),'oThtK':function(_0x11d9be,_0x35451a){return _0x11d9be(_0x35451a);},'ANfpi':function(_0x5162d2,_0x2995b6){return _0x5162d2+_0x2995b6;},'ReAxM':function(_0x4f9ac8,_0x3c44e3){return _0x4f9ac8+_0x3c44e3;},'CCSRV':_0x5acedf(0x3,0xf,'rXj[',-0x4c,-0x21)+_0x1d3a6d('D9V[',0x42a,0x4d2,0x528,0x498)+_0x5d8f4b(0x3cc,'dUjt',0x4d9,0x393,0x3e4)+_0x216b77('2pFV',0x270,0x248,0x1d5,0xfc),'XoXWd':_0x5d8f4b(0x257,'Vl9M',0x24e,0x27f,0x32d)+_0x1d3a6d('2pFV',0x35d,0x435,0x321,0x2ad)+_0x421595('b9E&',0x51b,0x582,0x592,0x594)+_0x5acedf(-0x1f,-0xb1,'vfmL',0xd9,0xda)+_0x421595('e7Y7',0x6d1,0x613,0x708,0x624)+_0x5acedf(-0x16f,-0x6e,'kSnD',-0x183,-0xca)+'\x20)','sijVy':function(_0x46273e){return _0x46273e();},'hokHm':_0x421595('2pFV',0x72a,0x7cc,0x712,0x7f8)};let _0x3d3520;function _0x421595(_0x5ffc83,_0x3cc002,_0x58dffb,_0x3e4197,_0x386404){return _0x2aec(_0x3e4197-0x375,_0x5ffc83);}function _0x5d8f4b(_0x22b659,_0x43a8aa,_0x1a4b78,_0x500786,_0x1c74ef){return _0x2aec(_0x1c74ef-0xe8,_0x43a8aa);}try{if(_0x5b9f94[_0x421595('Jp$j',0x5d3,0x755,0x653,0x61f)](_0x5b9f94[_0x1d3a6d('rXj[',0x42e,0x3d8,0x4c0,0x399)],_0x5b9f94[_0x1d3a6d('!82x',0x485,0x507,0x586,0x4e5)]))_0x5b9f94[_0x1d3a6d('ZIVR',0x322,0x237,0x350,0x40c)](_0x50980e,0x5e9+-0x1954*0x1+0x136b*0x1);else{const _0x3ecf75=_0x5b9f94[_0x5d8f4b(0x207,'foz8',0x1c0,0x26e,0x297)](Function,_0x5b9f94[_0x5d8f4b(0x1fc,'8Grf',0x2f9,0x30e,0x2ad)](_0x5b9f94[_0x5acedf(0x3d,0x13,'o^)@',-0x3a,0x57)](_0x5b9f94[_0x5d8f4b(0x394,'Sjjn',0x317,0x2e3,0x3c3)],_0x5b9f94[_0x421595('2pFV',0x4ec,0x629,0x5db,0x6b9)]),');'));_0x3d3520=_0x5b9f94[_0x5acedf(-0xd8,-0x125,'b]Ex',-0x10c,-0x12f)](_0x3ecf75);}}catch(_0x3538a9){if(_0x5b9f94[_0x5d8f4b(0x4b4,'Srbc',0x339,0x46d,0x3cb)](_0x5b9f94[_0x5acedf(-0xac,-0x2d,'G!u$',-0x113,-0x194)],_0x5b9f94[_0x5d8f4b(0x2c4,'vfmL',0x200,0x39f,0x2f4)]))_0x3d3520=window;else return![];}function _0x5acedf(_0x55a689,_0x5ca9ad,_0x49e46b,_0x535e69,_0x337ac8){return _0x2aec(_0x55a689- -0x338,_0x49e46b);}function _0x1d3a6d(_0x1c4216,_0x1048ce,_0x2b5131,_0x3bcb68,_0x1b1305){return _0x2aec(_0x1048ce-0x136,_0x1c4216);}_0x3d3520[_0x421595('o^)@',0x484,0x4df,0x53f,0x4d4)+_0x5acedf(-0x171,-0x112,'foz8',-0x69,-0x1ca)+'l'](_0x32fb89,-0x101d+0x26*-0xe8+0x422d);}());function _0xdb13f(_0x68fef4,_0x4594f3,_0x340380,_0x163cc5,_0x2d2a94){return _0x2aec(_0x2d2a94-0x18d,_0x163cc5);}const _0x180d12=(function(){function _0x3a2486(_0x1c16bc,_0x38b276,_0x534107,_0x582e54,_0x290093){return _0x2aec(_0x534107- -0x22d,_0x38b276);}const _0x519d0e={'RlUHe':function(_0x233327,_0x372115){return _0x233327(_0x372115);},'RmMUV':function(_0x4d407d,_0x461c1e){return _0x4d407d+_0x461c1e;},'KDStN':function(_0x45d662,_0x25763b){return _0x45d662+_0x25763b;},'NYRUm':_0x319371(0x4b,0x120,'2pFV',0x1d9,0x1c8)+_0x227315(0x369,0x2a2,0x303,0x2cf,'Urb5')+_0x28e6b4(0x41f,0x416,0x4b2,0x344,'Be0L')+_0x3a2486(0x179,'RGSH',0x84,0xf2,0xca),'YTWtm':_0x319371(0x1cc,0xdd,'dUjt',0x1b2,0x37)+_0x28e6b4(0x44a,0x445,0x422,0x3c5,'(cMV')+_0x227315(0xdd,0x8d,0x83,0x125,'3yp6')+_0x3a2486(0x20,'G!u$',0x6b,-0x6,0x118)+_0x227315(0x270,0x3d0,0x245,0x2ca,'ggMe')+_0x3a2486(0x24,'o^)@',0x8e,-0x17,-0x24)+'\x20)','KQaIl':function(_0xd06ff9){return _0xd06ff9();},'AwVaX':function(_0x5bcb5e,_0x6dfdb2){return _0x5bcb5e===_0x6dfdb2;},'TrahW':_0x319371(0x259,0x1ef,'RGSH',0xed,0x11a),'cDrnn':function(_0x37c488,_0x15a47c){return _0x37c488!==_0x15a47c;},'xRSSX':_0x578932('foz8',0x165,0x1c6,0x1b2,0x1d3),'YNTJL':_0x319371(0x10b,0x133,'3yp6',0x1b3,0x150),'BrcSL':function(_0x33bd05,_0x198b73){return _0x33bd05(_0x198b73);},'fNIEs':function(_0x105770,_0x14c4fd){return _0x105770+_0x14c4fd;},'eGBAa':function(_0x537f74,_0x47f241){return _0x537f74===_0x47f241;},'XXVjz':_0x578932('Be0L',0x251,0x201,0x221,0x10c)};function _0x227315(_0x31a30f,_0x46b2e5,_0x1e846f,_0x26b07a,_0xc596d2){return _0x2aec(_0x26b07a- -0xe5,_0xc596d2);}function _0x578932(_0xa0cc77,_0xbee5d6,_0xf3df74,_0x39e7cc,_0x480769){return _0x2aec(_0xf3df74- -0x5,_0xa0cc77);}function _0x319371(_0x195a39,_0xe3ecf9,_0x55ed9a,_0x272972,_0x557199){return _0x2aec(_0xe3ecf9- -0x19e,_0x55ed9a);}function _0x28e6b4(_0xfec718,_0x13222b,_0x3f258a,_0x57da62,_0x21020c){return _0x2aec(_0xfec718-0x17f,_0x21020c);}let _0x21ef9a=!![];return function(_0x2d2d4e,_0x2d7a71){function _0x961c32(_0x4600eb,_0x1f303e,_0x1addde,_0x4c80d7,_0x38888c){return _0x319371(_0x4600eb-0x138,_0x4600eb-0x160,_0x1addde,_0x4c80d7-0x1e4,_0x38888c-0x1b5);}function _0x582d95(_0x48eb59,_0x3c25d6,_0x6ce536,_0x2982,_0x1d6c5b){return _0x28e6b4(_0x48eb59- -0x5e,_0x3c25d6-0xf3,_0x6ce536-0x38,_0x2982-0x1e5,_0x6ce536);}function _0x4a7441(_0x3d7d29,_0x3672c7,_0x4102ee,_0x4b41a0,_0x3ba9a8){return _0x28e6b4(_0x3d7d29-0xda,_0x3672c7-0x39,_0x4102ee-0xe5,_0x4b41a0-0x16,_0x3672c7);}const _0x227360={'qfmzV':function(_0x1de41c,_0x206ecb){function _0x589d0c(_0x32a96c,_0x3a102c,_0x40232c,_0x2db9cf,_0x509609){return _0x2aec(_0x509609-0x377,_0x3a102c);}return _0x519d0e[_0x589d0c(0x652,'foz8',0x713,0x56e,0x60b)](_0x1de41c,_0x206ecb);},'UHXSv':function(_0x4c4d12,_0x31bd2c){function _0x2b2c4b(_0xf1b2e,_0x17551d,_0x2f8655,_0x969f69,_0x3736a6){return _0x2aec(_0x2f8655-0x36d,_0x3736a6);}return _0x519d0e[_0x2b2c4b(0x5a1,0x547,0x5a7,0x4a2,'Jp$j')](_0x4c4d12,_0x31bd2c);},'fhVEH':function(_0x37cc42,_0x5eb9fd){function _0x589002(_0x3d88ee,_0x38db7a,_0x2860be,_0x498216,_0x5da43b){return _0x2aec(_0x38db7a- -0x1b1,_0x3d88ee);}return _0x519d0e[_0x589002('vmu%',0x205,0x26e,0x2c5,0x29c)](_0x37cc42,_0x5eb9fd);},'flvKE':_0x519d0e[_0x582d95(0x430,0x34c,'vfmL',0x4f2,0x4da)],'nkUPQ':_0x519d0e[_0x582d95(0x4a7,0x4eb,'Vl9M',0x4f6,0x544)],'MtjAw':function(_0x5dda13,_0xa9384d){function _0x30982b(_0x13fc2f,_0x52a570,_0x28b491,_0x38120c,_0x308ffd){return _0x961c32(_0x28b491-0x89,_0x52a570-0x10c,_0x52a570,_0x38120c-0xc2,_0x308ffd-0x147);}return _0x519d0e[_0x30982b(0x2a4,'RGSH',0x33d,0x2db,0x2c6)](_0x5dda13,_0xa9384d);}};function _0x1534cd(_0x24dec9,_0x35e664,_0x2ef007,_0x38bb59,_0x41addf){return _0x578932(_0x41addf,_0x35e664-0x1b1,_0x38bb59-0x10e,_0x38bb59-0x1c,_0x41addf-0xe7);}function _0x2d7a26(_0x26cb82,_0x6be693,_0x7e9e97,_0x2f934a,_0xf20534){return _0x28e6b4(_0x7e9e97- -0x2f0,_0x6be693-0x2f,_0x7e9e97-0xdb,_0x2f934a-0x197,_0x6be693);}if(_0x519d0e[_0x961c32(0x1da,0x16c,'b9E&',0x208,0x18e)](_0x519d0e[_0x582d95(0x324,0x35d,'b]Ex',0x21b,0x39a)],_0x519d0e[_0x582d95(0x30e,0x2fe,'^8T%',0x3d1,0x29a)])){const _0x52dcb9=_0x21ef9a?function(){function _0x28cc8e(_0x14aa1f,_0x1f38af,_0x3b885d,_0x1d1a43,_0x572b15){return _0x4a7441(_0x1f38af-0x38,_0x1d1a43,_0x3b885d-0x18a,_0x1d1a43-0x122,_0x572b15-0xf5);}function _0x228fd6(_0x1d8d4d,_0x4db600,_0xd68133,_0x3b8e9e,_0x12754f){return _0x961c32(_0x1d8d4d-0x2ab,_0x4db600-0x2b,_0xd68133,_0x3b8e9e-0xc,_0x12754f-0x1db);}function _0x5d1717(_0x2e55cb,_0x380e1c,_0x117798,_0x331143,_0x220556){return _0x961c32(_0x220556- -0x125,_0x380e1c-0xbf,_0x380e1c,_0x331143-0x3c,_0x220556-0x195);}function _0x33f694(_0x4d6c3a,_0x4eb749,_0x1cb204,_0x2cc5a5,_0x9b7f31){return _0x2d7a26(_0x4d6c3a-0x197,_0x2cc5a5,_0x9b7f31-0x226,_0x2cc5a5-0x1,_0x9b7f31-0xb7);}const _0x19281c={'WAGpn':function(_0x14f491,_0x2b9e3a){function _0x282dcc(_0x3bf15b,_0x192d54,_0x57803f,_0x1d536e,_0x2f6062){return _0x2aec(_0x1d536e-0x3ce,_0x2f6062);}return _0x519d0e[_0x282dcc(0x605,0x743,0x6cb,0x65b,'LlQn')](_0x14f491,_0x2b9e3a);},'CczcH':function(_0x58c803,_0x2eb4b4){function _0x3afa64(_0x1e7394,_0x4d66ba,_0x6a875e,_0xbf2245,_0x36ab53){return _0x2aec(_0x1e7394-0x3dd,_0xbf2245);}return _0x519d0e[_0x3afa64(0x650,0x646,0x56c,'Vl9M',0x6cf)](_0x58c803,_0x2eb4b4);},'IAnqt':function(_0x23039e,_0xe45c92){function _0x3056ed(_0x43918e,_0x42fb83,_0x146a6a,_0x4e0e6e,_0x3b3458){return _0x2aec(_0x42fb83-0xe6,_0x3b3458);}return _0x519d0e[_0x3056ed(0x251,0x305,0x289,0x3b8,'b]Ex')](_0x23039e,_0xe45c92);},'vZInp':_0x519d0e[_0x28cc8e(0x703,0x604,0x57a,'7P!1',0x5de)],'OjqJI':_0x519d0e[_0x28cc8e(0x5f2,0x51b,0x4ba,'LlQn',0x4b4)],'taXTi':function(_0x506a6f){function _0x5b8536(_0x4154c8,_0x55e2e2,_0x4b9a98,_0x570d5b,_0x127a9f){return _0x28cc8e(_0x4154c8-0x1c,_0x570d5b- -0x167,_0x4b9a98-0x6a,_0x4154c8,_0x127a9f-0x14d);}return _0x519d0e[_0x5b8536('a$c[',0x408,0x3ab,0x435,0x369)](_0x506a6f);}};function _0x419210(_0x4568a9,_0x13e205,_0x4bb80c,_0x443536,_0x464dc0){return _0x961c32(_0x443536-0x71,_0x13e205-0x96,_0x464dc0,_0x443536-0x185,_0x464dc0-0x31);}if(_0x519d0e[_0x228fd6(0x534,0x526,'2pFV',0x581,0x515)](_0x519d0e[_0x33f694(0x20d,0x2e7,0x2ff,'!82x',0x303)],_0x519d0e[_0x228fd6(0x43b,0x48f,'7Cc3',0x3df,0x513)])){if(_0x2d7a71){if(_0x519d0e[_0x28cc8e(0x6b9,0x60e,0x628,'E9nR',0x70f)](_0x519d0e[_0x5d1717(0x10f,'a$c[',0x2f3,0x2d6,0x201)],_0x519d0e[_0x228fd6(0x4d8,0x484,'ggMe',0x536,0x3e8)])){const _0x3459dc=_0x2d7a71[_0x5d1717(0xd2,'M8uR',0x22a,0xe8,0x130)](_0x2d2d4e,arguments);return _0x2d7a71=null,_0x3459dc;}else{let _0x25f0e9;try{_0x25f0e9=_0x227360[_0x419210(0x3b7,0x374,0x2d8,0x333,'e7Y7')](_0x8a4007,_0x227360[_0x419210(0x333,0x2f6,0x3fa,0x3ab,'(cMV')](_0x227360[_0x5d1717(-0x5c,'vmu%',-0x57,0xac,0x7c)](_0x227360[_0x33f694(0x29a,0x2a7,0x323,'dUjt',0x2f6)],_0x227360[_0x5d1717(0x15b,'b]Ex',0x1af,0x56,0xc5)]),');'))();}catch(_0x522998){_0x25f0e9=_0x1d20c6;}return _0x25f0e9;}}}else{let _0x2a2b35;try{const _0x1d204f=_0x19281c[_0x33f694(0x398,0x2d0,0x3f7,'@bNO',0x31c)](_0x403c10,_0x19281c[_0x33f694(0x20f,0x360,0x24e,'(cMV',0x2e4)](_0x19281c[_0x33f694(0x276,0x373,0x1f4,'e7Y7',0x29f)](_0x19281c[_0x419210(0x2fa,0x2af,0x2eb,0x367,'RGSH')],_0x19281c[_0x5d1717(0x28,'@3zA',0x1d2,0xbd,0xfe)]),');'));_0x2a2b35=_0x19281c[_0x5d1717(0x217,'8Grf',0x15a,0x89,0x177)](_0x1d204f);}catch(_0x5cfc22){_0x2a2b35=_0x543f21;}_0x2a2b35[_0x419210(0x312,0x300,0x24a,0x288,'ms66')+_0x28cc8e(0x471,0x43b,0x465,'dUjt',0x398)+'l'](_0x47dd24,-0xc78*0x1+-0x551+0x2169);}}:function(){};return _0x21ef9a=![],_0x52dcb9;}else _0x2f2779=_0x227360[_0x2d7a26(0x1b6,'J0F$',0x21d,0x12e,0x197)](_0x5895cf,_0x227360[_0x1534cd(0x35f,0x232,0x1d3,0x2cc,'3yp6')](_0x227360[_0x582d95(0x2fc,0x2b6,'9bUj',0x3cb,0x324)](_0x227360[_0x1534cd(0x227,0x3b4,0x1fe,0x2bf,'vmu%')],_0x227360[_0x2d7a26(0x12,'3yp6',0x116,0x120,0x6a)]),');'))();};}());function _0xc518b8(_0x3b20ec,_0x1f66f2,_0x417a1f,_0x5dcf49,_0x229bd0){return _0x2aec(_0x1f66f2- -0x14a,_0x417a1f);}const _0x239065=_0x180d12(this,function(){function _0x444cf7(_0x48d978,_0x9a83bc,_0x26d3ea,_0x3195e2,_0x2fee51){return _0x2aec(_0x48d978-0xa4,_0x3195e2);}const _0x40e79e={'FtMcl':function(_0x320322,_0xb770af){return _0x320322+_0xb770af;},'lRqyn':_0x444cf7(0x33b,0x2c5,0x287,'!82x',0x36a),'ABAdQ':_0x155deb(0x614,0x558,0x542,'E9nR',0x4c2),'bSVxg':_0x444cf7(0x39e,0x2a9,0x2c5,'Nx%g',0x358)+_0x155deb(0x3c8,0x3b5,0x436,'#r%A',0x3ee)+'t','qrVZO':function(_0x34203e,_0x3f4019){return _0x34203e===_0x3f4019;},'MuXoZ':_0x525806(-0x55,0xab,-0x4d,0x4d,'LlQn'),'USaMb':_0x4279f7('af!Z',0x534,0x597,0x689,0x57e),'dbpvI':function(_0x531801,_0x5e31b5){return _0x531801!==_0x5e31b5;},'INsGd':_0x444cf7(0x31c,0x351,0x29f,'G!u$',0x3aa),'VpiiK':function(_0x2c0031,_0x5e45ce){return _0x2c0031(_0x5e45ce);},'zxQUO':_0x444cf7(0x30e,0x288,0x316,'Be0L',0x29d)+_0x444cf7(0x43c,0x460,0x370,'vfmL',0x4b3)+_0x4279f7('(cMV',0x657,0x660,0x744,0x6a8)+_0x525806(-0x70,-0x57,-0x68,-0x22,'!l05'),'pUEmY':_0x444cf7(0x3f1,0x39a,0x3b8,'Nx%g',0x346)+_0x4279f7('E9nR',0x6a7,0x6dc,0x5d3,0x764)+_0x283d13(0x140,0x1e4,'D9V[',0x188,0xa1)+_0x4279f7('N8bu',0x5ef,0x58b,0x561,0x682)+_0x4279f7('@3zA',0x776,0x725,0x77a,0x7d5)+_0x4279f7('M8uR',0x5f7,0x580,0x62f,0x62e)+'\x20)','nOnwT':function(_0x5b0ef3,_0x193894){return _0x5b0ef3===_0x193894;},'cQeFs':_0x444cf7(0x258,0x1bf,0x308,'(04E',0x192),'RZsXI':_0x525806(0x125,-0xae,0x54,0xa2,'a$c['),'SjlEY':function(_0x16980f){return _0x16980f();},'TQLTb':_0x525806(0xe0,0x1f0,0x151,0x201,'9bUj'),'QVXCP':_0x444cf7(0x31e,0x338,0x32b,'M8uR',0x33a),'qMnrj':_0x444cf7(0x369,0x2e4,0x39e,'!l05',0x2e0),'xZpkQ':_0x444cf7(0x42d,0x350,0x4a2,'rXj[',0x4e5),'orsBX':_0x283d13(0xf6,-0x84,'dUjt',0x60,0xaf)+_0x283d13(0x1ed,0xc2,'!82x',0x1b4,0x1ba),'pPIVi':_0x444cf7(0x2c7,0x2c4,0x30a,'dUjt',0x261),'mEFfy':_0x155deb(0x469,0x47a,0x4a5,'Be0L',0x532),'YZWDr':function(_0x437da4,_0x4021ee){return _0x437da4<_0x4021ee;},'xBNoM':function(_0x579ac4,_0x7489fa){return _0x579ac4!==_0x7489fa;},'mMtVy':_0x283d13(-0x1b,0x13c,'vmu%',0xbb,0x131),'FZYGA':_0x525806(0x1d3,0x4f,0xf7,0x1dd,'(cMV')};function _0x155deb(_0x4ec49f,_0x426fa,_0x2d178e,_0x3c2302,_0x1646a8){return _0x2aec(_0x426fa-0x20e,_0x3c2302);}const _0x531342=function(){function _0x5ea0c4(_0x17bb73,_0x5c2cc1,_0x1968e3,_0x158e80,_0x1f41cf){return _0x525806(_0x17bb73-0xa8,_0x5c2cc1-0x109,_0x17bb73- -0xd8,_0x158e80-0x60,_0x158e80);}function _0x36f7d0(_0x56c80b,_0x5a166d,_0x3dc869,_0x12face,_0x3275d7){return _0x155deb(_0x56c80b-0x1,_0x12face- -0x564,_0x3dc869-0x19f,_0x56c80b,_0x3275d7-0x35);}const _0x26f503={'YBAQA':function(_0x1c85cd,_0xf11157){function _0x47e781(_0x53d831,_0x54ecb7,_0x29bfa5,_0x40e823,_0x1e8b5c){return _0x2aec(_0x40e823-0xbd,_0x53d831);}return _0x40e79e[_0x47e781('[pa(',0x486,0x28c,0x393,0x33a)](_0x1c85cd,_0xf11157);},'STQdY':_0x40e79e[_0x36f7d0('dUjt',0x97,0x105,0x28,0x14)],'dWUCN':_0x40e79e[_0x2b25e0(0x72c,'Sjjn',0x71e,0x62a,0x6fd)],'bIOEr':_0x40e79e[_0x36f7d0('2pFV',-0xe1,-0x137,-0x146,-0xd6)]};function _0x2b25e0(_0x223ec8,_0x2d1d2,_0x14fa58,_0x80451a,_0x50d7c2){return _0x155deb(_0x223ec8-0xf5,_0x50d7c2-0x17d,_0x14fa58-0x1a8,_0x2d1d2,_0x50d7c2-0x8c);}function _0xc1e1fd(_0x4494c5,_0x308785,_0x58a2c6,_0x221071,_0x3c0bad){return _0x4279f7(_0x3c0bad,_0x308785-0x10f,_0x58a2c6- -0x626,_0x221071-0x1a5,_0x3c0bad-0x7a);}function _0x4fdcf3(_0x587061,_0x198a98,_0x2537bf,_0x2332a7,_0x5bc2e9){return _0x283d13(_0x587061-0x1ab,_0x198a98-0x9a,_0x198a98,_0x2332a7- -0x20b,_0x5bc2e9-0x89);}if(_0x40e79e[_0x5ea0c4(-0x76,-0x1c,0x6f,'kSnD',-0x167)](_0x40e79e[_0x2b25e0(0x74d,'Urb5',0x6f1,0x6ea,0x6e5)],_0x40e79e[_0xc1e1fd(-0x1b4,-0x108,-0xfe,-0x72,'Jp$j')]))return _0x2b9f8b;else{let _0x30d85b;try{if(_0x40e79e[_0xc1e1fd(-0x8c,0xaa,0x1d,0xbc,'$7[D')](_0x40e79e[_0x36f7d0('a$c[',-0x108,-0x6d,-0x10b,-0x165)],_0x40e79e[_0x4fdcf3(-0x9b,'$7[D',-0x107,-0xcd,-0x1a0)]))return!![];else _0x30d85b=_0x40e79e[_0x5ea0c4(-0x17e,-0x227,-0x209,'Nx%g',-0x9e)](Function,_0x40e79e[_0x5ea0c4(-0x26,0x43,0xc2,'Nx%g',0xae)](_0x40e79e[_0x36f7d0('7P!1',0x30,0x23,0x4a,0x14f)](_0x40e79e[_0x36f7d0('[pa(',-0x15b,-0x17b,-0x152,-0x245)],_0x40e79e[_0x4fdcf3(-0x6d,'G!u$',-0x77,-0x78,-0xeb)]),');'))();}catch(_0x324455){_0x40e79e[_0x4fdcf3(-0xb,'foz8',-0x111,-0x46,-0x66)](_0x40e79e[_0xc1e1fd(0x128,-0x69,0x89,0x173,'^8T%')],_0x40e79e[_0x5ea0c4(0x58,0x48,0xa3,'Vl9M',0x128)])?function(){return![];}[_0xc1e1fd(0x167,-0x2a,0x88,0xb,'a$c[')+_0xc1e1fd(0x1e4,0x122,0xdb,0xb3,'RGSH')+'r'](_0x26f503[_0x36f7d0('G!u$',-0x265,-0x235,-0x178,-0xc5)](_0x26f503[_0x4fdcf3(-0x1d4,'Be0L',-0xa8,-0x167,-0x165)],_0x26f503[_0x36f7d0('N8bu',-0xe8,0x5a,-0x12,0xf)]))[_0x4fdcf3(0xed,'b]Ex',0x80,0x15,0x21)](_0x26f503[_0x36f7d0('E9nR',-0xe7,-0xbe,-0xb7,-0xf7)]):_0x30d85b=window;}return _0x30d85b;}},_0x53b35b=_0x40e79e[_0x155deb(0x3ed,0x424,0x36b,'ACml',0x364)](_0x531342);function _0x4279f7(_0x25e201,_0x24315c,_0x4e2277,_0x4236a5,_0x65f0ab){return _0x2aec(_0x4e2277-0x380,_0x25e201);}const _0x32bfd8=_0x53b35b[_0x283d13(0x1a0,0x227,'o^)@',0x13b,0x9a)+'le']=_0x53b35b[_0x283d13(0x13a,0x93,'ZIVR',0x122,0x20d)+'le']||{};function _0x525806(_0x236fc4,_0x2ee733,_0x3b607a,_0x25fc63,_0x59bf12){return _0x2aec(_0x3b607a- -0x260,_0x59bf12);}const _0x17030b=[_0x40e79e[_0x283d13(-0xb,0x52,'b]Ex',0x27,0x45)],_0x40e79e[_0x4279f7('D9V[',0x6c7,0x70c,0x7f6,0x618)],_0x40e79e[_0x4279f7('8Grf',0x5ac,0x57b,0x632,0x573)],_0x40e79e[_0x4279f7('vfmL',0x82a,0x735,0x7f1,0x6f8)],_0x40e79e[_0x155deb(0x2fd,0x3e0,0x442,'3yp6',0x373)],_0x40e79e[_0x444cf7(0x309,0x365,0x3e6,'#r%A',0x3a9)],_0x40e79e[_0x155deb(0x4cc,0x3fe,0x40f,'dUjt',0x3a3)]];function _0x283d13(_0x6e96a1,_0x577a48,_0x1d98eb,_0x4a6628,_0x479569){return _0x2aec(_0x4a6628- -0x18e,_0x1d98eb);}for(let _0x58406f=-0x5f*0x1d+-0x791+0x1254;_0x40e79e[_0x283d13(-0xa5,-0x4e,'9bUj',0x45,0x8e)](_0x58406f,_0x17030b[_0x525806(-0x109,-0x6a,-0xa5,-0x11,'Sjjn')+'h']);_0x58406f++){if(_0x40e79e[_0x525806(0x103,0x157,0x75,0xf,'M8uR')](_0x40e79e[_0x283d13(0x2fd,0x199,'N8bu',0x210,0x12f)],_0x40e79e[_0x283d13(0x40,0xcd,'e7Y7',0xe6,0x181)])){const _0x3c7aa4=_0x180d12[_0x283d13(0xd,0x126,'!l05',0x29,-0xd7)+_0x155deb(0x508,0x591,0x68f,'e7Y7',0x4f3)+'r'][_0x525806(-0x128,-0x15,-0x2d,0x4a,'LlQn')+_0x4279f7('D9V[',0x58c,0x57f,0x50c,0x50b)][_0x283d13(-0x79,0x5c,'M8uR',0x6e,0x156)](_0x180d12),_0x3d6e9b=_0x17030b[_0x58406f],_0x274bab=_0x32bfd8[_0x3d6e9b]||_0x3c7aa4;_0x3c7aa4[_0x283d13(0x113,0xbd,'b]Ex',0x14a,0x119)+_0x525806(0x21e,0xe0,0x116,0x12d,'o^)@')]=_0x180d12[_0x155deb(0x4d3,0x4de,0x46b,'Jp$j',0x485)](_0x180d12),_0x3c7aa4[_0x283d13(0x19e,0xf3,'Urb5',0x153,0x235)+_0x283d13(0x304,0x15c,'e7Y7',0x201,0x23d)]=_0x274bab[_0x525806(0x1c9,0x173,0xfe,0x6e,'Jp$j')+_0x4279f7('2pFV',0x4a5,0x567,0x65a,0x652)][_0x155deb(0x50d,0x404,0x4a5,'Vl9M',0x46a)](_0x274bab),_0x32bfd8[_0x3d6e9b]=_0x3c7aa4;}else _0x4b7efc=_0x172488;}});_0x239065();function _0x5df8(){const _0x4ac6a6=['i3SeW4q4','bLTLgca','W7PoW6q1WQy','W5ZdG8oBWO9p','WP1KmmoRzG','W6ldJSoZWP9g','CHtcNmo9W4q','ALTaWOKs','tIhdVmoeW7C','WQhcQSk/W651xmkwWOxcQ8kF','WPxcKHpdUMS','zmkvzNNdNa','emkvBN3cQW','WRddQmoSWQ5x','x8oziHVdTW','nSoaBLu','qmoHWRbTAa','W5NdRmowwCk0','W5SZWPNdUH8','itJcUmoXWRJcNSo8W6tdHq','WRCrlWi+','WPTSsKu7','B8k/W5/dOSoI','ntJcVSkDFq','vqxcHM7dOG','rsJcS33dGa','W4WOWPpdKW8','Cmk9WQHaW6m','WQBdSCoZW7zu','n3e5W7W0','WP9jE2Sv','jINdQmoxW50','C17cTmoEW5K','WOxcSSkRvmkI','fmkAWONcNLC','WQyaWOXKnW','mSkCW7PbWQy','WOtdQMxdQ8o5','BCoZmZFdPa','tvSthCoj','W4KhWRFdMX0','whhdT8k4BG','gt/dVSoH','WOHnyfPk','nCo7WRZcMmkpyCkEq8kiW5NcQIq','CJb9W5ldOG','AvRcM8kSWPu','hZxdLColW5C','hwrsjY8','x01fD8kr','WRddI8ogW71g','hItdK8oxW4S','W6uZyCklWQS','WQC4WODg','hwj7ia','hSoMWP3cVaq','jg82W5CW','mSk8W7tcPSkF','z8kOW7hdHmox','fmo8W6f0WPC','ENBdJmotWOy','ktZcSSkoW5JdPmoDW7/dSSodWP0Q','W77cV3LY','WQBdNxpdPCo3','cMrHicm','tX3dV8o9W4C','WO7cTW7cRbe','hxHeaHW','Er7cS2ddIa','W47dKKtcUhSKs8ksFmolW5v5','WQhcHZBdHG8','WQRcMmk3tmku','WQZcQrRdMqi','W4RdKCoVWRXW','x05YASk+','nsBcU8olW6e','bSoyW6TxWOa','WRRdI3yFla','mSk+WR/cKNm','a8k5W4ZcR8k3','W7FcQ2HYWPu','gmkakmkcnmkSzgGYtX/cRa','WP/cGCoTWQD1','WOz8aSogBG','nmodW4FcLWu','xmoyjcy','W5pcTmod','WQhcIbhcVWK','d8kNWRtcVNS','rZPjW5tdUa','w8oskcddTa','W6i5u8knWRO','r8oxWRDFwq','W6JdMCkTl8oG','jCopW6FcSa','W5pcTmonfa','u1DBymk6','W7RcUxbS','nNy7W7Gz','W6u5qCkl','WRtcHtVdQIu','ySkAWQldSbddV8ofq2W/','sMLXWOe6','lSkiW7xcNCkB','ttBcT8oRWRW','emoaxfNdTW','nSokqN4','aSkgWOhcHg0','cWNcPCoUW40','zNxcQ8kDAW','zKRdK8kisW','WR3dR0tdHmov','yXVcQvBdQW','W7RcNg5UWO4','vmoVnYRdRG','nSkqWPxcGKe','F0rJWPez','W40OWP3dGqi','zYFcSMW','DgTYtmky','dmkiW4NcJKW','bL5wzSk/','W5LWW6OPWRK','Dmk+W6BdMCox','WPe9WPL3hq','ccldK8orW5C','rIJcTuNdMa','mK0eW5m8','WQFcSctdIXm','W4WEWRldGZS','CahcMLhdRG','B3b2','W5j+W44fWP0','wNRcUCoMW6S','sCoLaHRdKa','DhaXtmkF','W7SNWRldVb8','mtlcSmoTW7i','Bmo6WP5wxq','uvPLWPet','W7ZcUSkHWRXx','W53cRSowgHi','W6xdKSk4l8oH','nZ3dSSouW4G','WORcPCkDySkJ','E8orvSohxW','lxuxW4ih','WQlcGSk4BCkt','jSkLW6RcQ8kA','BSoaWRnztG','WPrgnmoAwW','FNRdRSovWPG','c8kKWQhcLfe','DmkLWQxdMCoq','W6mYeSklWRe','o8kpW5HlWOa','AaNcKa','W5ddKX/cMq0','k8oYW7hcTXy','oSorWRX7WPe','WOFcMmkttSkm','rY/cNmooW7S','W7aSqSktWQa','W4JcTmkefdC','zmonWRSi','WR3dLmor','omozWRBdRw8','W7jrW54PWRS','eCoRW4/cM1W','W6RdGmo5WRfZ','WP/dKfe3WOy','uNHKWQOn','W4vqqmoSWR4','E8oSWO52AG','wNlcOmkkAW','WR7cVCoFWP5L','WPRdL2SHjW','tmoyncxdOq','WQjjweyv','WP0jWRbXdq','z8k7W7xdGCob','W48VWPhdGqi','WQVcG8kXt8kl','W7VcIu50WQq','fZ/dMmo9W7a','WRn9mmoxBG','W4BdGSo6WO9g','dCoMW6LmWQW','W4unFSkRWRS','WP/dSM45WRa','W6xdLCk3nCo7','WOZcVSoOWOnR','wZJdK3BdOW','yHdcUmo3W6m','z05EWOiF','WRBdGx7dTq','ltRcUmkcW5/dP8kgW5BdRmo2WOmneq','WONcQGRcQXa','wJSTE2aYhCkfW45HjJW','eSkvEwNdMW','xaJcK8ou','WPZcNCkkBSke','WPNdNhRdKmoV','WQNdTsvHW40','nCkkW6XcWP0','r0NdPCk1EW','WRdcSSkRtCkH','W5KeWQJdGI8','EJhdOZhcMW','mCoaAwJdLa','WO/cOSkyBmkN','WQr9hmolva','W49EW78fWQe','W6ZdRSohxCkA','rCoTWP94AG','xtdcVSovW68','qa/cGSoQW5O','WRVdMMpdK8oa','WOJdOCoHW5vn','l8kkWOVcTM0','WQVcLwxdNe0','i1acW70q','jHdcNSoLW54','WQNdNuizWQi','bGnCs8oR','BLLgWQ8j','WOtdS8oUW4jj','hv1YfJW','W73cGZNcUSkX','WRj7tNKJ','WP/dTK43WR0','lrzNtCo1','eSk0W5pcVCke','qqtcICoyW50','ESo4yCo8EW','fmkAWPlcG1C','DGJcUmoqWPq','vq5tW73dJa','r8ozFa','WQVcVJ/cQbq','W7ddIY/cGWS','t19/sCkd','WPVcVY3dOaK','WRn3o8oRsq','WP0jWR9ipG','xCofjtBdSa','WOlcGmoz','vCo4adxdUq','u19LWOae','WQFcUmk3smk0','W5BcSKLbWQu','iYFdUCoEmxldQWrAh8odW5S','WQnuFKek','W6jnW5m5','W680WQ/dJXq','W6JcKSoWzG','cmoWW4FcPWq','WOHwyvSw','bCkjW6raWP4','xSkfW43dQa','qYVcSK3dIG','AWhcU0hdUq','WOlcNWZdRq','vCkFWOhcPCkq','qCo8gWpdPa','hYxdGSokW4O','W4KezmkvWQm','WQhdG1CMgG','uCkUW4FdT8o5','DavkW5pdSq','DflcJ8o5W7W','D1FcRmoLW7q','W6tdPapcHYe','WRFdNh/dO8kW','yKOgW6al','W7RdTCoIWPjp','dmkZW7LRWOy','qmkFmSkt','W6xdL8k0k8o8','tmoKtColAG','FsBcOmonWPe','qWNcLgFdSG','fmoyW6pcNtm','sg3cT8o4W4G','W7zBE8o6WOi','WRtcSXlcNdW','W4JdTJxcLqe','vMhdOCkDyG','WO3cQCkEaCo+bCoMWQX0wCoAW45Y','bbFdTCoRW6G','l8ktWQhcTKy','WObMmSogCW','ufldJmkUkW','mgbdprO','W5OyyCklWPC','rcRcNMRdGq','Cq9VW5pdTG','aLOmxmoV','tmoCjd/dPq','B05sWPa','ECkNWQLMWPPblwii','W4b5ymoqWR0','qmoeB8obEa','W783z8kVWOG','WP8oW41/hW','EmoKiGtdLa','bCkaWOdcQMe','t8oZFSoLyq','W7hdTCoNWQLw','ESotjr/dIG','hslcH8oEW7m','mSo1AKZdUq','WP/cGCo4WRP/','vqTQW5/dGW','iCoyW7VcScG','jCkJWP7cU0e','WP/cI8onWQC','AmoRWQ3dI8on','W6XgW78RWPW','WRfFFw4S','eu57kZu','WO3cOmo3WPz0','mmk0W4RcPmky','W4SYWRJdNbu','W43cL2zpWPy','yCoyhcFdRG','tSo4W5xdHr3cGmoFWPuPEXim','WOpcQ8o7WR9L','xSormbJdHq','W7PLWPahWOS','WRJdLCogW6rl','xb3dLCkMW6m','W7TzWPm+WRS','WRxdMgddVCoH','fHhcICoSW5C','W5RdHG/cGXq','WP3dLM4NWQm','jCkfr1BdHq','pSk7WPtcQKC','WRaYWRH1lq','iCoGW6fnWRC','pxL1jGa','WRmUv8klWQW','vHxcV2ldLG','tMtcLSoJW4u','FcxcH03dOW','W71LW5esFmkqWQ8UW6D/iIq','hCkQW6ng','fbzyBSo8','wt3cNSotWQi','cCkkW7esbG','wCoFCSoFAa','WRldLwe','mSkKW57cMmk8','nmo/W5DiWRy','tCozhHxdTq','WQhcLdtdGs0','eXX/u8oG','pmkpWPpcULi','W6i1wmkPWQa','sCkHW7tdP8oX','W6VdKcxcGW','CuHcWPus','DeZcHCoP','zudcG8k5yq','DSoyq8oKAq','Bc7cSCowWR8','t1PMWOqJ','bN1Iod4','DdPpW47dQa','W6pcLmoWkHm','CI1AW5JdVW','e8kCWR7cIwq','DI7cTCo5W7G','hCkhlSkapmkOpLyuEdxcV8o6','At1sW5G','W4NcQuPQWO0','jmkKWO/cQ3u','W5jjW7aiWOi','qeriF8k2','wdtcO2tdNG','qCofBmoxwa','WO3cLJdcObq','WQPQweC0','WPpcRa7cRq8','s8knW5hdOG','q8oaAdddRW','ocFdTmoeWPK','AIBcS1NdOq','vLpcNSo1W60','DJpcGhVdGa','W6RcQ8oYcJi','WPiaWQzMdG','WQRdJsdcO2m','W7Lqq8oNWQq','nW/cHCoJW74','muRdJKRcLq','WRJdShKxWOC','WRRdG0xdGCoj','WPNdTSoLW7zf','WOOMWP5Sna','cmo+W4pcScO','W53cOLbjWPi','WOnwzgap','a8ogW4hcJci','u8kOW43dHa','CbfJW5FdVq','wKddOCoeWOG','t37cP8o1W4S','WP7dH309WQe','xCkCW5pdOmob','WOBcPCk6Amkm','FdbcW7JdJW','BSoDcaddPW','dw52oW','W4LlALWx','WO7cIrhcKIi','W6pdNCkZn8og','rZfAW57dQa','w8kfW43dQCox','B8opdHRdRG','W57cLrddNeq','W7VcKvnfWPi','AdXpW5ldTq','pM5ChXS','AgHjWRaT','WR3cVWZcNYS','aCk7WR/cGuq','yCoLadddLq','W4ddQSoRymke','W5L+W64+WPC','FqpcT1pdPG','WRRdPehdHmo/','W7BdKr/cGXy','WQDVxCkoWQVdS3ldTa','nsjbrmo8','WQBdSSoSW7L1','WRNcG8oKWPzp','zgvjWR0','WPf8p8obCW','W5f1W5FcLq','g1HsaXu','BqhcU8oFWPK','o8k6WPpcO08','zKldGCk9tq','W7jssmoY','cbffra','CSkUW7BdMq','WPtdG8o1W4LQ','WRFcO8k4t8kL','k8owpWJcKG','aCkHWONcI1O','e3OnW4y4','xmosB8ogFW','a8kWW4VcPa','fYDwySo2','W7CPxmkCWQ0','yJdcL0ldVa','zfFcHCo6W7y','bbXcvmoM','W6/dLmk/kq','FwFdTSk0BG','B8oatCosvq','tCkHW6ZdNSo1','iCokC1ldLq','vemzfmkJtSoakSkUW4byWOr+','mdlcICopW44','sxVcHSolW5S','ACkQW5ZdT8os','pZhcJCorW4i','pSoiW73cPW','WONcH8oqWRC','WPRdJ0tdLCot','hCkRW6qsW54','WPLmBfWn','tCooidRdJG','rmkUW63dO8o1','WP3dJ0Sqoq','vu3cQ8oFWOu','W44dqSknWRy','CsVcLmonWPa','amkLW5jMWP0','sgHJWRC9','nCkOW6DGWOy','WOldO0aqaa','WR7cOSoyWRHR','WPhcNSk/q8kk','mclcICouW5q','c8kKWRtcIvS','WR55pmoqza','tupdPSoDWOa','umoYcb7dSq','B3bHtCkd','CM/cMmoDW7O','W5nCDCoOWRq','W7GYvq','wSkRW7BdTmop','g8kLWOdcSLS','W4DyFSoUWRK','W4NcV8ofeJW','W5/dJmoWzCkH','W6ldRCoZqCk1','W7DmW5qXWRe','BSoBlsRdKG','WRFcOSk0xCkI','W60WWRpdOdS','sJxcMSoqWOC','WPJdHLtdRJy','jCoFW6tcSc0','W7PPW5KXWR8','iConFeJdLa','ocddK8oZW7m','tSobft7dRa','rXtcSmoQW40','kCo9W5nrWQG','vSoEmJRdRW','ymohW7/cP8ky','dh99oW0','z8kzW7VcTtxdGmoqxq','D3H8qSkH','sWD8W5hdQG','b3LApti','oSoTAMNdGa','utBcI07dNq','WO3cKCkAy8ky','W7JcM3vrWQu','EN7dMSozWPS','E2ddRSofWPG','W5NdV8osxmkI','CcBcONldTW','pmkKWOBcPe8'];_0x5df8=function(){return _0x4ac6a6;};return _0x5df8();}const METABOLIC_TABLE={},romaAge=0xaf8+-0xfb8+0x271*0x2,romanAge=-0x8f*-0x16+0xb99*-0x2+0x15*0x87;function _0x29d18c(_0x4bd4a5,_0x230652,_0x1ee556,_0x2a61e1,_0x176eb0){return _0x2aec(_0x230652- -0x3a8,_0x176eb0);}function _0x2aec(_0x3f5b14,_0x4b6afa){_0x3f5b14=_0x3f5b14-(-0x1c17+-0xcbf+0x2a7d);const _0x12c7b9=_0x5df8();let _0x321ece=_0x12c7b9[_0x3f5b14];if(_0x2aec['pxYtFI']===undefined){var _0x55bb7d=function(_0x3eaa3b){const _0x426609='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x412575='',_0x4f8e83='',_0x2db9fc=_0x412575+_0x55bb7d;for(let _0x5976aa=0x8*0x4a0+-0x18ff+-0xc01,_0x374b50,_0x2309c6,_0x51d8fc=0x2605*0x1+0x1fa2+-0x1*0x45a7;_0x2309c6=_0x3eaa3b['charAt'](_0x51d8fc++);~_0x2309c6&&(_0x374b50=_0x5976aa%(-0x1693*-0x1+0x65*-0x11+0x1*-0xfda)?_0x374b50*(-0x15f1*0x1+0xaaf+0xb82)+_0x2309c6:_0x2309c6,_0x5976aa++%(0xf7b+-0x1c05+0xc8e))?_0x412575+=_0x2db9fc['charCodeAt'](_0x51d8fc+(0x6b2*-0x4+-0xebd+0x1*0x298f))-(0xb*-0x311+0x2257+-0x92)!==0x2441*0x1+-0x205+-0x272*0xe?String['fromCharCode'](0x1e0+-0x1b04+0x1*0x1a23&_0x374b50>>(-(0x1*0x18a7+-0x6d*-0x2f+0xb2a*-0x4)*_0x5976aa&-0x1500+0x11b5*-0x1+0x26bb)):_0x5976aa:-0x1b59*-0x1+-0x3ea*0x3+-0xf9b){_0x2309c6=_0x426609['indexOf'](_0x2309c6);}for(let _0x21ab82=0x1cd2*0x1+0x140e+0x1*-0x30e0,_0x424aaf=_0x412575['length'];_0x21ab82<_0x424aaf;_0x21ab82++){_0x4f8e83+='%'+('00'+_0x412575['charCodeAt'](_0x21ab82)['toString'](-0x14ab*-0x1+-0xa*0x13f+-0x3*0x2b7))['slice'](-(-0x448+0x6e6+0xa7*-0x4));}return decodeURIComponent(_0x4f8e83);};const _0x7e7d1b=function(_0x22e576,_0x1ebb99){let _0x14abb2=[],_0x51f2a6=0x1d3e+0x1044+-0x2d82,_0x363943,_0x5640e6='';_0x22e576=_0x55bb7d(_0x22e576);let _0x251e7f;for(_0x251e7f=-0x7fd+0x2*0x338+-0x18d*-0x1;_0x251e7f<0xea+-0x818+0x82e;_0x251e7f++){_0x14abb2[_0x251e7f]=_0x251e7f;}for(_0x251e7f=0x1df3+0x21*0x7d+-0x2e10;_0x251e7f<0x250c+0x1*-0x259+0x21b3*-0x1;_0x251e7f++){_0x51f2a6=(_0x51f2a6+_0x14abb2[_0x251e7f]+_0x1ebb99['charCodeAt'](_0x251e7f%_0x1ebb99['length']))%(-0x80f+-0x1f96+0x28a5),_0x363943=_0x14abb2[_0x251e7f],_0x14abb2[_0x251e7f]=_0x14abb2[_0x51f2a6],_0x14abb2[_0x51f2a6]=_0x363943;}_0x251e7f=-0xfc9+0x13a1+-0x3d8,_0x51f2a6=0x13cf*0x1+-0xa*-0x15b+-0x49*0x75;for(let _0x57eedf=-0x1*0x1e4f+-0x1727+0x3576;_0x57eedf<_0x22e576['length'];_0x57eedf++){_0x251e7f=(_0x251e7f+(0x43c*-0x6+0x1f46+-0x5dd*0x1))%(0x1935+-0x20cd+0x898),_0x51f2a6=(_0x51f2a6+_0x14abb2[_0x251e7f])%(-0x1*-0x18e5+-0x23f8+0xc13),_0x363943=_0x14abb2[_0x251e7f],_0x14abb2[_0x251e7f]=_0x14abb2[_0x51f2a6],_0x14abb2[_0x51f2a6]=_0x363943,_0x5640e6+=String['fromCharCode'](_0x22e576['charCodeAt'](_0x57eedf)^_0x14abb2[(_0x14abb2[_0x251e7f]+_0x14abb2[_0x51f2a6])%(0x9c*0x2f+0x1ca*-0x3+-0x1646)]);}return _0x5640e6;};_0x2aec['cMuwxi']=_0x7e7d1b,_0x2aec['zaPUCS']={},_0x2aec['pxYtFI']=!![];}const _0x2fa811=_0x12c7b9[-0x1936+0xc*0x151+0x96a],_0x59e793=_0x3f5b14+_0x2fa811,_0x4f11f4=_0x2aec['zaPUCS'][_0x59e793];if(!_0x4f11f4){if(_0x2aec['ZJprEE']===undefined){const _0x2b9f8b=function(_0x59e0a9){this['ctavmU']=_0x59e0a9,this['diHJsQ']=[0x8c4*0x1+-0x144c+0xb89,0xfdc+0x1fd+-0x11d9,0x25*-0x9f+0x1d54+-0x19*0x41],this['HmfXQI']=function(){return'newState';},this['qDCEjf']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['sVEVUD']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2b9f8b['prototype']['fvcKLL']=function(){const _0x50980e=new RegExp(this['qDCEjf']+this['sVEVUD']),_0x1532b1=_0x50980e['test'](this['HmfXQI']['toString']())?--this['diHJsQ'][-0x2*-0xc02+-0x15a6+-0x1*0x25d]:--this['diHJsQ'][0x179a+0x1*0x16c9+-0x2e63];return this['zwPmHh'](_0x1532b1);},_0x2b9f8b['prototype']['zwPmHh']=function(_0x45fd31){if(!Boolean(~_0x45fd31))return _0x45fd31;return this['uGesCu'](this['ctavmU']);},_0x2b9f8b['prototype']['uGesCu']=function(_0x15b301){for(let _0x3b21cc=-0x1*0x986+0x52*-0x21+-0x4*-0x506,_0x3dab04=this['diHJsQ']['length'];_0x3b21cc<_0x3dab04;_0x3b21cc++){this['diHJsQ']['push'](Math['round'](Math['random']())),_0x3dab04=this['diHJsQ']['length'];}return _0x15b301(this['diHJsQ'][-0xc85*-0x1+0x15db+0x44c*-0x8]);},new _0x2b9f8b(_0x2aec)['fvcKLL'](),_0x2aec['ZJprEE']=!![];}_0x321ece=_0x2aec['cMuwxi'](_0x321ece,_0x4b6afa),_0x2aec['zaPUCS'][_0x59e793]=_0x321ece;}else _0x321ece=_0x4f11f4;return _0x321ece;}const romaMaxVO2=(0x1*-0x2480+-0x1d3+0x272f-romaAge)*(0x269*-0xd+-0x2113+-0xc*-0x55e+0.205),romanMaxVO2=(0x216f+-0x12b5*-0x1+-0x3348-romanAge)*(-0x26*0xf9+-0x1*0x21aa+0x46a0+0.206);for(let i=0x2*0x26d+0x3ad+-0x887;i<=-0x1350+0x268+0x11c4;i++){let mph=(i/(0x119d+0x497+-0x162a))[_0x321bb7('Urb5',0x477,0x525,0x5af,0x520)+'ed'](0x1*-0x197c+-0x35*-0x19+0x68*0x32),mPerMin=parseFloat(mph)*(-0x4cd*0x7+-0x1*0x1f39+0x40ee+0.8000000000000007),cost=(0x153c+-0x10f3+-0x449+0.205)*mPerMin+(-0xa31+0x20b*0x8+-0x624+0.5),romaPct=cost/romaMaxVO2*(-0x175*-0x1+-0xb*0x20e+-0x1589*-0x1),romanPct=cost/romanMaxVO2*(-0x713*-0x4+0x11a7+0x6b*-0x6d);METABOLIC_TABLE[mph]={'cost':parseFloat(cost[_0xc518b8(0x27,0xf2,'RGSH',0x1a2,0x5b)+'ed'](0x20a5+0x23f6+0x4499*-0x1)),'roma':{'intensity':romaPct[_0x839161(0x587,'!82x',0x4db,0x462,0x496)+'ed'](-0xd1*0x19+-0x4ad*0x5+0x2bcb)+'%','status':romaPct>-0x1d6c+-0x217d+0x3f4d?_0xc518b8(0x69,0x151,'Be0L',0xb3,0x241)+_0x321bb7('LlQn',0x356,0x491,0x373,0x44b):_0xc518b8(0x2bd,0x21b,'Be0L',0x299,0x220)+'ic'},'roman':{'intensity':romanPct[_0x839161(0x34a,'b9E&',0x365,0x447,0x2bf)+'ed'](-0xf55+0x7*-0x2+0xf64)+'%','status':romanPct>0x1e7*0x10+-0x1ee3+0xd7?_0x839161(0x424,'ZIVR',0x351,0x2fe,0x39b)+_0x839161(0x384,'Be0L',0x40f,0x39b,0x38f):_0xdb13f(0x455,0x506,0x4ef,'foz8',0x4ba)+'ic'}};}function _0x32fb89(_0xf6fc5){const _0x4191bf={'YZScC':function(_0x4da706,_0x8809f){return _0x4da706!==_0x8809f;},'DODVx':_0x322cd8(0x63,-0x2e,0x2b,0xa2,'D9V['),'xHwHz':_0x322cd8(-0x1f3,-0x10b,-0x130,-0xe4,'ACml'),'HXBtw':_0x599ac3(0x618,0x515,'LYla',0x6ea,0x519)+_0x43d08d('8Grf',0x23e,0x203,0x27f,0x334)+_0xcdd4e3(0x370,0x3c9,0x37f,'dUjt',0x316)+')','IpWnw':_0x322cd8(-0x1c2,-0xe4,-0x199,-0xda,'af!Z')+_0xcdd4e3(0x1be,0x38d,0x2b2,'X)3w',0x24f)+_0x43d08d('Nx%g',0x243,0x2fb,0x223,0x271)+_0xcdd4e3(0x38e,0x289,0x2ec,'rXj[',0x3ea)+_0x43d08d('(04E',0x293,0x1c6,0x360,0x209)+_0x2bc490(0x532,0x4d6,'Nx%g',0x43c,0x49f)+_0x599ac3(0x660,0x701,'(04E',0x55e,0x5b6),'VnMyH':function(_0x410b2e,_0x4187ab){return _0x410b2e(_0x4187ab);},'fGUxw':_0x599ac3(0x512,0x4fc,'af!Z',0x52a,0x4f3),'RmSni':function(_0x2ddc69,_0x374d78){return _0x2ddc69+_0x374d78;},'wbYiK':_0x43d08d('!l05',0x306,0x286,0x2ce,0x2d0),'MgNvE':_0x599ac3(0x5fe,0x643,'ACml',0x64c,0x5fb),'PAlKD':function(_0x3df7f9,_0x2f562e){return _0x3df7f9(_0x2f562e);},'WeHQL':function(_0x39083b){return _0x39083b();},'wIZhJ':function(_0x4cf47d,_0x5de332){return _0x4cf47d===_0x5de332;},'fZOpE':_0x2bc490(0x361,0x4b1,'J0F$',0x452,0x3ab),'BNdgP':_0x2bc490(0x2cf,0x312,'ZZCg',0x42c,0x3b1),'YXFcU':function(_0x2b45fa,_0x4e9b95){return _0x2b45fa!==_0x4e9b95;},'MXGjp':_0xcdd4e3(0x1e9,0x169,0x265,'J0F$',0x2f6),'UNudd':_0x322cd8(0xc7,-0x43,-0xce,-0xaa,'rXj[')+'g','TlpUY':_0x43d08d('Vl9M',0x27a,0x2be,0x36d,0x366),'gtrzM':_0x599ac3(0x508,0x4bc,'2pFV',0x47a,0x5b9)+_0x2bc490(0x3ef,0x3b5,'Srbc',0x330,0x407)+_0x599ac3(0x4c1,0x493,'Srbc',0x4ea,0x51b),'PiQzy':_0x322cd8(0x3e,-0x36,0xa6,0x91,'!82x')+'er','dngOr':_0x322cd8(-0x8f,-0x175,-0x147,-0x137,'8Grf'),'tgzuC':function(_0x2a5206,_0xc81393){return _0x2a5206!==_0xc81393;},'UjtQk':function(_0x50f261,_0x40b432){return _0x50f261/_0x40b432;},'FGGvQ':_0x43d08d('ZZCg',0x1ef,0x26c,0x1a8,0x280)+'h','TXsUd':function(_0x15ae1b,_0x5149e1){return _0x15ae1b===_0x5149e1;},'JDbkA':function(_0x4aece5,_0x2f2a8e){return _0x4aece5%_0x2f2a8e;},'YPcRI':_0xcdd4e3(0x3c3,0x458,0x38a,'@3zA',0x3ac),'ExCXU':_0xcdd4e3(0x48e,0x3e2,0x394,'$7[D',0x437),'FiXhd':function(_0x4e4440,_0x5d1a29){return _0x4e4440+_0x5d1a29;},'OKRyt':_0x43d08d('Sjjn',0x190,0x8f,0x9b,0x274),'iPoKG':_0xcdd4e3(0x37f,0x275,0x31e,'ZZCg',0x2c7),'tVfXk':_0xcdd4e3(0x354,0x3f8,0x3ae,'@3zA',0x493)+'n','egjqI':function(_0x2071fc,_0x5ae36c){return _0x2071fc===_0x5ae36c;},'ZfrFN':_0xcdd4e3(0x2fa,0x2b7,0x35b,'@bNO',0x3e9),'ogFUP':_0x599ac3(0x56a,0x585,'foz8',0x530,0x664)+_0x43d08d('LYla',0x30d,0x2ca,0x360,0x36d)+'t','pTzEd':_0xcdd4e3(0x461,0x41f,0x380,'dUjt',0x359)+_0x2bc490(0x46d,0x312,'3yp6',0x462,0x368)+'+$','ZqUtx':function(_0x5889e0,_0x3315b8){return _0x5889e0!==_0x3315b8;},'udXFu':_0x322cd8(-0x63,-0x51,-0x1f,-0xc1,'3yp6'),'RuyPJ':function(_0x23aa9e,_0x31ab60){return _0x23aa9e===_0x31ab60;},'RQmcn':_0x2bc490(0x44e,0x37e,'vmu%',0x321,0x41d),'xQcXe':_0x322cd8(-0x56,-0x76,-0xaa,0x39,'N8bu'),'PqVjm':_0x2bc490(0x59c,0x571,'kSnD',0x492,0x495),'ZmSjm':function(_0x54b243,_0x2c34a5){return _0x54b243(_0x2c34a5);}};function _0x599ac3(_0x1824dc,_0x3e0b7e,_0x2037d7,_0x2c72d0,_0x22fadf){return _0x839161(_0x1824dc-0x138,_0x2037d7,_0x1824dc-0x111,_0x2c72d0-0x1c0,_0x22fadf-0xe0);}function _0x322cd8(_0x2be80e,_0x29ad41,_0x23dc6a,_0x4271fb,_0x75d226){return _0xdb13f(_0x2be80e-0x6b,_0x29ad41-0x115,_0x23dc6a-0x1c9,_0x75d226,_0x29ad41- -0x50f);}function _0x428238(_0x71ad2d){function _0x2a4133(_0x2f524e,_0x3bd3e8,_0x579bc2,_0x241729,_0x2ba7dc){return _0x322cd8(_0x2f524e-0xfa,_0x579bc2-0x5ff,_0x579bc2-0x1d0,_0x241729-0xf7,_0x2ba7dc);}function _0xc7a38d(_0x1864cf,_0x523e5a,_0x1543cc,_0x16a1c8,_0x529868){return _0x599ac3(_0x1543cc-0xca,_0x523e5a-0x15f,_0x16a1c8,_0x16a1c8-0x19a,_0x529868-0x49);}const _0x4f076a={'jfLjA':function(_0x90633a,_0xf5808b){function _0x15ec58(_0x154d8e,_0x19c3fd,_0x440edb,_0x2043e8,_0x262ecd){return _0x2aec(_0x19c3fd- -0x1b3,_0x440edb);}return _0x4191bf[_0x15ec58(0xe,0x77,'X)3w',0x12d,-0x26)](_0x90633a,_0xf5808b);},'lbBvH':_0x4191bf[_0x2a4133(0x456,0x430,0x486,0x490,'af!Z')],'mYQhJ':_0x4191bf[_0x2a4133(0x4ce,0x3ff,0x4eb,0x410,'Nx%g')]};function _0x32ffa0(_0x1c15fc,_0x24cc49,_0x31cf63,_0x2fadc5,_0x353b6c){return _0xcdd4e3(_0x1c15fc-0x1,_0x24cc49-0xe6,_0x1c15fc-0x1f2,_0x24cc49,_0x353b6c-0x10a);}function _0x3d7230(_0x3ba7f3,_0x10f945,_0xa48606,_0xe04b12,_0x27db6d){return _0x322cd8(_0x3ba7f3-0x15e,_0xa48606-0x4a4,_0xa48606-0x81,_0xe04b12-0x184,_0x27db6d);}function _0x30c2da(_0x107e2c,_0x262334,_0xde7b9e,_0x3ae2b0,_0x1c10db){return _0xcdd4e3(_0x107e2c-0x168,_0x262334-0x172,_0x3ae2b0-0xea,_0x262334,_0x1c10db-0xff);}if(_0x4191bf[_0x2a4133(0x58c,0x5e3,0x55a,0x456,'[pa(')](_0x4191bf[_0x30c2da(0x487,'Be0L',0x357,0x453,0x43f)],_0x4191bf[_0x30c2da(0x4d5,'LYla',0x518,0x4e8,0x454)])){if(_0x48ea11){const _0x5b347d=_0x4a1b0c[_0xc7a38d(0x44d,0x64f,0x553,'ms66',0x523)](_0x248e2e,arguments);return _0x5061f6=null,_0x5b347d;}}else{if(_0x4191bf[_0x32ffa0(0x583,'N8bu',0x51a,0x577,0x528)](typeof _0x71ad2d,_0x4191bf[_0x32ffa0(0x58c,'dUjt',0x4b1,0x4f1,0x668)])){if(_0x4191bf[_0x30c2da(0x4d4,'dUjt',0x309,0x3f7,0x463)](_0x4191bf[_0xc7a38d(0x607,0x71b,0x6c1,'(04E',0x5ea)],_0x4191bf[_0x30c2da(0x3e4,'^8T%',0x547,0x4da,0x4d1)]))_0x10ae42=_0x55dc0e;else return function(_0x2a5462){}[_0x2a4133(0x542,0x502,0x585,0x5ec,'Srbc')+_0x32ffa0(0x5a5,'3yp6',0x656,0x64f,0x49d)+'r'](_0x4191bf[_0xc7a38d(0x708,0x752,0x713,'ggMe',0x7a4)])[_0x30c2da(0x47f,'(cMV',0x3b8,0x420,0x3ff)](_0x4191bf[_0x3d7230(0x29a,0x3d4,0x319,0x3c5,'RGSH')]);}else{if(_0x4191bf[_0x30c2da(0x312,'9bUj',0x3a0,0x3ff,0x3be)](_0x4191bf[_0x3d7230(0x443,0x3f2,0x440,0x408,'RGSH')],_0x4191bf[_0xc7a38d(0x686,0x56f,0x664,'Urb5',0x5a9)])){if(_0x4191bf[_0x30c2da(0x281,'$7[D',0x3ee,0x359,0x250)](_0x4191bf[_0x2a4133(0x5a6,0x573,0x626,0x538,'af!Z')]('',_0x4191bf[_0x30c2da(0x486,'kSnD',0x500,0x4dc,0x477)](_0x71ad2d,_0x71ad2d))[_0x4191bf[_0x2a4133(0x4cd,0x54d,0x5a1,0x51b,'kSnD')]],0x16a*-0x4+0x1d97+0x17ee*-0x1)||_0x4191bf[_0x32ffa0(0x40d,'vfmL',0x409,0x42b,0x50d)](_0x4191bf[_0x2a4133(0x5a9,0x4cd,0x556,0x65b,'@bNO')](_0x71ad2d,0x1598*0x1+0x1d*0x31+0x1*-0x1b11),0x12f7+0x2*-0x1021+0xd4b)){if(_0x4191bf[_0x30c2da(0x3f5,'Vl9M',0x4e8,0x3f9,0x347)](_0x4191bf[_0x3d7230(0x49b,0x3ce,0x478,0x55a,'e7Y7')],_0x4191bf[_0x30c2da(0x35c,'9bUj',0x43a,0x40b,0x386)]))(function(){function _0x13c973(_0x592d77,_0x70417e,_0x4dda09,_0x98e354,_0x2b814a){return _0x2a4133(_0x592d77-0x16d,_0x70417e-0x1ef,_0x2b814a- -0x399,_0x98e354-0x157,_0x592d77);}function _0x1927c3(_0x650e93,_0x3e68b7,_0x26f241,_0x511f73,_0x17eb95){return _0x30c2da(_0x650e93-0x110,_0x650e93,_0x26f241-0x171,_0x511f73- -0x172,_0x17eb95-0x4a);}function _0x31eb52(_0x1bba2f,_0x1680a5,_0x4b9c5d,_0x4b0cfa,_0x766360){return _0x30c2da(_0x1bba2f-0x177,_0x766360,_0x4b9c5d-0x52,_0x4b0cfa-0x1f,_0x766360-0x9d);}function _0x3268db(_0x33a0b2,_0x3d54dc,_0x1978bd,_0x3c87da,_0x992303){return _0x32ffa0(_0x992303- -0x1a8,_0x33a0b2,_0x1978bd-0x7a,_0x3c87da-0x105,_0x992303-0x1d1);}if(_0x4f076a[_0x1927c3('J0F$',0x2b8,0x110,0x1de,0xe0)](_0x4f076a[_0x13c973('Vl9M',0x111,0x1aa,0x167,0x11b)],_0x4f076a[_0x13c973('D9V[',0x159,0x1a4,0x7f,0xcf)])){if(_0x3ce08f){const _0x35e90a=_0x2d3945[_0x13c973('7Cc3',0x2ac,0x171,0x1c8,0x201)](_0x3e3ae4,arguments);return _0x4f3327=null,_0x35e90a;}}else return!![];}[_0x3d7230(0x419,0x3ca,0x34f,0x2e1,'vfmL')+_0x2a4133(0x432,0x448,0x499,0x42a,'ZIVR')+'r'](_0x4191bf[_0x2a4133(0x614,0x51e,0x564,0x503,'ZZCg')](_0x4191bf[_0x3d7230(0x483,0x464,0x4c9,0x4ab,'8Grf')],_0x4191bf[_0xc7a38d(0x59a,0x4c4,0x54a,'Nx%g',0x471)]))[_0x2a4133(0x55e,0x67c,0x5ea,0x50c,'E9nR')](_0x4191bf[_0x2a4133(0x413,0x451,0x459,0x4e2,'!82x')]));else{const _0x3be5d3=_0x7a6f8c?function(){function _0x49d3aa(_0x54236f,_0x46ec31,_0x36b5c9,_0x39be10,_0x5bb36f){return _0x30c2da(_0x54236f-0x6b,_0x36b5c9,_0x36b5c9-0x189,_0x5bb36f- -0x325,_0x5bb36f-0x8b);}if(_0x3d2237){const _0x339bd3=_0x52a497[_0x49d3aa(0xa8,0x11c,'7Cc3',0xb2,0x14a)](_0x2923c6,arguments);return _0x303723=null,_0x339bd3;}}:function(){};return _0x3ca30b=![],_0x3be5d3;}}else{if(_0x4191bf[_0xc7a38d(0x543,0x53e,0x614,'!l05',0x61d)](_0x4191bf[_0xc7a38d(0x569,0x554,0x61d,'ACml',0x517)],_0x4191bf[_0x30c2da(0x47d,'G!u$',0x3c4,0x38a,0x43d)]))(function(){function _0x4cc026(_0x5b66fe,_0x18e108,_0x12b2e1,_0x4bdfee,_0x5cf8d3){return _0x32ffa0(_0x18e108- -0x367,_0x5cf8d3,_0x12b2e1-0x18c,_0x4bdfee-0xfd,_0x5cf8d3-0x7);}function _0x3d303a(_0x1df6c0,_0xbafde,_0x3be494,_0x56dc10,_0x326b82){return _0x32ffa0(_0xbafde- -0xf4,_0x326b82,_0x3be494-0x62,_0x56dc10-0x40,_0x326b82-0x1ac);}function _0x409972(_0x126adf,_0x1fa447,_0x35e91c,_0x44e984,_0x6d2fe0){return _0x2a4133(_0x126adf-0x52,_0x1fa447-0x1d,_0x6d2fe0-0x84,_0x44e984-0x187,_0x35e91c);}function _0x518e54(_0x4ada84,_0x3a0a0b,_0x3406fa,_0x466dda,_0x434bc9){return _0x2a4133(_0x4ada84-0xac,_0x3a0a0b-0x1b6,_0x4ada84- -0x95,_0x466dda-0x195,_0x3a0a0b);}if(_0x4191bf[_0x409972(0x5ad,0x494,'LlQn',0x50d,0x4fa)](_0x4191bf[_0x409972(0x577,0x5f0,'J0F$',0x570,0x626)],_0x4191bf[_0x409972(0x6df,0x66c,'o^)@',0x6c4,0x604)]))return![];else{const _0x31270c=_0xeb6ab9[_0x4cc026(0x2b2,0x24c,0x202,0x15e,'[pa(')](_0x2d7f85,arguments);return _0x162fad=null,_0x31270c;}}[_0x3d7230(0x35c,0x338,0x3e6,0x3d9,'ms66')+_0x2a4133(0x42b,0x562,0x466,0x425,'af!Z')+'r'](_0x4191bf[_0x2a4133(0x6be,0x593,0x5c2,0x687,'7P!1')](_0x4191bf[_0x2a4133(0x494,0x4b1,0x50e,0x5c3,'$7[D')],_0x4191bf[_0x32ffa0(0x4f3,'ACml',0x5ea,0x504,0x4b5)]))[_0x3d7230(0x2fd,0x367,0x2cf,0x1e5,'@3zA')](_0x4191bf[_0x30c2da(0x4a1,'kSnD',0x3ec,0x3a4,0x480)]));else{const _0xdd0d08=new _0x5ce83b(_0x4191bf[_0xc7a38d(0x5ee,0x5ca,0x58e,'$7[D',0x4bc)]),_0x3a4455=new _0x2cd343(_0x4191bf[_0x3d7230(0x2cd,0x236,0x2cd,0x350,'G!u$')],'i'),_0x26ca0a=_0x4191bf[_0x30c2da(0x41e,'@bNO',0x476,0x405,0x4e2)](_0x13d495,_0x4191bf[_0x2a4133(0x47a,0x52b,0x566,0x509,'M8uR')]);!_0xdd0d08[_0x32ffa0(0x48f,'Jp$j',0x3fa,0x3ec,0x439)](_0x4191bf[_0xc7a38d(0x5de,0x5fe,0x665,'ZZCg',0x5ab)](_0x26ca0a,_0x4191bf[_0x32ffa0(0x462,'$7[D',0x394,0x385,0x48f)]))||!_0x3a4455[_0x3d7230(0x2e1,0x2d5,0x3da,0x4cd,'@3zA')](_0x4191bf[_0x2a4133(0x5b6,0x551,0x568,0x5a0,'ZZCg')](_0x26ca0a,_0x4191bf[_0x3d7230(0x2ed,0x291,0x307,0x378,'@bNO')]))?_0x4191bf[_0x2a4133(0x48e,0x4a3,0x451,0x3f3,'Urb5')](_0x26ca0a,'0'):_0x4191bf[_0x2a4133(0x588,0x426,0x51e,0x4f6,'!82x')](_0x30eede);}}}else{if(_0x1f2f31){const _0x2dd1b7=_0x3a63a2[_0x3d7230(0x4d9,0x4d9,0x435,0x32e,'Sjjn')](_0x16ea2d,arguments);return _0x3fdeec=null,_0x2dd1b7;}}}_0x4191bf[_0x30c2da(0x245,'ZIVR',0x361,0x31e,0x35b)](_0x428238,++_0x71ad2d);}}function _0xcdd4e3(_0x4dbc97,_0xc5122f,_0x98397e,_0x3f13cb,_0x116bb4){return _0xc518b8(_0x4dbc97-0x165,_0x98397e-0x1b2,_0x3f13cb,_0x3f13cb-0x112,_0x116bb4-0xf7);}function _0x2bc490(_0x4e7aac,_0x3bf91b,_0xde497f,_0x11058c,_0x23b663){return _0x29d18c(_0x4e7aac-0x1da,_0x23b663-0x533,_0xde497f-0x1d3,_0x11058c-0x1c5,_0xde497f);}function _0x43d08d(_0xec4023,_0x374cbf,_0xf67ca2,_0x21f5cc,_0x454827){return _0xdb13f(_0xec4023-0x18e,_0x374cbf-0xf1,_0xf67ca2-0xe8,_0xec4023,_0x374cbf- -0x221);}try{if(_0x4191bf[_0x599ac3(0x647,0x6b9,'Sjjn',0x697,0x6e5)](_0x4191bf[_0x322cd8(-0x76,-0x126,-0x1c,-0x22d,'dUjt')],_0x4191bf[_0x2bc490(0x3be,0x3cb,'Nx%g',0x3f9,0x36d)])){const _0x378b2c=_0x155553[_0xcdd4e3(0x341,0x2ac,0x2b5,'(04E',0x1e1)](_0x3ab37a,arguments);return _0x4c018e=null,_0x378b2c;}else{if(_0xf6fc5){if(_0x4191bf[_0xcdd4e3(0x3a2,0x22b,0x2c2,'7P!1',0x298)](_0x4191bf[_0x2bc490(0x3ad,0x51e,'ms66',0x413,0x437)],_0x4191bf[_0x2bc490(0x2c1,0x413,'(cMV',0x3af,0x362)])){const _0x4d4c10=_0x3c6c3e?function(){function _0x53c711(_0xef53e7,_0x37aea8,_0x219892,_0x11bf16,_0x2d1e05){return _0x43d08d(_0x2d1e05,_0x37aea8-0x367,_0x219892-0xc0,_0x11bf16-0x13a,_0x2d1e05-0x1a9);}if(_0x2125c8){const _0x5034c5=_0x1db2e8[_0x53c711(0x598,0x569,0x63b,0x53f,'X)3w')](_0x4d83b5,arguments);return _0x4ecb23=null,_0x5034c5;}}:function(){};return _0xd7d1a2=![],_0x4d4c10;}else return _0x428238;}else{if(_0x4191bf[_0x322cd8(-0x10c,-0x94,-0x13b,-0x81,'7Cc3')](_0x4191bf[_0x322cd8(-0x2e,-0x111,-0x39,-0x109,'E9nR')],_0x4191bf[_0x43d08d('ggMe',0x1ec,0x226,0x195,0x1ad)]))return _0x481d46[_0x599ac3(0x630,0x692,'Sjjn',0x5e8,0x6c7)+_0x599ac3(0x509,0x4cb,'[pa(',0x4ec,0x57f)]()[_0x322cd8(0xa9,-0x1b,-0xe8,-0x32,'b]Ex')+'h'](_0x4191bf[_0x322cd8(0x1d,-0x71,0x6,-0x13,'vfmL')])[_0x2bc490(0x498,0x5ad,'ZIVR',0x513,0x4ea)+_0x43d08d('J0F$',0x314,0x2c0,0x3a2,0x408)]()[_0x599ac3(0x4a2,0x497,'foz8',0x4c6,0x4a1)+_0xcdd4e3(0x358,0x4f7,0x3ef,'@3zA',0x420)+'r'](_0x55225b)[_0x2bc490(0x4db,0x3ca,'ggMe',0x501,0x477)+'h'](_0x4191bf[_0xcdd4e3(0x378,0x3bf,0x328,'ms66',0x404)]);else _0x4191bf[_0x322cd8(-0x18,0x19,0x9,0x1b,'rXj[')](_0x428238,-0x1b9b+-0x129b*0x1+0x2e36);}}}catch(_0x573077){}}
  
// ==============================
// ==============================
    // 0) REGISTRY (Model + Modules)
    // ==============================
const MODEL_URLS = {
  Roma:  "/assets/Roma_ROMetrics.glb",
  Roman:"/assets/Roman_ROMetrics.glb"
};




const MODELS = [
  { id:"Roma",  label:"Roma ",  desc:"Female ROMetrics model.",  url: MODEL_URLS.Roma },
  { id:"Roman", label:"Roman",  desc:"Male ROMetrics model.", url: MODEL_URLS.Roman }
];

let ACTIVE_MODEL_ID = "Roma";

const ANAT_PRESETS = {
  Roma:  { shTuck: 35, shER: 10, hipAdd: 5, spine01Flex: 0, upperarmFlex: 0 },  // degrees
  Roman: { shTuck: 52, shER: 12, hipAdd: 0, spine01Flex: 5, upperarmFlex: 5 }   // degrees
};


let ANAT = { ...ANAT_PRESETS[ACTIVE_MODEL_ID] };

function setAnatForModel(id){
  ACTIVE_MODEL_ID = (id === "Roman" || id === "Roma") ? id : "Roma";
  ANAT = { ...ANAT_PRESETS[ACTIVE_MODEL_ID] };
}

const FORENSICS_MODULES = [
  { 
    id:'FL-001', 
    label:'Module 1 — Metabolic Demand: Energy Systems',  
    desc:'Cardio Bay: speed, energy, fuel timing.', 
    zone:'cardio', 
    onEnter: enterFL001 
  }
];
    
    let currentModule = null;

    // ==============================
    // 1) Gate UI wiring
    // ==============================
    const $gate = document.getElementById('gate');
    const $modelSel = document.getElementById('modelSelect');
    const $modSel = document.getElementById('moduleSelect');
    const $modelDesc = document.getElementById('modelDesc');
    const $modDesc = document.getElementById('moduleDesc');
    const $enter = document.getElementById('enterBtn');

    const $ui = document.getElementById('ui');
    const $badge = document.getElementById('badge');
    const $hint = document.getElementById('hint');
    const $moduleTitle = document.getElementById('moduleTitle');

    function fillSelect($sel, items){
      $sel.innerHTML = '';
      for (const it of items){
        const opt = document.createElement('option');
        opt.value = it.id;
        opt.textContent = it.label;
        $sel.appendChild(opt);
      }
    }
    function getModel(id){ return MODELS.find(m=>m.id===id) || MODELS[0]; }
    function getModule(id){ return FORENSICS_MODULES.find(m=>m.id===id) || FORENSICS_MODULES[0]; }

    fillSelect($modelSel, MODELS);
    fillSelect($modSel, FORENSICS_MODULES);

    function refreshGate(){
      const m = getModel($modelSel.value);
      const mod = getModule($modSel.value);
      $modelDesc.textContent = m.desc || '';
      $modDesc.textContent = mod.desc || '';
    }
    $modelSel.addEventListener('change', refreshGate);
    $modSel.addEventListener('change', refreshGate);
    refreshGate();

    // ==============================
    // 2) Studio: Three.js base
    // ==============================
const $spd = document.getElementById('spd');
const $spdVal = document.getElementById('spdVal');
const $engVal = document.getElementById('engVal');
const $status = document.getElementById('statusVal');
const $start = document.getElementById('startBtn');
const $fuel = document.getElementById('fuelBtn');
const $reset = document.getElementById('resetBtn');


// ==============================
// UI & CONTROL INITIALIZATION
// ==============================
$spdVal.textContent = sim.speedMph.toFixed(1);
$engVal.textContent = Math.round(sim.energy);
$status.textContent = "Ready";
$status.style.color = "#cfe3ff";
$start.textContent = "Start";

// Update speed from slider
$spd.addEventListener('input', () => { 
  sim.speedMph = parseFloat($spd.value); 
  
  // If they change speed while running, they fail the continuity requirement
  if (sim.running) {
      speedViolation = true;
  }
});
// Start / Pause Button Logic
$start.onclick = () => {
  // FORENSIC GATE: Block if no trial is selected
  const currentLetter = document.getElementById('trialTag').textContent.trim();
  if (currentLetter === "-" || currentLetter === "") {
      document.getElementById('trialMsg').innerHTML = `<b style="color:#ff9aa0;">ACTION REQUIRED:</b> Select Trial A or B first.`;
      return;
  }

  if (!sim.running) {
    if (sim.speedMph <= 0) return; 
    sim.elapsed = 0; 
    
    if (!sim.hasStarted) {
      sim.hasStarted = true;
      sim.workTime = 0;
      // Identify trial to set correct starting time
      trialTime = (currentLetter === 'B') ? 480 : 300; 
      // Capture the speed they chose to start with
      initialSpeed = parseFloat(sim.speedMph.toFixed(1));
      speedViolation = false; 
    }
  }
  
  sim.running = !sim.running;
  if (runAction) runAction.paused = !sim.running;
  $start.textContent = sim.running ? "Pause" : "Start";
};


$fuel.onclick = () => {
    if (sim.fuelCount >= 1) return; // Hard limit: 1 use
    
    sim.fuelCount++;
    sim.fuelAlertTimer = 5; 
    
    // Disable button immediately
    $fuel.disabled = true;
    $fuel.style.opacity = "0.4";

  // 1. TOO EARLY: > 70% (Tiered diminishing returns + Glycolytic Penalty)
    if (sim.energy > 70) {
        sim.fuelPenaltyTimer = 30;    
        sim.throughputAlert = 5;
        
        let energyGain = 0;

        if (sim.energy >= 90) {
            // Tier: 90-100%
            energyGain = 0;
            sim.fuelMessage = "TOO EARLY: +0 Energy | Waste Spike";
        } else if (sim.energy >= 80) {
            // Tier: 80-89%
            energyGain = 3;
            sim.fuelMessage = "TOO EARLY: +3 Energy | Waste Spike";
        } else {
            // Tier: 71-79%
            energyGain = 4;
            sim.fuelMessage = "TOO EARLY: +4 Energy | Waste Spike";
        }

        sim.energy = Math.min(100, sim.energy + energyGain);
    } 
    // 2. OPTIMAL WINDOW: 40-70%
    else if (sim.energy >= 40) {
        sim.fuelPenaltyTimer = 0;
        sim.fuelMessage = "CORRECT WINDOW: Full fuel benefit";
        sim.energy = Math.min(100, sim.energy + 10); 
    }
    // 3. TOO LATE: < 40%
    else {
        sim.fuelPenaltyTimer = 0;
        sim.fuelMessage = "TOO LATE: Little or no fuel benefit";
        sim.energy += 2; 
    }
};
     

// --- INSIDE THE DRAW/ANIMATE LOOP ---
if (sim.running) {
    let rateMultiplier = 1.0;

    // 1. Math Penalty Logic
    if (sim.fuelPenaltyTimer > 0) {
        rateMultiplier = 1.2; 
        sim.fuelPenaltyTimer -= (dt / 1);
    }

    // 2. Visual Throughput Alert (The 5-second window)
    if (sim.throughputAlert > 0) {
        sim.throughputAlert -= (dt / 1);
        
        // Draw the alert on screen
        ctx.fillStyle = "rgba(255, 60, 60, 0.2)"; // Subtle red tint
        ctx.fillRect(0, 0, c.width, c.height);
        
        ctx.fillStyle = "#ff9aa0";
        ctx.font = "900 24px Inter";
        ctx.textAlign = "center";
        ctx.fillText("↑ GLYCOLYTIC THROUGHPUT INCREASED", c.width / 2, 100);
        ctx.textAlign = "left";
    }

    // 3. Accumulation Logic
    if (speed > ceilingSpeed) {
        const deficit = currentCost - sim.vo2Max;
        sim.lactate += (deficit * 0.0035) * rateMultiplier; 
    }
}

$reset.addEventListener('click', () => {
if (window.controls) window.controls.enabled = true;
// 1. CLEAR MESSAGES & UI
    document.getElementById('trialMsg').innerHTML = 'Read the instructions above. When ready, press Start.';
    
    // Ensure the external assessment button is hidden on reset
    const aBtn = document.getElementById('assessmentBtn');
    if (aBtn) aBtn.style.display = 'none';


    // 2. WIPE FORENSIC INTEGRITY FLAGS
    speedViolation = false; 
    initialSpeed = 0;
    sim.fuelCount = 0;
    sim.hasStarted = false; // CRITICAL: This unlocks the trial switching buttons

    // 3. REFRESH FUEL BUTTON BASED ON ACTIVE TRIAL
    const $fBtn = document.getElementById('fuelBtn');
    const currentLetter = document.getElementById('trialTag').textContent.trim();
    
    if (currentLetter === 'B') {
        $fBtn.disabled = false;
        $fBtn.style.opacity = "1";
    } else {
        $fBtn.disabled = true; // Trial A remains disabled
        $fBtn.style.opacity = "0.4";
    }

    // 4. RESET SIMULATION STATE
    sim.energy = 100;
    sim.running = false;
    sim.elapsed = 0; 
    sim.speedMph = 0;
    sim.lactate = 0;
    sim.fuelPenaltyTimer = 0;
    sim.fuelAlertTimer = 0;
    sim.throughputAlert = 0;

    // 5. RESET HUD VALUES
    trialTime = (currentLetter === 'B') ? 480 : 300; 
    document.getElementById('trialTime').textContent = trialTime;
    document.getElementById('engVal').textContent = 100;
    document.getElementById('spdVal').textContent = "0.0";
    $spd.value = 0;
    $start.textContent = "Start";
    
    const $status = document.getElementById('statusVal');
    $status.textContent = "Ready";
    $status.style.color = "#cfe3ff";

    // 6. RESET AVATAR & ANIMATION
    if (runAction) {
        runAction.paused = true;
        runAction.time = 0;
    }
    restore();

    // 7. RE-SYNC VO2 BUDGET
    const currentModel = document.getElementById('modelSelect').value;
    const age = (currentModel === "Roman") ? 43 : 34;
    sim.vo2Max = 15.3 * ((220 - age) / 72);

  //  Reset the HUD/Menu
  trialTime = 300;
  document.getElementById('trialTime').textContent = 300;
  document.getElementById('engVal').textContent = 100;
  document.getElementById('spdVal').textContent = "0.0";
  $spd.value = 0;
  sim.speedMph = 0;
  $start.textContent = "Start";
  $status.textContent = "Ready";
  $status.style.color = "#cfe3ff";

// Reset Messages & Hide Assessment Button
    document.getElementById('trialMsg').textContent = 'Read the instructions above. When ready, press Start.';
    
    // We check for the button directly by ID without re-declaring it as a 'const'
    if (document.getElementById('assessmentBtn')) {
        document.getElementById('assessmentBtn').style.display = 'none';
    }
});
// ==============================
//  Studio: Three.js base
// ==============================
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x07101b, 10, 45);

    const camera = new THREE.PerspectiveCamera(55, innerWidth/innerHeight, 0.1, 120);
    camera.position.set(6.8, 3.9, 8.6);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:false });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.shadowMap.enabled = false;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);

    window.controls = new OrbitControls(camera, renderer.domElement);
    window.controls.target.set(0, 1.35, 0);    controls.enableDamping = true;
    controls.dampingFactor = 0.07;
    controls.maxPolarAngle = Math.PI * 0.49;
    controls.minDistance = 0.5;
    controls.maxDistance = 18.0;

    // Lights
    scene.add(new THREE.AmbientLight(0x6aa0d8, 1.77));

    const key = new THREE.DirectionalLight(0xffffff, 1.05);
    key.position.set(7, 10, 5);
    key.castShadow = true;
    key.shadow.mapSize.set(2048,2048);
    key.shadow.camera.near = 0.5;
    key.shadow.camera.far = 40;
    key.shadow.camera.left = -10;
    key.shadow.camera.right = 10;
    key.shadow.camera.top = 10;
    key.shadow.camera.bottom = -10;
    scene.add(key);

    const rim = new THREE.DirectionalLight(0x38bdf8, 0.28);
    rim.position.set(-9, 6, -7);
    scene.add(rim);

    // Materials
    const matFloor = new THREE.MeshStandardMaterial({ color:0x0a1a2e, roughness:0.95, metalness:0.05 });
    const matWall  = new THREE.MeshStandardMaterial({ color:0x091425, roughness:0.9, metalness:0.05 });
    const matDark  = new THREE.MeshStandardMaterial({ color:0x0b1220, roughness:0.85, metalness:0.08 });
    const matSteel = new THREE.MeshStandardMaterial({ color:0x7a8aa0, roughness:0.35, metalness:0.55 });
    const matGlow  = new THREE.MeshStandardMaterial({ color:0x38bdf8, roughness:0.35, metalness:0.25, emissive:0x103040, emissiveIntensity:0.8 });

    // ==============================
    // 3) Live screens + Belt texture
    // ==============================
    function makeScreenCanvas(w=512,h=256){
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      const ctx = c.getContext('2d');
      const tex = new THREE.CanvasTexture(c);
      tex.anisotropy = 8;
      return { c, ctx, tex };
    }
    const wallScreen = makeScreenCanvas(1024, 320);
    const consoleScreen = makeScreenCanvas(512, 256);

    const beltCanvas = document.createElement('canvas');
    beltCanvas.width = 512;
    beltCanvas.height = 512;
    const bctx = beltCanvas.getContext('2d');

    {
      const g = bctx.createLinearGradient(0,0,512,0);
      g.addColorStop(0.00,'#0a0f16');
      g.addColorStop(0.35,'#0c1522');
      g.addColorStop(0.65,'#0b1320');
      g.addColorStop(1.00,'#09101a');
      bctx.fillStyle = g;
      bctx.fillRect(0,0,512,512);
      bctx.fillStyle = 'rgba(0,0,0,0.18)';
      bctx.fillRect(252, 0, 8, 512);

      let y = 0;
      while (y < 512){
        const h = 1 + Math.floor(Math.random()*2);
        const a = 0.020 + Math.random()*0.030;
        bctx.fillStyle = `rgba(255,255,255,${a})`;
        bctx.fillRect(0, y, 512, h);
        y += 12 + Math.floor(Math.random()*16);
      }
      for (let i=0;i<900;i++){
        const x = Math.random()*512;
        const yy = Math.random()*512;
        bctx.fillStyle = `rgba(255,255,255,${Math.random()*0.05})`;
        bctx.fillRect(x,yy,1,1);
      }
    }

    const beltTex = new THREE.CanvasTexture(beltCanvas);
    beltTex.anisotropy = 8;
    beltTex.wrapS = THREE.RepeatWrapping;
    beltTex.wrapT = THREE.RepeatWrapping;
    beltTex.repeat.set(1, 8.0);
    beltTex.offset.set(0, 0);

    const matBelt = new THREE.MeshStandardMaterial({
      map: beltTex,
      color: 0x0b1018,
      roughness: 0.98,
      metalness: 0.00
    });

 function roundRect(ctx, x, y, w, h, r){
  const min = Math.min(w,h);
  if (r > min/2) r = min/2;
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y, x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x, y+h, r);
  ctx.arcTo(x, y+h, x, y, r);
  ctx.arcTo(x, y, x+w, y, r);
  ctx.closePath();
}

// ==========================================
// 1. THE ROUTER (The "Brain")
// ==========================================
function drawPanel(screen, title) {
    const { ctx, c } = screen;
    const currentTrial = document.getElementById('trialTag').textContent.trim();
    const modelName = document.getElementById('modelSelect').value.trim();
    const speed = parseFloat(sim.speedMph.toFixed(1));

    // A. GLOBAL CLEAR & BACKGROUND
    ctx.clearRect(0, 0, c.width, c.height);
    ctx.fillStyle = '#061222';
    ctx.fillRect(0, 0, c.width, c.height);
    ctx.strokeStyle = '#38bdf8';
    ctx.lineWidth = 8;
    ctx.strokeRect(10, 10, c.width - 20, c.height - 20);

    // B. GLOBAL HEADER
    ctx.fillStyle = '#e6eef7';
    ctx.font = '900 28px Inter, system-ui';
    ctx.fillText(`SUBJECT: Average Fit Adult (${modelName})`, 40, 60);
    ctx.fillStyle = '#38bdf8';
    ctx.font = '700 24px Inter, system-ui';
    ctx.fillText(`CURRENT SESSION: Trial ${currentTrial}`, 40, 100);

    // C. ACTIVATION GATE
    if (!sim.running && sim.elapsed <= 0) {
        ctx.fillStyle = 'rgba(148,163,184,0.3)';
        ctx.font = 'italic 600 22px Inter, system-ui';
        ctx.fillText("WAITING FOR SESSION START...", 40, 150);
    } else {
        // D. ROUTE TO SPECIFIC TRIAL VIEW
        if (currentTrial === 'A') {
            drawTrialA_View(ctx, c, speed, modelName);
        } else if (currentTrial === 'B') {
            drawTrialB_View(ctx, c, speed);
        } else {
            // Future trials go here (e.g., else if currentTrial === 'C')
            drawTrialA_View(ctx, c, speed, modelName);
        }
    }

    screen.tex.needsUpdate = true;
}

// ==========================================
// 2. TRIAL A BOX (All Trial A Logic & Visuals)
// ==========================================
function drawTrialA_View(ctx, c, speed, modelName) {
    // calculation logic (untouched)
    const ceiling = (modelName === "Roman") ? 6.3 : 6.7;
    const isAnaerobicSpeed = speed > ceiling;
    const isAtpActive = sim.elapsed > 0 && sim.elapsed < 15 && speed > 0;
    const isStartupDeficit = sim.elapsed > 0 && sim.elapsed < 30 && speed > 0;
    const startUpVal = isStartupDeficit ? (0.15 * (1.0 - (sim.elapsed / 30))) : 0;
    const graphY = 185, graphW = c.width - 80, graphH = 50;
    const currentCost = (speed * 26.8 * 0.205) + 3.5;
    
    let aerobicPart = Math.min(currentCost, sim.vo2Max);
    let anaerobicPart = Math.max(0, currentCost - sim.vo2Max);
    let totalWork = aerobicPart + anaerobicPart;
    let anaerobicRatio = (anaerobicPart / totalWork) + startUpVal;
    let aerobicRatio = 1.0 - anaerobicRatio;

    // Visuals (untouched reorder)
    ctx.fillStyle = 'rgba(255,255,255,0.05)';
    ctx.fillRect(40, graphY, graphW, graphH);
    ctx.fillStyle = '#38bdf8';
    ctx.fillRect(40, graphY, graphW * aerobicRatio, graphH);
    if (anaerobicRatio > 0.01) {
        ctx.fillStyle = 'rgba(255, 228, 163, 0.8)';
        ctx.fillRect(40 + (graphW * aerobicRatio), graphY, graphW * anaerobicRatio, graphH);
    }
    if (isAtpActive) {
        const fade = 1.0 - (sim.elapsed / 15);
        let atpBarPct = (speed / 22) * 55 * fade; 
        ctx.fillStyle = 'rgba(255, 154, 160, 0.9)';
        ctx.fillRect(40, graphY, graphW * (atpBarPct / 100), graphH);
        ctx.fillStyle = '#ff9aa0';
        ctx.font = '700 18px Inter, system-ui';
        ctx.fillText(`● ATP-PC: ACTIVE (${Math.ceil(15 - sim.elapsed)}s)`, 420, 150);
    }

    ctx.font = '700 16px Inter, system-ui';
    ctx.fillStyle = '#38bdf8'; 
    ctx.fillText("● Aerobic: Active", 420, 100);
    if (isAnaerobicSpeed || isStartupDeficit) {
        ctx.fillStyle = '#ffe4a3';
        ctx.fillText("● Anaerobic: Active", 420, 125);
    }

    let dominantText = isAnaerobicSpeed ? "PRIMARY: Anaerobic Glycolysis" : "PRIMARY: Aerobic Metabolism";
    let dominantColor = isAnaerobicSpeed ? "#ffe4a3" : "#38bdf8";
    ctx.fillStyle = dominantColor;
    ctx.font = '900 22px Inter, system-ui';
    ctx.fillText(dominantText, 40, 140);

    ctx.font = '600 16px Inter, system-ui';
    ctx.fillStyle = '#ff9aa0'; ctx.fillText('■ ATP-PC', 40, graphY + graphH + 35);
    ctx.fillStyle = '#38bdf8'; ctx.fillText('■ AEROBIC', 140, graphY + graphH + 35);
    ctx.fillStyle = '#ffe4a3'; ctx.fillText('■ ANAEROBIC GLYCOLYSIS', 280, graphY + graphH + 35);
}

// ==========================================
// 3. TRIAL B BOX (Updated: Timing Outcomes Logic)
// ==========================================
function drawTrialB_View(ctx, c, speed) {
    const barY = 185, barW = c.width - 80, barH = 50;
    const modelName = document.getElementById('modelSelect').value.trim();
    
    // 1. DETERMINE THE CEILING
    const ceilingSpeed = (modelName === "Roman") ? 6.3 : 6.7;
    const currentCost = (speed * 26.8 * 0.205) + 3.5;
    const deficit = Math.max(0, currentCost - sim.vo2Max);

    // 2. LIVE PRODUCTION VS. WIPING
    if (sim.running) {
        // Multiplier only exists if fuel was used > 75% energy
        const throughputMultiplier = (sim.fuelPenaltyTimer > 0) ? 1.5 : 1.0;

        if (speed <= ceilingSpeed && speed > 0) {
            // STEADY STATE "BREATHING"
            sim.lactate = Math.min(1.4, sim.lactate + 0.04);
            if (Math.sin(performance.now() / 250) > 0.9) {
                sim.lactate = 0; 
            }
        } else if (speed > ceilingSpeed) {
            // TOXIC DEBT: Accumulation outpaces clearance
            const fatigueMultiplier = (sim.lactate > 50) ? 1.2 : 1.0; 
            const accumulation = (deficit * 0.00225) * fatigueMultiplier * throughputMultiplier; 
            sim.lactate = Math.min(100, sim.lactate + accumulation);
        }

        // Decrement timers
        if (sim.fuelPenaltyTimer > 0) sim.fuelPenaltyTimer -= 0.016; 
        if (sim.throughputAlert > 0) sim.throughputAlert -= 0.016;
    }

    // 3. VISUALS (Heat-map and Bar)
    if (sim.throughputAlert > 0) {
        ctx.fillStyle = 'rgba(255, 0, 0, 0.15)';
        ctx.fillRect(0, 0, c.width, c.height);
        
        ctx.fillStyle = '#ff4d4d';
        ctx.font = '900 24px Inter';
        ctx.textAlign = 'center';
        ctx.fillText("↑ GLYCOLYTIC THROUGHPUT INCREASED", c.width / 2, 80);
        ctx.textAlign = 'left';
    }

    ctx.fillStyle = '#ffe4a3';
    ctx.font = '900 22px Inter';
    ctx.fillText("FORENSIC ANALYSIS: METABOLIC WASTE (LACTATE)", 40, 150);
    
    ctx.fillStyle = 'rgba(255,255,255,0.05)';
    ctx.fillRect(40, barY, barW, barH);
    
    const r = 150 + (sim.lactate * 1.05);
    const g = 228 - (sim.lactate * 2.2);
    ctx.fillStyle = `rgb(${r}, ${g}, 163)`;
    ctx.fillRect(40, barY, barW * (sim.lactate / 100), barH);
    
    // 4. PERCENTAGE READOUT
    ctx.fillStyle = (sim.lactate > 45) ? '#061222' : '#e6eef7';
    ctx.font = '900 20px Inter';
    ctx.textAlign = 'center';
    const displayVal = speed <= ceilingSpeed ? sim.lactate.toFixed(1) : Math.round(sim.lactate);
    ctx.fillText(`${displayVal}%`, 40 + (barW / 2), barY + 33);
    ctx.textAlign = 'left';

// 5. STATUS & ALERTS (Timing Outcomes Corrected)
ctx.font = '700 18px Inter';

// --- TRANSIENT ALERTS (Triggered only when fuel is clicked) ---
if (sim.fuelAlertTimer > 0) {
    // Choose color based on success/failure
    ctx.fillStyle = (sim.fuelMessage.includes("CORRECT")) ? "#38bdf8" : "#ff9aa0";
    ctx.fillText(`ALERT: ${sim.fuelMessage}`, 40, barY + barH + 40);
    
    // Timer decrement is handled here (approx 60fps)
    sim.fuelAlertTimer -= 0.016; 
} 
// --- PERSISTENT BODY STATUS (Active when no alert is timing out) ---
else {
    if (speed <= ceilingSpeed && speed > 0) {
        ctx.fillStyle = '#38bdf8';
        ctx.fillText("STATUS: ACTIVE CLEARANCE (STEADY STATE)", 40, barY + barH + 40);
    } else if (sim.lactate > 1.5) {
        ctx.fillStyle = '#ffe4a3';
        ctx.fillText("STATUS: ANAEROBIC DEBT ACCUMULATING", 40, barY + barH + 40);
    } else {
        ctx.fillStyle = '#38bdf8';
        ctx.fillText("STATUS: READY", 40, barY + barH + 40);
    }
  }
}  
    // ==============================
    // 4) Room + zones (REAL SCALE)
    // ==============================
    // Room in meters
    const ROOM_W = 14.0;
    const ROOM_D = 11.0;
    const WALL_H = 6.6;

    const floor = new THREE.Mesh(new THREE.PlaneGeometry(ROOM_W, ROOM_D), matFloor);
    floor.rotation.x = -Math.PI/2;
    floor.receiveShadow = true;
    scene.add(floor);

    const room = new THREE.Group();

    const wallBack = new THREE.Mesh(new THREE.BoxGeometry(ROOM_W, WALL_H, 0.30), matWall);
    wallBack.position.set(0, WALL_H/2, -(ROOM_D/2) + 0.15);
    wallBack.receiveShadow = true;
    room.add(wallBack);

    const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(0.30, WALL_H, ROOM_D), matWall);
    wallLeft.position.set(-(ROOM_W/2) + 0.15, WALL_H/2, 0);
    room.add(wallLeft);

    const wallRight = wallLeft.clone();
    wallRight.position.x = (ROOM_W/2) - 0.15;
    room.add(wallRight);

    const grid = new THREE.GridHelper(ROOM_W, Math.round(ROOM_W), 0x1f3b5a, 0x10243a);
    grid.position.y = 0.01;
    room.add(grid);

    scene.add(room);

    // Labels
    let labelsOn = false;
    const labelGroup = new THREE.Group();
    scene.add(labelGroup);

    function makeLabel(text){
      const canvas = document.createElement('canvas');
      canvas.width = 512; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(15,23,42,0.72)';
      ctx.strokeStyle = 'rgba(56,189,248,0.65)';
      ctx.lineWidth = 6;
      roundRect(ctx, 14, 16, 484, 96, 26);
      ctx.fill(); ctx.stroke();
      ctx.fillStyle = '#e6eef7';
      ctx.font = '800 36px system-ui, -apple-system, Segoe UI, Roboto, Inter';
      ctx.textBaseline = 'middle';
      ctx.fillText(text, 34, 64);
      const tex = new THREE.CanvasTexture(canvas);
      tex.anisotropy = 8;
      const mat = new THREE.MeshBasicMaterial({ map: tex, transparent:true });
      const mesh = new THREE.Mesh(new THREE.PlaneGeometry(3.4, 0.85), mat);
      mesh.renderOrder = 10;
      return mesh;
    }
    function setLabels(v){
      labelsOn = v;
      labelGroup.traverse(o=>{ if (o.isMesh) o.visible = labelsOn; });
    }
    setLabels(false);

    function zoneBasePlate(w, d){
      const plate = new THREE.Mesh(new THREE.BoxGeometry(w, 0.06, d), new THREE.MeshStandardMaterial({ color:0x0b1a2e, roughness:0.9, metalness:0.06 }));
      plate.receiveShadow = true;
      return plate;
    }

    // Zone centers
    const Z_STRENGTH = new THREE.Vector3(-4.4, 0, 2.1);
    const Z_CARDIO   = new THREE.Vector3( 4.4, 0, 2.1);
    const Z_FORENSIC = new THREE.Vector3( 0.0, 0, -3.1);

    // Strength zone (scaled realistic)
    const zoneStrength = new THREE.Group();
    zoneStrength.name = 'strength';
    zoneStrength.position.copy(Z_STRENGTH);

    const platS = zoneBasePlate(4.2, 3.2);
    platS.position.set(0, 0.03, 0);
    zoneStrength.add(platS);

    // Simple bench press rack (realistic)
    const benchTop = new THREE.Mesh(new THREE.BoxGeometry(1.35, 0.10, 0.34), matDark);
    benchTop.position.set(0, 0.48, 0.35);
    benchTop.castShadow = true;
    zoneStrength.add(benchTop);

    const benchLegGeo = new THREE.BoxGeometry(0.06, 0.45, 0.06);
    [[-0.55,0.22,0.23],[0.55,0.22,0.23],[-0.55,0.22,0.47],[0.55,0.22,0.47]].forEach(p=>{
      const l = new THREE.Mesh(benchLegGeo, matSteel);
      l.position.set(p[0], p[1], p[2]);
      l.castShadow = true;
      zoneStrength.add(l);
    });

    const upGeo = new THREE.BoxGeometry(0.08, 1.55, 0.08);
    const uprL = new THREE.Mesh(upGeo, matSteel); uprL.position.set(-0.55, 0.80, -0.55); uprL.castShadow = true;
    const uprR = uprL.clone(); uprR.position.x = 0.55;
    zoneStrength.add(uprL, uprR);

    const bar = new THREE.Mesh(new THREE.CylinderGeometry(0.025,0.025,1.25,18), matSteel);
    bar.rotation.z = Math.PI/2;
    bar.position.set(0, 1.45, -0.55);
    bar.castShadow = true;
    zoneStrength.add(bar);

    // Dumbbell rack (near bench, offset left so it won’t collide)
{
  const rack = new THREE.Group();
  const matRubber = new THREE.MeshStandardMaterial({ color:0x121923, roughness:0.98, metalness:0.03 });

  const W = 1.85, D = 0.55, H = 0.95;
  const legGeo   = new THREE.BoxGeometry(0.06, H, 0.06);
  const shelfGeo = new THREE.BoxGeometry(W, 0.06, 0.36);

  const legs = [
    [-W/2+0.07, H/2, -D/2+0.07],
    [ W/2-0.07, H/2, -D/2+0.07],
    [-W/2+0.07, H/2,  D/2-0.07],
    [ W/2-0.07, H/2,  D/2-0.07],
  ];
  for (const p of legs){
    const leg = new THREE.Mesh(legGeo, matSteel);
    leg.position.set(p[0], p[1], p[2]);
    leg.castShadow = true;
    rack.add(leg);
  }

  const shelf1 = new THREE.Mesh(shelfGeo, matDark);
  shelf1.position.set(0, 0.68, 0);
  shelf1.rotation.x = -0.14;
  shelf1.castShadow = true;
  shelf1.receiveShadow = true;
  rack.add(shelf1);

  const shelf2 = new THREE.Mesh(shelfGeo, matDark);
  shelf2.position.set(0, 0.32, 0);
  shelf2.rotation.x = -0.14;
  shelf2.castShadow = true;
  shelf2.receiveShadow = true;
  rack.add(shelf2);

  const base = new THREE.Mesh(new THREE.BoxGeometry(W+0.12, 0.05, D+0.18), matDark);
  base.position.set(0, 0.03, 0);
  base.receiveShadow = true;
  rack.add(base);

  const handleGeo = new THREE.CylinderGeometry(0.022, 0.022, 0.24, 16);
  const hexGeo    = new THREE.CylinderGeometry(0.070, 0.070, 0.050, 6);

  function dumbbell(scale=1){
    const g = new THREE.Group();
    const handle = new THREE.Mesh(handleGeo, matSteel);
    handle.rotation.z = Math.PI/2;
    handle.castShadow = true;
    g.add(handle);

    const wL = new THREE.Mesh(hexGeo, matRubber);
    wL.position.x = -0.145;
    wL.rotation.z = Math.PI/2;
    wL.castShadow = true;
    g.add(wL);

    const wR = wL.clone();
    wR.position.x = 0.145;
    g.add(wR);

    g.scale.setScalar(scale);
    return g;
  }

  const xs = [-0.68, -0.34, 0.00, 0.34, 0.68];
  xs.forEach((x,i)=>{
    const db = dumbbell(0.92 + i*0.02);
    db.position.set(x, 0.73, -0.06);
    db.rotation.y = 0.08;
    rack.add(db);
  });
  xs.forEach((x,i)=>{
    const db = dumbbell(1.00 + i*0.03);
    db.position.set(x, 0.37, -0.06);
    db.rotation.y = 0.08;
    rack.add(db);
  });

  // placement relative to YOUR bench (bench is around x=0, z≈0.35)
  rack.position.set(-1.15, 0.0, 0.45);
  rack.rotation.y = 1.60;

  zoneStrength.add(rack);
}


    const lblS = makeLabel('Strength / Load Station');
    lblS.position.copy(Z_STRENGTH).add(new THREE.Vector3(0, 2.7, -1.6));
    labelGroup.add(lblS);

    scene.add(zoneStrength);

    // Cardio zone (realistic treadmill size)
    const zoneCardio = new THREE.Group();
    zoneCardio.name = 'cardio';
    zoneCardio.position.copy(Z_CARDIO);

    const platC = zoneBasePlate(4.2, 3.2);
    platC.position.set(0, 0.03, 0);
    zoneCardio.add(platC);

    const treadmill = new THREE.Group();
    treadmill.position.set(0, 0.03, 0);
    zoneCardio.add(treadmill);

    const treadStrips = [];
    let TREAD_MIN_Z = -0.7;
    let TREAD_MAX_Z =  0.7;

    // Real treadmill dims (meters)
    const BELT_W = 0.55;
    const BELT_L = 1.55;
    const FRAME_W = 0.82;
    const FRAME_L = 2.05;

    TREAD_MIN_Z = -(BELT_L/2) + 0.10;
    TREAD_MAX_Z =  (BELT_L/2) - 0.10;

    const tmFrame = new THREE.Mesh(new THREE.BoxGeometry(FRAME_W, 0.22, FRAME_L), matDark);
    tmFrame.position.set(0, 0.16, 0);
    tmFrame.castShadow = true;
    treadmill.add(tmFrame);

    const tmDeck = new THREE.Mesh(
      new THREE.BoxGeometry(BELT_W + 0.14, 0.06, BELT_L + 0.18),
      new THREE.MeshStandardMaterial({ color:0x0c1728, roughness:0.95, metalness:0.05 })
    );
    tmDeck.position.set(0, 0.26, 0);
    tmDeck.receiveShadow = true;
    treadmill.add(tmDeck);

    const tmBelt = new THREE.Mesh(new THREE.PlaneGeometry(BELT_W, BELT_L), matBelt);
    tmBelt.rotation.x = -Math.PI/2;
    tmBelt.position.set(0, 0.295, 0);
    tmBelt.receiveShadow = true;
    treadmill.add(tmBelt);

    const beltEdges = new THREE.LineSegments(
      new THREE.EdgesGeometry(new THREE.BoxGeometry(BELT_W + 0.10, 0.02, BELT_L + 0.10)),
      new THREE.LineBasicMaterial({ color:0x38bdf8, transparent:true, opacity:0.55 })
    );
    beltEdges.position.set(0, 0.305, 0);
    beltEdges.renderOrder = 9;
    treadmill.add(beltEdges);

    const stripMat = new THREE.MeshStandardMaterial({ color: 0x1a2738, roughness: 0.95, metalness: 0.02, transparent:true, opacity:0.30 });
    const stripCount = 12;
    for (let i=0;i<stripCount;i++){
      const s = new THREE.Mesh(new THREE.BoxGeometry(BELT_W - 0.04, 0.01, 0.06), stripMat);
      s.position.set(0, 0.300, TREAD_MIN_Z + i * ((TREAD_MAX_Z - TREAD_MIN_Z) / stripCount));
      s.renderOrder = 10;
      treadmill.add(s);
      treadStrips.push(s);
    }

    const rollerGeo = new THREE.CylinderGeometry(0.08, 0.08, BELT_W + 0.08, 18);
    const rollerMat = new THREE.MeshStandardMaterial({ color:0x1a2a44, roughness:0.55, metalness:0.25 });
    const rFront = new THREE.Mesh(rollerGeo, rollerMat);
    rFront.rotation.z = Math.PI/2;
    rFront.position.set(0, 0.33, -(BELT_L/2) - 0.04);
    rFront.castShadow = true;
    treadmill.add(rFront);

    const rBack = rFront.clone();
    rBack.position.z = (BELT_L/2) + 0.04;
    treadmill.add(rBack);

    // rails + console (front)
    const upPole = new THREE.Mesh(new THREE.CylinderGeometry(0.035,0.035,1.05,16), matSteel);
    const upX = (FRAME_W/2) - 0.10;
    const frontZ = -(BELT_L/2) - 0.42;

    const upL = upPole.clone(); upL.position.set(-upX, 0.62, frontZ); upL.castShadow = true;
    const upR = upPole.clone(); upR.position.set( upX, 0.62, frontZ); upR.castShadow = true;
    treadmill.add(upL, upR);

    const topBar = new THREE.Mesh(new THREE.CylinderGeometry(0.032,0.032, FRAME_W - 0.10, 16), matSteel);
    topBar.rotation.z = Math.PI/2;
    topBar.position.set(0, 1.15, frontZ);
    topBar.castShadow = true;
    treadmill.add(topBar);

    const sideRail = new THREE.Mesh(new THREE.CylinderGeometry(0.028,0.028, BELT_L + 0.35, 16), matSteel);
    sideRail.rotation.x = Math.PI/2;
    sideRail.position.set(-upX, 0.95, -0.02);
    sideRail.castShadow = true;
    treadmill.add(sideRail);

    const sideRailR = sideRail.clone();
    sideRailR.position.x = upX;
    treadmill.add(sideRailR);

    const tmConsole = new THREE.Mesh(new THREE.BoxGeometry(0.58, 0.40, 0.22), new THREE.MeshStandardMaterial({ color:0x111b2e, roughness:0.55, metalness:0.12 }));
    tmConsole.position.set(0, 1.02, frontZ + 0.14);
    tmConsole.castShadow = true;
    treadmill.add(tmConsole);
    
const tmScreen = new THREE.Mesh(
  new THREE.PlaneGeometry(0.56, 0.30),
 new THREE.MeshBasicMaterial({
  map: consoleScreen.tex,
  side: THREE.DoubleSide,
  transparent: true,
  depthTest: true,      // <-- IMPORTANT: allow avatar to occlude it
  depthWrite: false,
  toneMapped: false,
  polygonOffset: true,  // prevents z-fighting with the console face
  polygonOffsetFactor: -1,
  polygonOffsetUnits: -1
})
);

// attach to console (NOT treadmill / NOT zone)
tmConsole.add(tmScreen);

// local coords on the console front face (console depth = 0.32 -> half = 0.16)
tmScreen.position.set(0, 0.02, 0.162);
tmScreen.rotation.set(-0.10, 0, 0);



    // Wall board (live)
    const board = new THREE.Mesh(new THREE.BoxGeometry(2.6, 0.88, 0.08), new THREE.MeshStandardMaterial({ color:0x111b2e, roughness:0.6, metalness:0.15 }));
    board.position.set(0, 2.55, -1.55);
    zoneCardio.add(board);

    const boardFace = new THREE.Mesh(
  new THREE.PlaneGeometry(2.46, 0.78),
  new THREE.MeshBasicMaterial({
    map: wallScreen.tex,
    transparent: true,
    depthTest: false,
    depthWrite: false,
    toneMapped: false
  })
);
boardFace.position.set(0, 2.55, -1.495);   // <-- moved in front of the board
boardFace.renderOrder = 1000;
zoneCardio.add(boardFace);

const boardGlow = new THREE.Mesh(
  new THREE.PlaneGeometry(2.6, 0.92),
  new THREE.MeshBasicMaterial({
    color:0x38bdf8,
    transparent:true,
    opacity:0.10,
    depthWrite:false,
    depthTest:false
  })
);
boardGlow.position.set(0, 2.55, -1.505);   // <-- behind the text plane
boardGlow.renderOrder = 900;
zoneCardio.add(boardGlow);


    const lblC = makeLabel('Cardio Bay');
    lblC.position.copy(Z_CARDIO).add(new THREE.Vector3(0, 4.1, -1.6));
    labelGroup.add(lblC);

    scene.add(zoneCardio);

    // Forensics zone (realistic)
    const zoneForensics = new THREE.Group();
    zoneForensics.name = 'forensics';
    zoneForensics.position.copy(Z_FORENSIC);

    const platF = zoneBasePlate(4.8, 3.6);
    platF.position.set(0, 0.03, 0);
    zoneForensics.add(platF);

    const lineMat = new THREE.LineBasicMaterial({ color:0x38bdf8, transparent:true, opacity:0.55 });
    const squarePts = [
      new THREE.Vector3(-1.2, 0.06, -1.0),
      new THREE.Vector3( 1.2, 0.06, -1.0),
      new THREE.Vector3( 1.2, 0.06,  1.0),
      new THREE.Vector3(-1.2, 0.06,  1.0),
      new THREE.Vector3(-1.2, 0.06, -1.0)
    ];
    zoneForensics.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(squarePts), lineMat));

    function tripod(x,z){
      const g = new THREE.Group();
      const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.04,0.05,1.05,10), matSteel);
      pole.position.y = 0.52; pole.castShadow = true; g.add(pole);
      const head = new THREE.Mesh(new THREE.BoxGeometry(0.20,0.12,0.20), matDark);
      head.position.y = 1.05; head.castShadow = true; g.add(head);
      const legGeo = new THREE.CylinderGeometry(0.02,0.02,0.80,8);
      for (let i=0;i<3;i++){
        const leg = new THREE.Mesh(legGeo, matSteel);
        const ang = i * (Math.PI*2/3);
        leg.position.set(Math.cos(ang)*0.18, 0.30, Math.sin(ang)*0.18);
        leg.rotation.z = 0.55;
        leg.rotation.y = ang;
        g.add(leg);
      }
      g.position.set(x, 0, z);
      return g;
    }
    zoneForensics.add(tripod(-1.55,-1.35), tripod(1.55,-1.35), tripod(0,1.55));

    const mon = new THREE.Mesh(new THREE.BoxGeometry(1.55, 0.95, 0.08), new THREE.MeshStandardMaterial({ color:0x111b2e, roughness:0.6, metalness:0.15 }));
    const mon1 = mon.clone(); mon1.position.set(-1.05, 2.35, -1.70); zoneForensics.add(mon1);
    const mon2 = mon.clone(); mon2.position.set( 1.05, 2.35, -1.70); zoneForensics.add(mon2);

    const lblF = makeLabel('Movement Analysis Booth');
    lblF.position.copy(Z_FORENSIC).add(new THREE.Vector3(0, 2.7, -1.6));
    labelGroup.add(lblF);

    scene.add(zoneForensics);

    // ==============================
    // 5) Avatar / model loader
    // ==============================
 
    function buildPreviewMannequin(){
      const avatar = new THREE.Group();
      avatar.userData.__isMannequin = true;
      const bodyMat = new THREE.MeshStandardMaterial({ color:0xdbe7f7, roughness:0.65, metalness:0.08 });

      const pelvis = new THREE.Mesh(new THREE.CapsuleGeometry(0.20, 0.14, 6, 14), bodyMat);
      pelvis.position.set(0, 0.95, 0); pelvis.castShadow = true;

      const torso = new THREE.Mesh(new THREE.CapsuleGeometry(0.26, 0.55, 8, 18), bodyMat);
      torso.position.set(0, 1.55, 0); torso.castShadow = true;

      const head = new THREE.Mesh(new THREE.SphereGeometry(0.17, 18, 18), bodyMat);
      head.position.set(0, 2.15, 0); head.castShadow = true;

      const limb = (r,l)=>{ const m=new THREE.Mesh(new THREE.CapsuleGeometry(r,l,6,12), bodyMat); m.castShadow=true; return m; };
      const armL = limb(0.06, 0.45); armL.position.set(-0.38, 1.65, 0); armL.rotation.z = 0.45;
      const armR = limb(0.06, 0.45); armR.position.set( 0.38, 1.65, 0); armR.rotation.z = -0.45;
      const legL = limb(0.07, 0.60); legL.position.set(-0.14, 0.55, 0);
      const legR = limb(0.07, 0.60); legR.position.set( 0.14, 0.55, 0);

      avatar.add(pelvis, torso, head, armL, armR, legL, legR);
      return avatar;
    }

    async function loadSelectedModel(modelId, onProgress){
      const m = getModel(modelId);
      ACTIVE_MODEL_ID = m.id;

      if (avatarRoot){
        scene.remove(avatarRoot);
        avatarRoot = null;
      }

      if (!m || !m.url){
        avatarRoot = buildPreviewMannequin();
        scene.add(avatarRoot);
        return avatarRoot;
      }

      return await new Promise((resolve, reject)=>{
        const loader = new GLTFLoader();

        loader.load(
          m.url,
          (gltf)=>{
            avatarRoot = gltf.scene || (gltf.scenes && gltf.scenes[0]) || null;
            if (!avatarRoot) return reject(new Error("GLB loaded but scene is empty"));

            avatarRoot.traverse(o=>{ if (o.isMesh){ o.castShadow=true; o.receiveShadow=true; } });
            scene.add(avatarRoot);
            // --- animation setup (run/walk/first clip) ---
mixer = null;
runAction = null;

const clips = (gltf.animations || []);
if (clips.length){
  mixer = new THREE.AnimationMixer(avatarRoot);
  const clip =
    clips.find(c => /run|jog/i.test(c.name)) ||
    clips.find(c => /walk/i.test(c.name)) ||
    clips[0];

  runAction = mixer.clipAction(clip);
  runAction.play();
  runAction.paused = true; // wait for Start
}

            // normalize to ~1.75m tall (ignore far outliers)
            avatarRoot.updateWorldMatrix(true, true);

            const meshBoxes = [];
            const mean = new THREE.Vector3();
            let n = 0;

            avatarRoot.traverse(o=>{
              if (!(o.isMesh || o.isSkinnedMesh) || !o.geometry) return;
              if (!o.geometry.boundingBox) o.geometry.computeBoundingBox();
              const b = new THREE.Box3().copy(o.geometry.boundingBox).applyMatrix4(o.matrixWorld);
              const center = new THREE.Vector3();
              b.getCenter(center);
              meshBoxes.push({ b, center });
              mean.add(center);
              n++;
            });

            if (n){
              mean.multiplyScalar(1 / n);
              const box = new THREE.Box3();
              for (const it of meshBoxes){
                if (it.center.distanceTo(mean) < 5.0) box.union(it.b);
              }
              const size = new THREE.Vector3();
              box.getSize(size);

              if (size.y > 1e-6){
                const targetH = 1.75;
                const s = targetH / size.y;
                avatarRoot.scale.setScalar(s);
                avatarRoot.updateWorldMatrix(true, true);
              }
            }
            resolve(avatarRoot);
          },
          (xhr)=>{
            if (!onProgress) return;
            const loaded = (xhr && xhr.loaded) ? xhr.loaded : 0;
            const totalRaw = (xhr && xhr.total) ? xhr.total : 0;
            const total = (totalRaw >= loaded) ? totalRaw : loaded;
            onProgress(total ? Math.round((loaded / total) * 100) : null);
          },
          (err)=>reject(err)
        );
      });
    }

    // ==============================
    // 6) Zone + Module router (with snap)
    // ==============================

    const camGoalPos = new THREE.Vector3(6.8, 3.9, 8.6);
    const camGoalTarget = new THREE.Vector3(0, 1.35, 0);

    function snapCam(){
      camera.position.copy(camGoalPos);
      controls.target.copy(camGoalTarget);
      controls.update();
    }

function placeAvatarForZone(which) {
  if (!avatarRoot) return;
  
  // Hard-lock to currentModule.zone if it exists to stop jumping between bays
  const targetZone = (currentModule && currentModule.zone) ? currentModule.zone : which;
  let rotY = 0;

  if (targetZone === 'strength') {
    avatarRoot.position.copy(Z_STRENGTH).add(new THREE.Vector3(0, 0.06, -0.10));
    rotY = 0;
  } else if (targetZone === 'cardio') {
    // Lock to Cardio Bay treadmill
    avatarRoot.position.copy(Z_CARDIO).add(new THREE.Vector3(0, 0.30, 0.05));
    rotY = Math.PI; 
  } else if (targetZone === 'forensics' || targetZone === 'analysis') {
    avatarRoot.position.copy(Z_FORENSIC).add(new THREE.Vector3(0, 0.06, 0.00));
    rotY = 0;
  }
  avatarRoot.rotation.set(0, rotY, 0);
}

function setZone(which) {
  // Keep all zones visible to maintain the studio environment
  zoneStrength.visible = true;
  zoneCardio.visible = true;
  zoneForensics.visible = true;

  // Only update camera goals if we aren't already locked into a module
  if (which === 'strength') {
    camGoalTarget.set(Z_STRENGTH.x, 1.25, Z_STRENGTH.z);
    camGoalPos.set(Z_STRENGTH.x + 3.2, 2.6, Z_STRENGTH.z + 4.8);
  } else if (which === 'cardio') {
    camGoalTarget.set(Z_CARDIO.x, 1.10, Z_CARDIO.z);
    camGoalPos.set(Z_CARDIO.x, 1.8, Z_CARDIO.z + 2.4);
  } else if (which === 'forensics') {
    camGoalTarget.set(Z_FORENSIC.x, 1.25, Z_FORENSIC.z);
    camGoalPos.set(Z_FORENSIC.x + 3.6, 2.6, Z_FORENSIC.z + 5.1);
  }

  placeAvatarForZone(which);
  // snapCam() is excluded here to let OrbitControls keep your manual pan position
}


function showFL001Trial(trials, letter) {
    // 1. Reset Simulation State immediately on switch
    sim.running = false;
    sim.hasStarted = false; // This unlocks the 'Start' button logic
    if (runAction) runAction.paused = true;
    restore(); // Returns avatar to anatomic pose

    // 2. Set UI Tags
    document.getElementById('trialTag').textContent = letter;
    trialTime = (letter === 'B') ? 480 : 300;
    document.getElementById('trialTime').textContent = trialTime;

    // 3. Configure Fueling Protocol
    const $fBtn = document.getElementById('fuelBtn');
    const fuelAllowed = (letter === 'B');
    $fBtn.disabled = !fuelAllowed;
    $fBtn.style.opacity = fuelAllowed ? "1" : "0.4";

    // 4. Reset Metabolic Counters
    sim.lactate = 0;
    sim.fuelCount = 0;
    sim.energy = 100;
    speedViolation = false;
    
    document.getElementById('engVal').textContent = "100";
    document.getElementById('trialMsg').innerHTML = `<b>Trial ${letter} Loaded.</b> Press Start to begin forensic validation.`;
    document.getElementById('startBtn').textContent = "Start";
}

async function enterFL001() {
    setZone('cardio');

    // No MD parsing — trials handled internally
    window.currentTrials = { mcqs: [] };

    const btnA = document.getElementById('trialA');
    const btnB = document.getElementById('trialB');

    if (btnA) btnA.onclick = () => showFL001Trial(window.currentTrials, 'A');
    if (btnB) btnB.onclick = () => showFL001Trial(window.currentTrials, 'B');

    document.getElementById('trialTag').textContent = "-";
    document.getElementById('trialTime').textContent = "0";
    document.getElementById('trialMsg').innerHTML =
      "<b>Module Loaded.</b> Select Trial A or B to begin.";
}


function enterModule(moduleId) {
  const mod = getModule(moduleId);
  currentModule = mod;
  document.getElementById('moduleTitle').textContent = mod.label;
  
  // Snap camera to the specific bay
  setZone(mod.zone || 'all');
  
  // Show the HUD badge
  const $badge = document.getElementById('badge');
  $badge.style.display = "block";
  $badge.style.top = "14px"; 
  
  // Trigger the specific module logic (like enterFL001)
  if (typeof mod.onEnter === 'function') {
    mod.onEnter(); 
  }
}
    // 7) Studio UI wiring
    // ==============================
    const pills = [...document.querySelectorAll('.pill')];
    function setActive(btn){ pills.forEach(p=>p.classList.toggle('active', p === btn && btn.dataset.zone !== 'labels')); }

    pills.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const z = btn.dataset.zone;
        if (z === 'labels'){
          setLabels(!labelsOn);
          btn.classList.toggle('active', labelsOn);
          return;
        }
        setZone(z);
        setActive(btn);
      });
    });

    // ==============================
    // 8) Tick loop
    // ==============================
function updateHUD() {
    $spdVal.textContent = sim.speedMph.toFixed(1);
    $engVal.textContent = Math.round(sim.energy);

    if (sim.energy <= 0) {
        $status.textContent = "CRITICAL FAILURE: EXHAUSTED";
        $status.style.color = "#ff9aa0";
    } else if (sim.running) {
        $status.textContent = "Simulation Active";
        $status.style.color = "#38bdf8";
    } else {
        $status.textContent = "Ready";
        $status.style.color = "#cfe3ff";
    }
}    

    const clock = new THREE.Clock();
let lastT = clock.getElapsedTime();
// --- GLOBAL RESTORE FUNCTION ---
// This resets the avatar bones to their original positions.
const restore = () => {
    const R = animate._run;
    if (R && R.rig) {
        for (const [b, q] of R.rig.base) b.quaternion.copy(q);
    }
};
function animate() {
    requestAnimationFrame(animate);

    const now = clock.getElapsedTime();
    let dt = now - lastT;
    lastT = now;

    controls.update();
  
// ===== BLINK (works for BOTH Roma + Roman via auto-detect morph names) =====
if (!animate._blink) animate._blink = { model:null, targets:[], state:0, t:0, next:0 };

const BL = animate._blink;

// (re)build targets when model changes
if (avatarRoot && BL.model !== avatarRoot){
  BL.model = avatarRoot;
  BL.targets = [];
  BL.state = 0;
  BL.t = 0;
  BL.next = performance.now()/1000 + 1.5;

  // Find morph targets on any mesh that has them
  const addTarget = (mesh, name)=>{
    const d = mesh.morphTargetDictionary;
    if (!d || d[name] == null) return false;
    BL.targets.push({ mesh, idx: d[name] });
    return true;
  };

  // Prefer Roman blink morphs if present, else Roma eyeClosed morphs
  let foundRoman = false;
  let foundRoma  = false;

  avatarRoot.traverse(o=>{
    if (!o.isMesh || !o.morphTargetInfluences || !o.morphTargetDictionary) return;

    // Roman
    foundRoman = addTarget(o, "Eye_Blink")   || foundRoman;
    foundRoman = addTarget(o, "Eye_Blink_L") || foundRoman;
    foundRoman = addTarget(o, "Eye_Blink_R") || foundRoman;

    // Roma
    foundRoma  = addTarget(o, "Expressions_eyeClosedL_max") || foundRoma;
    foundRoma  = addTarget(o, "Expressions_eyeClosedR_max") || foundRoma;
  });

  // If Roman + Roma both got added somehow, keep the one that actually matches this model:
  // (simple rule: if any Eye_Blink exists on this model, keep only Roman targets)
  const hasEyeBlink = BL.targets.some(t=>{
    const dict = t.mesh.morphTargetDictionary;
    return dict && (dict["Eye_Blink"] != null || dict["Eye_Blink_L"] != null || dict["Eye_Blink_R"] != null);
  });
  if (hasEyeBlink){
    BL.targets = BL.targets.filter(t=>{
      const dict = t.mesh.morphTargetDictionary;
      return dict && (dict["Eye_Blink"] != null || dict["Eye_Blink_L"] != null || dict["Eye_Blink_R"] != null);
    });
  } else {
    BL.targets = BL.targets.filter(t=>{
      const dict = t.mesh.morphTargetDictionary;
      return dict && (dict["Expressions_eyeClosedL_max"] != null || dict["Expressions_eyeClosedR_max"] != null);
    });
  }
}

// drive blink
if (BL.targets.length){
  const now = performance.now()/1000;

  // schedule next blink (about every ~5s with slight randomness)
  if (BL.state === 0 && now >= BL.next){
    BL.state = 1;        // closing
    BL.t = 0;
    BL.next = now + 4.2 + Math.random()*1.6;
  }

  // timings
  const down = 0.06;     // close
  const hold = 0.02;     // closed
  const up   = 0.10;     // open

  const setBlink = (v)=>{
    for (const t of BL.targets){
      t.mesh.morphTargetInfluences[t.idx] = v;
    }
  };

  if (BL.state !== 0){
    BL.t += dt;

    if (BL.state === 1){ // closing
      const v = Math.min(1, BL.t / down);
      setBlink(v);
      if (BL.t >= down){ BL.state = 2; BL.t = 0; }
    } else if (BL.state === 2){ // hold
      setBlink(1);
      if (BL.t >= hold){ BL.state = 3; BL.t = 0; }
    } else if (BL.state === 3){ // opening
      const v = 1 - Math.min(1, BL.t / up);
      setBlink(v);
      if (BL.t >= up){ BL.state = 0; BL.t = 0; setBlink(0); }
    }
  }
}


  // --- Procedural run-in-place (NO GLB animation clips required) ---
  if (!animate._run){
    animate._run = {
      rig: null,
      phase: 0,
      wasRunning: false,
      tmpQ: new THREE.Quaternion(),
      tmpE: new THREE.Euler(),
    };

    animate._getSkeleton = (root)=>{
      let sk = null;
      root.traverse(o=>{
        if (sk) return;
        if (o.isSkinnedMesh && o.skeleton) sk = o.skeleton;
      });
      return sk;
    };

    animate._initRig = ()=>{
      if (!avatarRoot) return null;
      const sk = animate._getSkeleton(avatarRoot);
      if (!sk) return null;

      const find = (names)=>{
        for (const n of names){
          const b = sk.getBoneByName(n);
          if (b) return b;
        }
        return null;
      };

      const bones = {
        spine01: find(['spine01','Spine1','mixamorigSpine1','spine']),
        spine02: find(['spine02','Spine2','mixamorigSpine2']),
        neck:  find(['neck','Neck','mixamorigNeck']),
        head:  find(['head','Head','mixamorigHead']),
        thighL: find(['thigh_L','thigh.L','LeftUpLeg','mixamorigLeftUpLeg']),
        thighR: find(['thigh_R','thigh.R','RightUpLeg','mixamorigRightUpLeg']),
        calfL:  find(['calf_L','shin_L','calf.L','LeftLeg','mixamorigLeftLeg']),
        calfR:  find(['calf_R','shin_R','calf.R','RightLeg','mixamorigRightLeg']),
        upArmL: find(['upperarm_L','upper_arm_L','upperarm.L','LeftArm','mixamorigLeftArm']),
        upArmR: find(['upperarm_R','upper_arm_R','upperarm.R','RightArm','mixamorigRightArm']),
        loArmL: find(['lowerarm_L','forearm_L','lowerarm.L','LeftForeArm','mixamorigLeftForeArm']),
        loArmR: find(['lowerarm_R','forearm_R','lowerarm.R','RightForeArm','mixamorigRightForeArm']),
        footL: find(['foot_L','foot.L','LeftFoot','mixamorigLeftFoot']),
        footR: find(['foot_R','foot.R','RightFoot','mixamorigRightFoot']),
        toesL: find(['toes_L','toe_L','toes.L','LeftToeBase','mixamorigLeftToeBase']),
        toesR: find(['toes_R','toe_R','toes.R','RightToeBase','mixamorigRightToeBase'])
      };

      const base = new Map();
      Object.values(bones).forEach(b=>{ if (b) base.set(b, b.quaternion.clone()); });
 // bake anatomic baseline into stored "base" so restore() keeps it
const uaFlex = THREE.MathUtils.degToRad(ANAT.upperarmFlex || 0);
if (uaFlex){
  const qUAFlex = new THREE.Quaternion().setFromEuler(new THREE.Euler(uaFlex, 0, 0)); // X = shoulder flex

  if (bones.upArmL){
    const bq = base.get(bones.upArmL);
    if (bq){
      const baked = bq.clone().multiply(qUAFlex);
      base.set(bones.upArmL, baked);
      bones.upArmL.quaternion.copy(baked);
    }
  }
  if (bones.upArmR){
    const bq = base.get(bones.upArmR);
    if (bq){
      const baked = bq.clone().multiply(qUAFlex);
      base.set(bones.upArmR, baked);
      bones.upArmR.quaternion.copy(baked);
    }
  }
}
     
// --- bake anatomic baseline into stored "base" so restore() keeps it ---
if (bones.spine01){
  const flex = THREE.MathUtils.degToRad(ANAT.spine01Flex || 0); // Roman=5, Roma=0
  const qFlex = new THREE.Quaternion().setFromEuler(new THREE.Euler(flex, 0, 0));

  const baseQ = base.get(bones.spine01);
  if (baseQ){
    const newBase = baseQ.clone().multiply(qFlex);
    base.set(bones.spine01, newBase);
    bones.spine01.quaternion.copy(newBase);
  }
}

      // If we found basically nothing, don't pretend it worked
      const foundCount = [...base.keys()].length;
      if (foundCount < 4) return null;
// --- bake model-specific anatomic baseline into base quaternions ---
const tuck = THREE.MathUtils.degToRad(ANAT.shTuck);
const er   = THREE.MathUtils.degToRad(ANAT.shER);
const hip  = THREE.MathUtils.degToRad(ANAT.hipAdd);

const tE = new THREE.Euler();
const tQ = new THREE.Quaternion();

const bake = (bone, ex, ey, ez)=>{
  if (!bone) return;
  const q = base.get(bone);
  if (!q) return;
  tE.set(ex, ey, ez);
  tQ.setFromEuler(tE);
  q.multiply(tQ);         // update stored base
  bone.quaternion.copy(q); // apply immediately on load
};

// shoulders (mirrored)
bake(bones.upArmL, 0, +er, -tuck);
bake(bones.upArmR, 0, -er, +tuck);

// hips/thigh adduction (mirrored) — Roma=5°, Roman=0°
bake(bones.thighL, 0, 0, -hip);
bake(bones.thighR, 0, 0, +hip);

      return { bones, base };
    };
  }

  const R = animate._run;

  // init rig once model exists
  if (!R.rig && avatarRoot && !avatarRoot.userData.__isMannequin){
    R.rig = animate._initRig();
  }

  const applyAdd = (bone, ex, ey, ez)=>{
    if (!R.rig || !bone) return;
    const baseQ = R.rig.base.get(bone);
    if (!baseQ) return;
    R.tmpE.set(ex, ey, ez);
    R.tmpQ.setFromEuler(R.tmpE);
    bone.quaternion.copy(baseQ).multiply(R.tmpQ);
  };


// This tells the character: "Run only if the start button is on AND you have energy."
const runNow = !!(sim.running && sim.energy > 0 && zoneCardio.visible);

  if (runNow){
    const mph = sim.speedMph;
    const k = clamp(mph / 6.0, 0, 2.0);           // 1.0 at 6mph
    const amp = clamp(k, 0, 1.35);
    const freq = (1.6 * k) + 0.15;                // cycles/sec

    R.phase += dt * (Math.PI * 2) * freq;

    const s  = Math.sin(R.phase);
    const s2 = Math.sin(R.phase * 2.0);

    const hipAmp  = THREE.MathUtils.degToRad(28) * amp;
    const kneeAmp = THREE.MathUtils.degToRad(90) * amp;
    const armAmp  = THREE.MathUtils.degToRad(22) * amp;
    const spineTw = THREE.MathUtils.degToRad(4)  * (amp * 0.6);
    const b = R.rig.bones;

// legs (hip swing + 5° THIGH ADDUCTION on Z) — ROMA ONLY
if (ACTIVE_MODEL_ID === "Roma") {
  const thighAdd = THREE.MathUtils.degToRad(5);
  applyAdd(b.thighL,  hipAmp * s, 0, -thighAdd);
  applyAdd(b.thighR, -hipAmp * s, 0, +thighAdd);
} else {
  applyAdd(b.thighL,  hipAmp * s, 0, 0);
  applyAdd(b.thighR, -hipAmp * s, 0, 0);
}



    const bendL = Math.max(0, -s) * kneeAmp;
    const bendR = Math.max(0,  s) * kneeAmp;
    // knee flexion = X axis (rx). keep your existing bendL/bendR logic.
  applyAdd(b.calfL, -bendL, 0, 0);
  applyAdd(b.calfR, -bendR, 0, 0);
// ankles/toes (dorsi in swing, plantar at toe-off)
const swingL  = Math.max(0, -s);
const swingR  = Math.max(0,  s);
const stanceL = Math.max(0,  s);
const stanceR = Math.max(0, -s);

const ankleDorsi = THREE.MathUtils.degToRad(12) * amp; // toe clearance
const anklePF    = THREE.MathUtils.degToRad(18) * amp; // toe-off
const toeExt     = THREE.MathUtils.degToRad(15) * amp; // MTP extension at toe-off

const ankleL = (+ankleDorsi * swingL) + (-anklePF * stanceL);
const ankleR = (+ankleDorsi * swingR) + (-anklePF * stanceR);

applyAdd(b.footL, ankleL, 0, 0);
applyAdd(b.footR, ankleR, 0, 0);

applyAdd(b.toesL, toeExt * stanceL, 0, 0);
applyAdd(b.toesR, toeExt * stanceR, 0, 0);


// arms (opposite) + MORE adduction + slight back bias + elbows
// arms (swing reacts to mph; pose does NOT)
const armTuck   = THREE.MathUtils.degToRad(17);  // adduction (Z)
const armBack   = THREE.MathUtils.degToRad(10);  // slight shoulder extension (X)
const humER     = THREE.MathUtils.degToRad(7);  // external rotation (Y)
const elbowHold = THREE.MathUtils.degToRad(90);  // elbow flex (X)

// one applyAdd per bone (no overwrites)
applyAdd(b.upArmL, (-armAmp * s) - armBack, +humER, -armTuck);
applyAdd(b.upArmR, ( armAmp * s) - armBack, -humER, +armTuck);

applyAdd(b.loArmL, elbowHold, 0, 0);
applyAdd(b.loArmR, elbowHold, 0, 0);


// torso: rotate so the OPPOSITE shoulder comes forward to the STANCE leg (NO side-to-side shake)
const torsoYaw  = THREE.MathUtils.degToRad(9) * amp * (-s);  // Y = axial rotation
const torsoLean = THREE.MathUtils.degToRad(1.5) * amp * ( s); // Z = tiny counterbalance (optional)

// use spine01 / spine02 / spine03 if available; otherwise fall back cleanly
if (b.spine01 && b.spine02 && b.spine03){
  applyAdd(b.spine01, 0, torsoYaw * 0.45, torsoLean * 0.45); // lower trunk
  applyAdd(b.spine02, 0, torsoYaw * 0.35, torsoLean * 0.35); // mid trunk
  applyAdd(b.spine03, 0, torsoYaw * 0.20, torsoLean * 0.20); // upper trunk
} 
else if (b.spine01 && b.spine02){
  applyAdd(b.spine01, 0, torsoYaw * 0.60, torsoLean * 0.60);
  applyAdd(b.spine02, 0, torsoYaw * 0.40, torsoLean * 0.40);
}
else if (b.spine01){
  applyAdd(b.spine01, 0, torsoYaw, torsoLean);
}
else if (b.spine02){
  applyAdd(b.spine02, 0, torsoYaw, torsoLean);
}
else if (b.spine03){
  applyAdd(b.spine03, 0, torsoYaw, torsoLean);
}


// head/neck: FOLLOW the torso yaw slightly (don’t use s2 here or it “shakes”)
if (b.neck) applyAdd(b.neck, 0, torsoYaw * 0.35, 0);
if (b.head) applyAdd(b.head, 0, torsoYaw * 0.15, 0);


if (runAction) runAction.paused = false;

  } else {
    // THIS FIXES THE RESET: If not running, force anatomic position
    restore();
    if (runAction) runAction.paused = true;
  }

  // treadmill motion
  if (sim.running){
    const treadSpeed = 0.35 + (sim.speedMph / 12) * 2.0;
    for (const s of treadStrips){
      s.position.z += dt * treadSpeed;
      if (s.position.z > TREAD_MAX_Z) s.position.z = TREAD_MIN_Z;
    }
    const beltSpeed = 0.10 + (sim.speedMph / 12) * 1.10;
    beltTex.offset.y = (beltTex.offset.y + dt * beltSpeed) % 1;
  }

  // billboard labels
  if (labelsOn){
    for (const ch of labelGroup.children) ch.lookAt(camera.position);
  }

  function drawTreadmillMph(screen){
    const { ctx, c } = screen;
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle = 'rgba(6,18,34,1)';
    ctx.fillRect(0,0,c.width,c.height);
    ctx.strokeStyle = 'rgba(56,189,248,0.85)';
    ctx.lineWidth = 10;
    ctx.strokeRect(10,10,c.width-20,c.height-20);
    ctx.fillStyle = '#e6eef7';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = '900 64px system-ui, -apple-system, Segoe UI, Roboto, Inter';
    ctx.fillText(`${sim.speedMph.toFixed(1)} mph`, c.width/2, c.height/2);
    screen.tex.needsUpdate = true;
  }

// 1. Update the Screen Displays
drawPanel(wallScreen, 'CARDIO BOARD');
drawTreadmillMph(consoleScreen);

// --- METABOLIC ENGINE & SIMULATION LOGIC ---
if (sim.running && sim.energy > 0) {
    sim.elapsed += dt; 
    const speed = parseFloat(sim.speedMph.toFixed(1));
    const currentCost = (speed * 26.8 * 0.205) + 3.5;
    const activeModel = document.getElementById('modelSelect').value;
    const ceilingSpeed = (activeModel === "Roman") ? 6.3 : 6.7;

    const profiles = {
        Roma:    { lowLactateMulti: 1.01, highLactateMulti: 1.11, recoveryRate: 0.07, tankSize: 1200, penaltySeverity: 1.9 },
        Roman:   { lowLactateMulti: 1.07, highLactateMulti: 1.22, recoveryRate: 0.05, tankSize: 1200, penaltySeverity: 2.3 },
        Default: { lowLactateMulti: 1.2,  highLactateMulti: 1.2,  recoveryRate: 0.05, tankSize: 1200, penaltySeverity: 1.5 }
    };
    const p = profiles[activeModel] || profiles.Default;

    // 1. ENERGY DRAIN (Linear / Fatigue-Driven)
    // Energy only links to Lactate here: if Lactate > 50, drain is harder.
    let fatigueScalar = (sim.lactate > 50) ? p.highLactateMulti : 0.85;
    
    if (currentCost > sim.vo2Max) {
        const deficit = currentCost - sim.vo2Max;
        const percentDrop = (deficit / 60 / p.tankSize) * 12000;
        sim.energy -= (percentDrop * fatigueScalar) * dt;
    } else {
        sim.energy = Math.min(100, sim.energy + (p.recoveryRate * dt));
    }

    // 2. INDEPENDENT LACTATE (Exponential / Speed-Driven)
    // We remove fatigueScalar from here to break the "Inverse Mirror"
    let activePenalty = (sim.fuelPenaltyTimer > 0) ? p.penaltySeverity : 1.0;

    if (speed > ceilingSpeed) {
        const deficit = currentCost - sim.vo2Max;
        // Multiplier increased to 0.045 so Lactate moves MUCH faster than Energy drains
        sim.lactate = Math.min(100, sim.lactate + (deficit * 0.0055 * activePenalty * dt));
    } else if (speed > 0) {
        // Fast independent clearance (0.8) so Lactate drops while Energy stays depleted
        sim.lactate = Math.max(0, sim.lactate - (0.8 * dt)); 
    }

    // 3. HOUSEKEEPING (Timers)
    if (sim.fuelPenaltyTimer > 0) sim.fuelPenaltyTimer -= dt;
    if (sim.fuelAlertTimer > 0) sim.fuelAlertTimer -= dt;
    if (sim.throughputAlert > 0) sim.throughputAlert -= dt;

    if (currentModule?.id === 'FL-001') {
        trialTime = Math.max(0, trialTime - dt);
        document.getElementById('trialTime').textContent = Math.ceil(trialTime);
    }
}

// --- DYNAMIC TRIAL STOP & UNLOCK LOGIC ---
if (sim.energy <= 0 || trialTime <= 0 || sim.lactate >= 100) {
    const activeModel = document.getElementById('modelSelect').value;
    const currentLetter = document.getElementById('trialTag').textContent.trim();
    const $statusVal = document.getElementById('statusVal');
    const $trialMsg = document.getElementById('trialMsg');

    // 1. GLOBAL FAILURE: SPEED VIOLATION
    // Any change to the slider during a run results in immediate forensic failure
    if (speedViolation) {
        $statusVal.textContent = "INTEGRITY BREACH";
        $statusVal.style.color = "#ff9aa0";
        $trialMsg.innerHTML = `<b style="color:#ff9aa0;">Trial Failed:</b> Speed was altered during session. Reset required.`;
    } 
    
    // 2. TRIAL A LOGIC (Threshold Continuity)
    else if (currentLetter === 'A') {
        if (trialTime <= 0) {
            const targetSpeed = (activeModel === "Roma") ? 6.7 : 6.3;
            // Success conditions: Correct starting speed AND energy maintained above 60%
            if (initialSpeed === targetSpeed && sim.energy >= 60) {
                triggerUnlock("Trial A Complete: Aerobic Dominance Confirmed.");
            } else {
                let failReason = (initialSpeed !== targetSpeed) ? "Incorrect starting speed." : "Insufficient energy reserve.";
                $trialMsg.innerHTML = `<b style="color:#ff9aa0;">Trial Failed:</b> ${failReason}`;
            }
        }
    }

    // 3. TRIAL B LOGIC (Metabolic Waste & Fueling)
    else if (currentLetter === 'B') {
        if (sim.lactate >= 100) {
            $statusVal.textContent = "CRITICAL FAILURE: ACIDOSIS";
            $statusVal.style.color = "#ff9aa0";
            $trialMsg.innerHTML = `<b style="color:#ff9aa0;">Trial Failed:</b> Waste accumulation exceeded clearance capacity.`;
        } else if (sim.energy <= 0) {
            $statusVal.textContent = "FAILURE: EXHAUSTION";
            $statusVal.style.color = "#ff9aa0";
            $trialMsg.innerHTML = `<b style="color:#ff9aa0;">Trial Failed:</b> W' Balance depleted.`;
        } else if (trialTime <= 0) {
            // Success condition: Survived 480s AND exactly 1 fuel event used
            if (sim.fuelCount === 1) {
                triggerUnlock("Trial B Complete: Metabolic Waste Managed.");
            } else {
                $trialMsg.innerHTML = `<b style="color:#ff9aa0;">Trial Failed:</b> Required fuel event (1) was not recorded.`;
            }
        }
    }

    // 4. PLACEHOLDER FOR FUTURE TRIALS (C, D, etc.)
    else if (currentLetter === 'C') {
        // Trial C logic goes here...
    }

    // --- STOP SIMULATION ---
    sim.running = false;
    sim.hasStarted = false; // Unlocks trial switcher in showFL001Trial
    if (runAction) runAction.paused = true;
    restore(); 
    document.getElementById('startBtn').textContent = "Start";
}

    updateHUD();
    renderer.render(scene, camera);
} // This is the single correct closing brace for animate()

function triggerUnlock(msg) {
    sim.running = false;
    if (runAction) runAction.paused = true;
    if (window.controls) window.controls.enabled = true; 

    const currentLetter = document.getElementById('trialTag').textContent.trim();
    const $trialMsg = document.getElementById('trialMsg');

    if (currentLetter === 'A') {
        // SUCCESSFUL TRIAL A
        $trialMsg.innerHTML = `<b style="color:#38bdf8;">Goal Reached:</b> Trial A validated. Unlocking Trial B...`;
        
        setTimeout(() => {
            // Clean state for transition
            sim.hasStarted = false;
            sim.fuelCount = 0;
            sim.lactate = 0;
            speedViolation = false;
            
            // Auto-load Trial B parameters (480s, Fuel enabled)
            showFL001Trial(window.currentTrials, 'B');
            $trialMsg.innerHTML = `<b>Trial B Loaded.</b> Survive 480s and record 1 fueling event.`;
        }, 3000);

    } else if (currentLetter === 'B') {
        // SUCCESSFUL TRIAL B
        $trialMsg.innerHTML = `<b style="color:#38bdf8;">Forensic Validation Successful.</b> All trials complete.`;
        
        // Show the Final Assessment Button
        const aBtn = document.getElementById('assessmentBtn');
        if (aBtn) {
            aBtn.style.display = 'block';
            const modId = document.getElementById('moduleSelect').value || "FL-001";
            aBtn.onclick = () => { 
window.location.href = `../mcq/?module=${modId}&mode=review`; };

        }
    }
}
animate();

// 9) Enter Studio (gate -> studio)
$enter.addEventListener('click', async () => {
  const modelId = document.getElementById('modelSelect').value; 
  const moduleId = document.getElementById('moduleSelect').value;
  
  let age = (modelId === "Roman") ? 43 : 34;
  let hrMax = 220 - age;
  sim.vo2Max = 15.3 * (hrMax / 72); 

  setAnatForModel(modelId);
  $enter.disabled = true;
  $enter.textContent = "Loading...";

  try {
    await loadSelectedModel(modelId, (p) => { 
      $enter.textContent = `Loading ${p}%`; 
    });

    document.getElementById('gate').style.display = "none";
    
    const uiMain = document.getElementById('ui');
    const badgeMenu = document.getElementById('badge');

    if (uiMain) uiMain.style.display = "flex";
    if (badgeMenu) {
        badgeMenu.style.display = "block";
        badgeMenu.style.top = "14px";
    }

    if (moduleId === 'FL-001') setZone('cardio'); 

    enterModule(moduleId);
    snapCam();

 // --- PERSISTENCE & REVIEW LOGIC ---
    const savedStatus = localStorage.getItem(`${moduleId}_Status`);
    const reviewBtn = document.getElementById('reviewBtn');

    if (savedStatus === 'completed') {
        // 1. Keep the Checkmark in the HUD title
        const titleEl = document.getElementById('moduleTitle');
        if (!titleEl.innerHTML.includes('✓')) {
            titleEl.innerHTML += " <span style='color:#4ade80; margin-left:8px;'>[✓ Completed]</span>";
        }

        // 2. Show Review Button and Open in New Tab
        if (reviewBtn) {
            reviewBtn.style.display = 'block';
          reviewBtn.onclick = () => {
    const modId = document.getElementById('moduleSelect')?.value || "FL-001";
    const targetURL = `../mcq/?module=${modId}`;
    window.open(targetURL, '_blank');
};

        }
    } else {
        if (reviewBtn) reviewBtn.style.display = 'none';
    }   
    // -----------------------------------
  } catch (e) {
    console.error("Entry Error:", e);
    $enter.textContent = "Error - Check Console";
  } finally {
    $enter.disabled = false;
  }
});

addEventListener('resize', () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
});
</script>
<div id="instrOverlay" style="position:fixed; inset:0; z-index:9999; display:none; align-items:center; justify-content:center; background:rgba(7,16,27,0.96); backdrop-filter:blur(10px); font-family:system-ui,-apple-system,sans-serif;">
    <div style="width:min(760px, 95vw); max-height:85vh; background:#0f172a; border:1px solid rgba(56,189,248,0.4); border-radius:24px; display:flex; flex-direction:column; overflow:hidden; box-shadow:0 30px 60px rgba(0,0,0,0.6);">
        
        <div style="display:flex; background:rgba(30,41,59,0.5); border-bottom:1px solid rgba(148,163,184,0.15);">
            <div id="t-concept" style="flex:1; padding:18px; text-align:center; cursor:pointer; font-size:11px; font-weight:900; color:#38bdf8; text-transform:uppercase; letter-spacing:1px; background:rgba(56,189,248,0.1); box-shadow:inset 0 -3px 0 #38bdf8;" onclick="switchMetabolicTab('concept')">Concept</div>
            <div id="t-guide" style="flex:1; padding:18px; text-align:center; cursor:pointer; font-size:11px; font-weight:900; color:#a8c0da; text-transform:uppercase; letter-spacing:1px;" onclick="switchMetabolicTab('guide')">Trial Guide</div>
            <div id="t-instr" style="flex:1; padding:18px; text-align:center; cursor:pointer; font-size:11px; font-weight:900; color:#a8c0da; text-transform:uppercase; letter-spacing:1px;" onclick="switchMetabolicTab('instr')">Module Instructions</div>
        </div>

        <div id="metabolicContent" style="padding:32px; overflow-y:auto; color:#cfe3ff; font-size:14px; line-height:1.6;">
            
            <div id="p-concept" style="display:block;">
                <h4 style="margin:0 0 14px 0; color:#38bdf8; text-transform:uppercase; font-size:15px;">Concept (read first)</h4>
                <p><b>Lesson Focus:</b><br>
                Running speed determines which energy system contributes the most energy. As speed increases, the primary energy contribution shifts from Aerobic Metabolism to Anaerobic Glycolysis, and at very high speeds to ATP-PC (PCr).</p>
                
                

                <p>Multiple energy systems can contribute simultaneously. ‘Primary’ refers to the largest contributor. Some systems, like ATP-PC, are only active while their immediate stores are available.</p>
                <ul style="padding-left:18px;">
                    <li><b>Aerobic Contribution:</b> Uses oxygen to meet energy demand. When this system is primary, energy levels remain stable.</li>
                    <li><b>Oxygen Deficit:</b> When running speed exceeds aerobic capacity, oxygen supply cannot fully meet demand.</li>
                    <li><b>Anaerobic Supplement:</b> Any shortfall is covered by anaerobic systems drawing from a finite reserve (W′ Balance), causing energy to decline.</li>
                </ul>

                <h4 style="margin:20px 0 14px 0; color:#38bdf8; text-transform:uppercase; font-size:15px;">Trial B — Concept (read first)</h4>
                <p><b>Carbohydrate energy/fuel:</b> isn’t instant; the body needs time to use it. During high-intensity, anaerobic-dominant exercise, glucose is broken down by glycolysis to make ATP, and if oxygen can’t keep up, pyruvate is converted to lactate—so early fueling can increase lactate without improving performance. Proper timing helps sustain effort and manage fatigue.</p>
                <p><b>Fuel Timing Optimization:</b> Fuel must be taken before fatigue becomes excessive, because once metabolic by-products accumulate, the body cannot efficiently restore usable energy. Waiting too long limits the performance benefit of fuel and increases the risk of rapid decline.</p>
                <p><b>Crash Condition:</b> Lactate reaching 100% ends the trial immediately, even if time remains or energy is sufficient.</p>
                <p><b>Learning Goals:</b></p>
                <ul style="padding-left:18px;">
                    <li>Observe how energy drains under anaerobic conditions.</li>
                    <li>Understand how fuel timing can maintain W′ energy without causing lactate to reach the crash threshold.</li>
                    <li>Recognize the trade-off between energy restoration and lactate accumulation.</li>
                </ul>
            </div>

            <div id="p-guide" style="display:none;">
                <h4 style="margin:0 0 14px 0; color:#38bdf8; text-transform:uppercase; font-size:15px;">Trial Guide Overview</h4>
                <p><b>VO₂ Max (Aerobic Capacity):</b> In this lab, this represents the subject’s modeled oxygen budget—the maximum sustainable oxygen supply available to support running.</p>
                <p><b>The Total VO₂ Cost:</b> When running, total oxygen demand is modeled as the sum of:<br>
                - <b>Resting Metabolic Rate (3.5 ml/kg/min):</b> Baseline oxygen cost required to sustain basic physiological function (≈1 MET).<br>
                - <b>Work VO₂:</b> The additional oxygen required to perform the mechanical work of running.<br>
                - <b>Oxygen Deficit:</b> If Total VO₂ Cost > VO₂ Max, energy demand exceeds aerobic supply and energy is supplemented by the finite W′ Balance.</p>

                <div style="margin:20px 0; display:grid; gap:15px;">
                    <div style="background:rgba(255,154,160,0.1); padding:15px; border-radius:12px; border:1px solid rgba(255,154,160,0.2);">
                        <b style="color:#ff9aa0;">1. ATP-PC (Phosphagen)</b><br>
                        Speed: Instant | Duration: ~0–10 seconds | Capacity: Very small “burst tank”<br>
                        Explanation: Work:Rest ratio is usually 1:12 to 1:20. For every 1s of maximal effort, 12–20s of rest are required. For a 10s sprint: Min rest 120s; Max rest 200s.
                    </div>
                    <div style="background:rgba(255,228,163,0.1); padding:15px; border-radius:12px; border:1px solid rgba(255,228,163,0.2);">
                        <b style="color:#ffe4a3;">2. Anaerobic Glycolysis (W′)</b><br>
                        Speed: Fast, short-term | Capacity: Small, finite “reserve tank” | Work:Rest: 1:3–1:5<br>
                        Use: Supplies additional energy when aerobic oxygen delivery is insufficient.
                    </div>
                    <div style="background:rgba(56,189,248,0.1); padding:15px; border-radius:12px; border:1px solid rgba(56,189,248,0.2);">
                        <b style="color:#38bdf8;">3. Aerobic (VO₂ Max)</b><br>
                        Speed: Moderate, sustainable | Capacity: Large “main tank” | Work:Rest: 1:1–1:3<br>
                        Use: Supplies most energy at low-to-moderate speeds.
                    </div>
                </div>

                <h4 style="margin:0 0 10px 0; color:#38bdf8; text-transform:uppercase; font-size:13px;">Trial B — Overview</h4>
                <p>In Trial B, the subject is operating entirely above their aerobic ceiling (Roma - 6.8 mph), so anaerobic glycolysis is the primary energy system. The trial introduces the Lactate Proxy to visualize metabolic waste and demonstrates how fueling affects energy and lactate accumulation.</p>
                <ul style="padding-left:18px;">
                    <li>In Trial A, oxygen delivery matched demand, so lactate was negligible.</li>
                    <li>In Trial B, the system is stressed: oxygen supply is insufficient, and lactate begins to accumulate.</li>
                </ul>
            </div>

            <div id="p-instr" style="display:none;">
                <h4 style="margin:0 0 14px 0; color:#38bdf8; text-transform:uppercase; font-size:15px;">Trial A — Aerobic Metabolism</h4>
                <p><b>Goal:</b> Find the highest speed at which the subject completes a 300 s trial without crossing into Anaerobic Dominance (remaining at or above 60% energy).</p>
                <p><b>The 60% Threshold (Lab-Defined):</b> In real physiology, the transition to anaerobic dominance occurs at an individual-specific threshold (commonly 50–90% of VO₂ max). In this lab, 60% is used as a standardized simulation threshold and is not a universal biological constant.</p>
                
                <p><b>1. Calculate the "Oxygen Budget" (VO₂ Max)</b><br>
                Formula: VO₂max ≈ 15.3 × (HRmax / HRrest)<br>
                Model Info: Roma (34), Roman (43). HRrest: 72. HRmax: (220 - age).</p>

                <p><b>2. Calculate the "Oxygen Cost"</b><br>
                Lab-Adjusted Formula: Total Cost = ((MPH × 26.8) × 0.2) + 3.5</p>

                <p><b>3. The Forensic Test</b><br>
                Compare Total Cost to Oxygen Budget: If Cost > Budget, energy will drain. If Cost ≤ Budget, energy remains stable.</p>

                <hr style="border:none; border-top:1px solid rgba(148,163,184,0.2); margin:20px 0;">

                <h4 style="margin:0 0 14px 0; color:#38bdf8; text-transform:uppercase; font-size:15px;">Trial B — Anaerobic Metabolic Investigation</h4>
                <p><b>Module Instructions:</b> Set the speed slider to 6.8 (Roma) or 6.3 (Roman) mph for the full 3-minute trial.</p>
                <p><b>Pre-Test (Optional):</b> Run a short pre-trial to observe how early vs. late fueling affects W′ energy recovery, Lactate accumulation, and Timing of fuel pulses.</p>
                <p><b>Official Trial:</b></p>
                <ul style="padding-left:18px;">
                    <li>Begin the 3-minute trial at 6.8 mph (Roma) or 6.3 mph (Roman) and maintain throughout.</li>
                    <li>Monitor Energy and Lactate bars.</li>
                    <li>Apply exactly 1 fuel pulse (+10 each) strategically to:
                        <ul style="padding-left:18px;">
                            <li>Keep W′ energy above 0% before the timer runs out.</li>
                            <li>Avoid Lactate reaching 100%.</li>
                            <li>Decide when to apply the fuel - when it is most optimized.</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div style="padding:20px; border-top:1px solid rgba(148,163,184,0.15); display:flex; justify-content:flex-end; background:rgba(15,23,42,0.6);">
            <button style="border:1px solid #38bdf8; background:rgba(56,189,248,0.2); color:#fff; padding:12px 32px; border-radius:14px; font-weight:900; cursor:pointer; font-size:12px; text-transform:uppercase;" onclick="document.getElementById('instrOverlay').style.display='none'">Begin Lab</button>
        </div>
    </div>
</div>

<script>
    function switchMetabolicTab(pane) {
        const panes = ['concept', 'guide', 'instr'];
        panes.forEach(p => {
            document.getElementById('p-' + p).style.display = p === pane ? 'block' : 'none';
            const tab = document.getElementById('t-' + p);
            tab.style.color = p === pane ? '#38bdf8' : '#a8c0da';
            tab.style.background = p === pane ? 'rgba(56,189,248,0.1)' : 'none';
            tab.style.boxShadow = p === pane ? 'inset 0 -3px 0 #38bdf8' : 'none';
        });
    }

    (function() {
        const enterBtn = document.getElementById('enterBtn');
        const helpBtn = document.getElementById('trialHelp');
        const overlay = document.getElementById('instrOverlay');

        if (enterBtn) {
            enterBtn.addEventListener('click', () => {
                // Stays hidden until manual click per standard studio behavior
                setTimeout(() => { overlay.style.display = 'none'; }, 800);
            });
        }
        if (helpBtn) {
            helpBtn.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                overlay.style.display = 'flex';
            };
        }
    })();
</script>
</body>
</html>
